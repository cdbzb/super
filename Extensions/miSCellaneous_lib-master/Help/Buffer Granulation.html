<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1404.47">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 21.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #0000ee; -webkit-text-stroke: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
p.p6 {margin: 0.0px 0.0px 0.0px 27.0px; text-indent: -27.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p7 {margin: 0.0px 0.0px 0.0px 27.0px; text-indent: -27.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 27.0px; text-indent: -27.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #0000ee; -webkit-text-stroke: #0000ee}
p.p9 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; line-height: 16.0px; font: 14.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p11 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #d60000; -webkit-text-stroke: #d60000}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000; min-height: 12.0px}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; line-height: 12.0px; font: 9.0px Monaco; color: #cd1c00; -webkit-text-stroke: #cd1c00}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; line-height: 12.0px; font: 9.0px Monaco; color: #d60000; -webkit-text-stroke: #d60000}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 10.0px; font: 9.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #cd1c00; -webkit-text-stroke: #cd1c00}
p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #0433ff; -webkit-text-stroke: #0433ff}
p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #0326cb; -webkit-text-stroke: #0326cb}
p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #cd1c00; -webkit-text-stroke: #cd1c00; min-height: 12.0px}
p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #008300; -webkit-text-stroke: #008300}
p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #ff7c00; -webkit-text-stroke: #ff7c00}
p.p25 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 16.0px; font: 14.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p26 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #0013ce; -webkit-text-stroke: #0013ce}
p.p27 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #007300; -webkit-text-stroke: #007300}
p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; line-height: 12.0px; font: 9.0px Monaco; color: #007300; -webkit-text-stroke: #007300}
p.p29 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000; min-height: 12.0px}
p.p30 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; line-height: 10.0px; font: 9.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p31 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000}
p.p32 {margin: 0.0px 0.0px 0.0px 29.0px; text-indent: -29.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p33 {margin: 0.0px 0.0px 0.0px 29.0px; text-indent: -29.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
span.s1 {font: 18.0px Helvetica; font-kerning: none}
span.s2 {font-kerning: none}
span.s3 {font-kerning: none; color: #000000; -webkit-text-stroke: 0px #000000}
span.s4 {text-decoration: underline ; font-kerning: none; color: #0000ee; -webkit-text-stroke: 0px #0000ee}
span.s5 {text-decoration: underline ; font-kerning: none; color: #01caff; -webkit-text-stroke: 0px #01caff}
span.s6 {text-decoration: underline ; font-kerning: none; color: #042eee; -webkit-text-stroke: 0px #042eee}
span.s7 {font-kerning: none; color: #00bbff; -webkit-text-stroke: 0px #00bbff}
span.s8 {text-decoration: underline ; font-kerning: none; color: #00caff; -webkit-text-stroke: 0px #00caff}
span.s9 {text-decoration: underline ; font-kerning: none}
span.s10 {font: 10.0px Helvetica; font-kerning: none; color: #000000; -webkit-text-stroke: 0px #000000}
span.s11 {font: 12.0px Helvetica; text-decoration: underline ; font-kerning: none; color: #042eee; -webkit-text-stroke: 0px #042eee}
span.s12 {text-decoration: underline ; font-kerning: none; color: #003bff; -webkit-text-stroke: 0px #003bff}
span.s13 {text-decoration: underline ; font-kerning: none; color: #0067ff; -webkit-text-stroke: 0px #0067ff}
span.s14 {font-kerning: none; color: #0013ce; -webkit-text-stroke: 0px #0013ce}
span.s15 {font-kerning: none; color: #007300; -webkit-text-stroke: 0px #007300}
span.s16 {font-kerning: none; color: #0326cb; -webkit-text-stroke: 0px #0326cb}
span.s17 {font-kerning: none; color: #737373; -webkit-text-stroke: 0px #737373}
span.s18 {font-kerning: none; color: #008300; -webkit-text-stroke: 0px #008300}
span.s19 {font-kerning: none; color: #0433ff; -webkit-text-stroke: 0px #0433ff}
span.s20 {font-kerning: none; color: #434ccb; -webkit-text-stroke: 0px #434ccb}
span.s21 {font-kerning: none; color: #ff7c00; -webkit-text-stroke: 0px #ff7c00}
span.s22 {font: 9.0px Monaco; text-decoration: underline ; font-kerning: none; color: #0018ff; -webkit-text-stroke: 0px #0018ff}
span.s23 {font-kerning: none; color: #d60000; -webkit-text-stroke: 0px #d60000}
span.s24 {font-kerning: none; color: #0028f2; -webkit-text-stroke: 0px #0028f2}
span.s25 {text-decoration: underline ; font-kerning: none; color: #0095ff; -webkit-text-stroke: 0px #0095ff}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>Buffer Granulation<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><span class="s2"><b>different approaches to buffer granulation with gui examples</b></span><span class="s1"><b><span class="Apple-tab-span">	</span></b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p3"><span class="s3"><b>Part of:</b> <a href="miSCellaneous.html"><span class="s4">miSCellaneous</span></a></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p3"><span class="s3"><b>See also:</b> <a href="Live Granulation.html"><span class="s5">Live Granulation</span></a>, <a href="Introduction to miSCellaneous.html"><span class="s6">Introduction to miSCellaneous</span></a></span><span class="s7">,</span><span class="s3"> <a href="VarGui.html"><span class="s8">VarGui</span></a></span><span class="s7">,</span><span class="s3"> <a href="VarGui shortcut builds.html"><span class="s4">VarGui shortcut builds</span></a></span><span class="s7">,</span><span class="s3"> <a href="PLx suite.html"><span class="s4">PLx suite</span></a></span><span class="s7">,</span><span class="s3"> <a href="PbindFx.html"><span class="s4">PbindFx</span></a></span><span class="s7">,</span><span class="s3"> <a href="kitchen studies.html"><span class="s4">kitchen studies</span></a></span><span class="s7">,</span><span class="s3"> <a href="Sieves and Psieve patterns.html"><span class="s4">Sieves and Psieve patterns</span></a></span><span class="s7">,</span><span class="s3"> <a href="PSPdiv.html"><span class="s4">PSPdiv</span></a></span><span class="s9">,</span><span class="s10"> <a href="DX suite.html"><span class="s11">DX suite</span></a></span><span class="s3">, <a href="DXMix.html"><span class="s6">DXMix</span></a>, <a href="DXMixIn.html"><span class="s6">DXMixIn</span></a>,<b> </b><a href="DXEnvFan.html"><span class="s6">DXEnvFan</span></a>,<b> </b><a href="DXEnvFanOut.html"><span class="s6">DXEnvFanOut</span></a>, <a href="DXFan.html"><span class="s6">DXFan</span></a>, <a href="DXFanOut.html"><span class="s6">DXFanOut</span></a></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">As with many things in SC work can be done by language or server. Speaking about granulation in general this mainly concerns the control of single grains, their rate, timing, length and other parameters. Regarding buffer granulation specifically this task can e.g. be taken over by ugens like TGrains and GrainBuf, the latter additionally accepting a grain envelope arg. The SC plugin distribution contains further variations (see BhobUGens, JoshUGens). By using granulation ugens in a SynthDef granular textures can be produced with a single Synth, including grain parameter sequencing with demand rate ugens, the <a href="DX suite.html"><span class="s6">DX suite</span></a> opens additional genuine options in this regard. Alternatively SynthDefs for single grains can be defined with PlayBuf or BufRd in order to control the whole buffer granulation process from language side, using Patterns, Tasks or Routines. What is the best way? To a large extent this is a question of personal preference. Regarding CPU performance granulation ugens have an advantage, whereas e.g. pattern-driven granulation allows concise control over the sequencing of granulation parameters in a clear syntax. If pattern-driven granulation is becoming CPU-critical you might want to consider the event type \grain, a lightweight variant of default type \note (see comment in the source file Event.sc). For granulation with Tasks see example 3 in <a href="VarGui.html"><span class="s8">VarGui</span></a>.</span><span class="s8"> </span><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">Also hybrid strategies are possible, e.g. language controlled setting of a single granulation Synth or involving extra control synths in a language-driven granulation process, further options are Pspawner / Pspawn and Wavesets. VarGui can be used to integrate these setups in single GUIs. Together with this file (miSCellaneous v0.7) I reinvented a color grouping option that overrides automatic color grouping (<a href="VarGui.html"><span class="s8">VarGui</span></a>, Ex. 7). The latter is based on the logical structure of ordinary and array controls, synths and environments. This is useful for VarGuis up to a medium number of controls per Synth / Pattern / Task and also for a large number of such items, but it doesn't handle cases well where there are many controls per item. Not barely an aesthetic detail, it is much more convenient for experimenting to group all sliders of a Synth that, say, have to do with a bandpass filter, within one color.<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>Types of variables</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">In general interpreter variables are prefered in examples below, wherever possible. If evaluated with example code only their values are passed and further changing of used variables doesn't affect already generated gui instances. On the contrary repeated evaluation of an interpreter variable, e.g. from a Pfunc, is unsafe - variable's value could change while gui has not yet been closed - so in concerned examples values are passed to the event definition, in Ex. 2c a variable is declared for the same reason.<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2">The use of environmental variables is following the way VarGui is handling them. Per default every EventStreamPlayer derived from a passed Pattern is run in a separate newly generated Environment, where variables are being set and Streams from Pfuncs and PLx patterns are reading from. See <a href="Event patterns and Functions.html"><span class="s12">Event patterns and Functions</span></a>, <a href="PLx suite.html"><span class="s13">PLx suite</span></a> and <a href="VarGui.html"><span class="s8">VarGui</span></a>.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>WARNING:</b><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">1.) <span class="Apple-tab-span">	</span>Be careful with amplitudes, especially with buffers you haven't granulated before !</span></p>
<p class="p4"><span class="s2"><span class="Apple-tab-span">	</span>Also keep in mind that a granular cloud moving through a buffer can suddenly become louder and other controls than amp (e.g. buffer position, trigger rate, bandpass parameters) can cause a raise of amplitude too.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p4"><span class="s2">2.)<span class="Apple-tab-span">	</span>I haven't used below setups for live performances. Although all of them work stable for me as they are, in general hangs can occasionally happen with pattern-driven setups. Often this can be tracked down to sequences of extremely short event durations (and/or long grain durations). Where this can happen as a side-effect, thresholds can be built in, e.g. example 2d (Wavesets) has a parameter maxTrigRate.<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s2"><span class="Apple-tab-span">	</span>Another possible source of hangs is careless deep nesting of Patterns where mistakes can easily occur. Starting with clear Pattern structures is recommended - and if more complications are involved: testing without sound first, after saving your patch, might be a good idea.<span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>NOTE:</b><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">All variants from this tutorial can be applied to a buffer, which is occasionally (or continuously) filled with live input. Vice versa variants from <a href="Live Granulation.html"><span class="s5">Live Granulation</span></a> can of course be applied to any signal, thus also to any playback of a buffer.<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">All examples below expect mono buffers. Buffer paths refering to the included sample suppose that you have installed via quarks or moved miSCellaneous lib into the user or system extensions directory directly (not into a subfolder), if not so or you have moved the sample file somewhere else you'd have to change paths accordingly.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">Due to a bug in SC 3.7 / 3.8 TGrains didn't response to amp changes, I changed the examples accordingly, the bug is fixed in 3.9.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">Windows 7:<span class="Apple-converted-space">  </span>While other parts of miSCellaneous lib were running fine I was unable to allocate buffers with the SC 3.5.4 Windows binary in August 2012. Meanwhile this issue has been solved (SC 3.6.6, February 2014). There also seemed to be accuracy issues with OffsetOut on Windows with SC 3.6 still, but not with newer versions.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p5"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2"><b>Credits<span class="Apple-converted-space"> </span></b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">Thanks for contributions and inspirations by SCers Alberto de Campo (Wavesets), James Harkins (Patterns), Ron Kuivila (Pspawner), Sergio Luque (stochastic distributions), Josh Parmenter (granulation plugins), Bhob Rainey (granulation plugins).</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>References</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">[1]<span class="Apple-tab-span">	</span>de Campo, Alberto. "Microsound" In: Wilson, S., Cottle, D. and Collins, N. (eds). 2011.<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><i>The SuperCollider Book</i>. Cambridge, MA: MIT Press, 463-504.</span></p>
<p class="p7"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p6"><span class="s2">[2]<span class="Apple-tab-span">	</span>Luque, Sergio (2006). <i>Stochastic Synthesis, Origins and Extensions</i>. Institute of Sonology, Royal Conservatory, The Netherlands.<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s3"><span class="Apple-tab-span">	</span><a href="http://sergioluque.com/"><span class="s4">http://sergioluque.com</span></a></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">[3]<span class="Apple-tab-span">	</span>Roads, Curtis (2001). <i>Microsound</i>. Cambridge, MA: MIT Press.</span></p>
<p class="p7"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p6"><span class="s2">[4]<span class="Apple-tab-span">	</span>Wishart, Trevor (1994). <i>Audible Design</i>. York: Orpheus The Pantomime Ltd.<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">[5]<span class="Apple-tab-span">	</span>Xenakis, Iannis (1992). <i>Formalized Music</i>. Hillsdale, NY: Pendragon Press, 2nd Revised edition.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p4"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p10"><span class="s2"><b>1.) Granulation with Ugens</b></span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 1a: <span class="Apple-converted-space">  </span>Basic buffer granulation Synth</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s2">s = </span><span class="s14">Server</span><span class="s2">.local;</span></p>
<p class="p12"><span class="s14">Server</span><span class="s2">.default = s;</span></p>
<p class="p12"><span class="s2">s.boot;</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// basic SynthDef suited for pitch-shift and time-stretch</span></p>
<p class="p13"><span class="s2">// buffer position given relatively (posLo and posHi between 0 and 1)</span></p>
<p class="p13"><span class="s2">// posDev: maximum amount of deviation from (moving) grain center position</span></p>
<p class="p13"><span class="s2">// posDev = 0 can lead to comb filter effects (which may be nice sometimes)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// passing control specs as metadata allows for VarGui shortcut build method sVarGui</span></p>
<p class="p13"><span class="s2">// metadata specs can be overwritten by arg ctrReplace</span></p>
<p class="p13"><span class="s2">// alternatively control specs may be passed as synthCtr arg to a build with VarGui( ... )</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s15">\gran_1a</span><span class="s2">, { </span><span class="s14">arg</span><span class="s2"> out = 0, bufNum = 0, posLo = 0.0, posHi = 1.0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRate = 1, posDev = 0.01, trigRate = 100, granDur = 0.1, rate = 1.0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>panMax = 1, amp = 0.1, interp = 4;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> trig, pan, pos, bufDur, bufDurSection, posDif;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDur = </span><span class="s14">BufDur</span><span class="s2">.kr(bufNum);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDurSection = bufDur * posDif;<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trig = </span><span class="s14">Impulse</span><span class="s2">.kr(trigRate);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = posLo * bufDur +</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</span><span class="s14">Phasor</span><span class="s2">.ar(0, </span><span class="s14">BufRateScale</span><span class="s2">.kr(bufNum) * posRate / </span><span class="s14">SampleRate</span><span class="s2">.ir, posLo * bufDur, posHi * bufDur) +<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</span><span class="s14">TRand</span><span class="s2">.kr(-0.5 * posDev, 0.5 * posDev, trig) * bufDur)).mod(bufDurSection); <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s14">Demand</span><span class="s2">.kr(trig, 0, </span><span class="s14">Dseq</span><span class="s2">([panMax, panMax.neg],</span><span class="s14">inf</span><span class="s2">) * 0.999);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out, </span><span class="s14">TGrains</span><span class="s2">.ar(2, trig, bufNum, rate, pos, granDur, pan, 1, interp) * amp);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>}, metadata: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specs: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posLo: [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posHi: [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRate: [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posDev: [0, 0.2, 5, 0, 0.01],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDur: [0.01, 0.3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRate: [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 100],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rate: [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>panMax: [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp: [0.0, 0.5, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.25]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>)</span></p>
<p class="p12"><span class="s2">).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2">)</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// start from GUI</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s15">\gran_1a</span><span class="s2">.sVarGui([</span><span class="s15">\bufNum</span><span class="s2">, b.bufnum]).gui;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 1b: <span class="Apple-converted-space">  </span>More deviations</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// In example 1a only a deviation from the grain center position was implemented.</span></p>
<p class="p13"><span class="s2">// With additional deviation controls a greater plasticity of sound can be achieved,</span></p>
<p class="p13"><span class="s2">// here deviations are added for trigRate (LFO with oscillation freq and deviation max),</span></p>
<p class="p13"><span class="s2">// grain duration and rate (TRand, equally weighted random deviation with given max).</span></p>
<p class="p13"><span class="s2">// Deviations intervals could be defined alternatively,<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// e.g. (1/(1+maxDev), 1+maxDev) with 0 &lt; maxDev</span></p>
<p class="p13"><span class="s2">// instead of (1-maxDev, 1+mexDev) with 0 &lt; maxDev &lt; 1</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// posRate control range is widened by inventing two controls for<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// mantissa and exponent, so posRate = 1 for init param pair<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// posRateE = 0 and posRateM = 1</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s15">\gran_1b</span><span class="s2">, { </span><span class="s14">arg</span><span class="s2"> out = 0, bufNum = 0, posLo = 0.0, posHi = 1.0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRateE = 0, posRateM = 1, posDev = 0.01, trigRate = 100, trigRateDev = 0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trigRateOsc = 1, granDur = 0.1, granDurDev = 0, rate = 1.0, rateDev = 0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>panMax = 1, amp = 0.1, interp = 4;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> trig, pan, pos, bufDur, bufDurSection, posDif, posRate;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDur = </span><span class="s14">BufDur</span><span class="s2">.kr(bufNum);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDurSection = bufDur * posDif;<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trig = </span><span class="s14">Impulse</span><span class="s2">.kr(</span><span class="s14">LFDNoise3</span><span class="s2">.kr(trigRateOsc, trigRate * trigRateDev, trigRate));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = posLo * bufDur +</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</span><span class="s14">Phasor</span><span class="s2">.ar(0, </span><span class="s14">BufRateScale</span><span class="s2">.kr(bufNum) * posRate / </span><span class="s14">SampleRate</span><span class="s2">.ir, posLo * bufDur, posHi * bufDur) +<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</span><span class="s14">TRand</span><span class="s2">.kr(-0.5, 0.5, trig) * posDev * bufDur)).mod(bufDurSection); <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s14">Demand</span><span class="s2">.kr(trig, 0, </span><span class="s14">Dseq</span><span class="s2">([panMax, panMax.neg],</span><span class="s14">inf</span><span class="s2">) * 0.999);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out, </span><span class="s14">TGrains</span><span class="s2">.ar(2, trig, bufNum, rate * (</span><span class="s14">TRand</span><span class="s2">.kr(-1, 1.0, trig) * rateDev + 1), pos,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDur * (</span><span class="s14">TRand</span><span class="s2">.kr(-1, 1.0, trig) * granDurDev + 1), pan, 1, interp) * amp);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>}, metadata: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specs: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posLo: [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posHi: [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRateE: [-3, 4, </span><span class="s15">\lin</span><span class="s2">, 1, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRateM: [0.1, 10, </span><span class="s15">\exp</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posDev: [0, 0.2, 5, 0, 0.05],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRate: [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 100],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRateDev: [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRateOsc: [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 3],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDur: [0.01, 0.3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDurDev: [0.0, 0.95, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0],</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rate: [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rateDev: [0.0, 0.99, </span><span class="s15">\linear</span><span class="s2">, 0.01, 0.05],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>panMax: [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp: [0.0, 0.5, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.25]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>)</span></p>
<p class="p12"><span class="s2">).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2">)</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// start from GUI</span></p>
<p class="p17"><span class="s2">// use color grouping for better overview</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s15">\gran_1b</span><span class="s2">.sVarGui([</span><span class="s15">\bufNum</span><span class="s2">, b.bufnum]).gui(synthColorGroups: (0..14).clumps([1,5,3,2,2,1,1]) )</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 1c: <span class="Apple-converted-space">  </span>Buffer granulation Synth with external control synths</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// This is a more modular approach, once having a basic granulation synth</span></p>
<p class="p19"><span class="s2">// it can be linked with arbitrary control synths, here</span></p>
<p class="p19"><span class="s2">// also moving through the buffer is controlled externally.</span></p>
<p class="p19"><span class="s2">// Depending on LFOs it might be worth defining<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// audio buses for control to get higher precision.</span></p>
<p class="p19"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s16">SynthDef</span><span class="s2">(</span><span class="s18">\gran_1c</span><span class="s2">, { </span><span class="s19">arg</span><span class="s2"> out = 0, bufNum = 0, amp = 0.1, pos = 0.5, posDev = 0.01,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trigRate = 100, granDur = 0.1, rate = 1, panMax = 1, interp = 4;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">var</span><span class="s2"> trig, pan;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trig = </span><span class="s16">Impulse</span><span class="s2">.kr(trigRate);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s16">Demand</span><span class="s2">.kr(trig, 0, </span><span class="s16">Dseq</span><span class="s2">([panMax, panMax.neg],</span><span class="s20">inf</span><span class="s2">) * 0.999);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = (pos * </span><span class="s16">BufDur</span><span class="s2">.kr(bufNum) * </span><span class="s16">WhiteNoise</span><span class="s2">.kr(posDev, 1));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">Out</span><span class="s2">.ar(out, </span><span class="s16">TGrains</span><span class="s2">.ar(2, trig, bufNum, rate, pos, granDur, pan, 1, interp) * amp);</span></p>
<p class="p12"><span class="s2">}).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// LFO synthdef for switching between 3 types:<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// 0: LFDNoise3 (smooth random movement)</span></p>
<p class="p19"><span class="s2">// 1: SinOsc</span></p>
<p class="p19"><span class="s2">// 2: LFSaw (works as phasor for position)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s16">SynthDef</span><span class="s3">(</span><span class="s18">\lfo</span><span class="s3">, { </span><span class="s2">|out = 0, lfoType = 0, freq = 1, lo = 0, hi = 1|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">var</span><span class="s2"> ctrl;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>ctrl = </span><span class="s16">Select</span><span class="s2">.kr(lfoType, [</span></p>
<p class="p21"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">LFDNoise3</span><span class="s3">,</span></p>
<p class="p21"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">SinOsc</span><span class="s3">,</span></p>
<p class="p21"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">LFSaw</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>].collect { </span><span class="s19">|x|</span><span class="s2"> x.kr(freq, mul: hi-lo/2, add: hi+lo/2) });</span></p>
<p class="p12"><span class="s2">    </span><span class="s16">Out</span><span class="s2">.kr(out, ctrl);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// multichannel control bus<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">c = </span><span class="s16">Bus</span><span class="s2">.control(s, 5);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p19"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p19"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// In contrast to Ex. 1a and 1b VarGui is called explicitely</span></p>
<p class="p19"><span class="s2">// as control specs should differ.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// Also here the granulation Synth is generated explicitely and not by the interface</span></p>
<p class="p19"><span class="s2">// as its controls have to be mapped to buses</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// start granulation synth paused and register</span></p>
<p class="p19"><span class="s2">// to let VarGui know its state</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">x = </span><span class="s16">Synth</span><span class="s2">.newPaused(</span><span class="s18">\gran_1c</span><span class="s2">, [</span><span class="s18">\bufNum</span><span class="s2">, b]).register;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// map args to be controlled to consecutive subbuses</span></p>
<p class="p12"><span class="s2">x.map(*[[</span><span class="s18">\pos</span><span class="s2">, </span><span class="s18">\trigRate</span><span class="s2">, </span><span class="s18">\granDur</span><span class="s2">, </span><span class="s18">\rate</span><span class="s2">, </span><span class="s18">\panMax</span><span class="s2">], (0..4).collect(c.subBus(</span><span class="s16">_</span><span class="s2">))].flop.flat)</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// Open VarGui interface, granulation synth (#5) is paused</span></p>
<p class="p19"><span class="s2">// (orange button on yellow background).</span></p>
<p class="p19"><span class="s2">// Shift-clicking one of the green buttons runs</span></p>
<p class="p19"><span class="s2">// granulation synth and control synths (#0 - #4).</span></p>
<p class="p19"><span class="s2">// All synths can be paused (orange button) and resumed.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// NOTE: When stopping the granulation synth<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// the linkage with control synths is lost!<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// A new synth generated by the interface<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// (by pressing the blue button of #5) is not</span></p>
<p class="p19"><span class="s2">// automatically mapped to control buses.</span></p>
<p class="p19"><span class="s2">// On the other hand control synths might be stopped and<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// newly generated.</span></p>
<p class="p22"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s16">VarGui</span><span class="s2">(synthCtr: [[</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\pos</span><span class="s3">, 0,<span class="Apple-tab-span">	</span></span><span class="s2">// dummy spec for labelling<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, c.index,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lfoType</span><span class="s2">, [0, 2, </span><span class="s18">\lin</span><span class="s2">, 1, 0],<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// as LFOs are unified, original movement tempo is<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// indicated not by 1 but by 1 / buffer duration</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\freq</span><span class="s2">, [0.01, 20, </span><span class="s18">\exp</span><span class="s2">, 0.0, 1/b.duration],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lo</span><span class="s2">, [0.0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\hi</span><span class="s2">, [0.0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.9]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\trigRate</span><span class="s3">, 1,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, c.index + 1,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lfoType</span><span class="s2">, [0, 2, </span><span class="s18">\lin</span><span class="s2">, 1, 0],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\freq</span><span class="s2">, [0.001, 0.5, </span><span class="s18">\exp</span><span class="s2">, 0.0, 0.2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lo</span><span class="s2">, [1, 100, </span><span class="s18">\lin</span><span class="s2">, 0, 7],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\hi</span><span class="s2">, [1, 100, </span><span class="s18">\lin</span><span class="s2">, 0, 40]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, 2,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, c.index + 2,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lfoType</span><span class="s2">, [0, 2, </span><span class="s18">\lin</span><span class="s2">, 1, 1],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\freq</span><span class="s2">, [0.001, 0.5, </span><span class="s18">\exp</span><span class="s2">, 0.0, 0.4],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lo</span><span class="s2">, [0.01, 0.2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\hi</span><span class="s2">, [0.01, 0.2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.15]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\rate</span><span class="s2">, 3,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, c.index + 3,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lfoType</span><span class="s2">, [0, 2, </span><span class="s18">\lin</span><span class="s2">, 1, 0],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\freq</span><span class="s2">, [0.001, 0.1, </span><span class="s18">\exp</span><span class="s2">, 0.0, 0.03],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lo</span><span class="s2">, [0.1, 3, </span><span class="s18">\lin</span><span class="s2">, 0, 0.6],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\hi</span><span class="s2">, [0.1, 3, </span><span class="s18">\lin</span><span class="s2">, 0, 1.1]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\panMax</span><span class="s3">, 4,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, c.index + 4,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lfoType</span><span class="s2">, [0, 2, </span><span class="s18">\lin</span><span class="s2">, 1, 0],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\freq</span><span class="s2">, [0.001, 0.5, </span><span class="s18">\exp</span><span class="s2">, 0.0, 0.5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\lo</span><span class="s2">, [0.0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.06],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\hi</span><span class="s2">, [0.0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.9]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, 0,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\bufNum</span><span class="s2">, b.bufnum,</span></p>
<p class="p12"><span class="s2"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\posDev</span><span class="s2">, [0.001, 0.2, </span><span class="s18">\exp</span><span class="s2">, 0, 0.02],</span></p>
<p class="p12"><span class="s2"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\amp</span><span class="s2">, [0.0, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.5]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>]],</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></span><span class="s2">// 5 lfo synths are generated by the interface (synthdef name passed)</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// but granulation Synth is passed directly as object</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>synth: </span><span class="s18">\lfo</span><span class="s2">!5 ++ x</span></p>
<p class="p12"><span class="s2">).gui(sliderPriority: </span><span class="s18">\synth</span><span class="s2">, playerPriority: </span><span class="s18">\synth</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 1d: <span class="Apple-converted-space">  </span>Buffer granulation Synth with demand rate ugens</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// Repeated grain triggering within a synth can be defined by demand rate ugens,<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// which is comfortable in connection with granular ugens.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// E.g. with TGrains you can trigger parameters like grain duration, playback rate,<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// position, panning and amp, single grains will keep their params if they overlap.</span></p>
<p class="p19"><span class="s2">// (Note that in the below implementation changes of demand rate array fields will apply</span></p>
<p class="p19"><span class="s2">// also not before the next call of those fields in the synth)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// More refined per-grain control, e.g. per-grain filtering with filter parameter streams,</span></p>
<p class="p19"><span class="s2">// can be done by using a multichannel trick, see Ex. 1e.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// length of demand rate sequence, you might want to check larger sizes</span></p>
<p class="p19"><span class="s2">// in connection with gui arg tryColumnNum &gt; 1</span></p>
<p class="p12"><span class="s21">~n</span><span class="s2"> = 5;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// posRate control range is widened by inventing two controls for<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// mantissa and exponent, so posRate = 1 for init param pair<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// posRateE = 0 and posRateM = 1</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s16">SynthDef</span><span class="s3">(</span><span class="s18">\gran_1d</span><span class="s3">, { </span><span class="s2">|out = 0, soundBuf, posLo = 0.1, posHi = 0.3,<span class="Apple-converted-space"> </span></span></p>
<p class="p20"><span class="s2"><span class="Apple-tab-span">	</span>posRateE = 0, posRateM = 1, granDurMul = 1, rateMul = 1, panMul = 1, amp = 0.5, interp = 2|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">var</span><span class="s2"> signal, bufDur, granDur, granGate, relGranDurs, pos, overlap, overlaps, overlapSeq,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pan, rate, relRates, rateSeq, posRate, granDurSeq;<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// array args for demand rate sequencing, short form of NamedControl<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relGranDurs = </span><span class="s18">\relGranDurs</span><span class="s2">.kr(0.1!</span><span class="s21">~n</span><span class="s2">);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relRates = </span><span class="s18">\relRates</span><span class="s2">.kr(1!</span><span class="s21">~n</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlaps = </span><span class="s18">\overlaps</span><span class="s2">.kr(1!</span><span class="s21">~n</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// Dstutter (or Dunique) necessary as granDurSeq is polled twice: granGate and granDur</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granDurSeq = </span><span class="s16">Dstutter</span><span class="s2">(2, </span><span class="s16">Dseq</span><span class="s2">(relGranDurs, </span><span class="s20">inf</span><span class="s2">)); <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rateSeq = </span><span class="s16">Dseq</span><span class="s2">(relRates, </span><span class="s20">inf</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlapSeq = </span><span class="s16">Dseq</span><span class="s2">(overlaps, </span><span class="s20">inf</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granGate = </span><span class="s16">TDuty</span><span class="s2">.ar(granDurSeq * granDurMul);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granDur = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, granDurSeq * granDurMul);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rate = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, rateSeq) * rateMul;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, </span><span class="s16">Dseq</span><span class="s2">([1, -1], </span><span class="s20">inf</span><span class="s2">)) * 0.999 * panMul;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlap = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, overlapSeq);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDur = </span><span class="s16">BufDur</span><span class="s2">.kr(soundBuf);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = </span><span class="s16">Phasor</span><span class="s2">.ar(0, </span><span class="s16">BufRateScale</span><span class="s2">.kr(soundBuf) * posRate / (</span><span class="s16">SampleRate</span><span class="s2">.ir * bufDur), posLo, posHi);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>signal = </span><span class="s16">TGrains</span><span class="s2">.ar(2, granGate, soundBuf, rate, pos * bufDur, granDur * overlap, pan, 1, interp);</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">Out</span><span class="s2">.ar(out, signal * amp);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}</span></p>
<p class="p12"><span class="s2">).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// relGranDurs are multiplied with granDurMul, analogously relRates with rateMul.</span></p>
<p class="p19"><span class="s2">// Changes of these params apply immediately in contrast to the array args<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// used by demand rate ugens which are used with next demand.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// check out moving a number of sliders of one array by using</span></p>
<p class="p19"><span class="s2">// Shift, Alt + Shift and Ctrl + Shift, see VarGui help Ex. 1c.</span></p>
<p class="p14"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s16">VarGui</span><span class="s2">(synthCtr: [</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>soundBuf: b.bufnum,</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posLo: [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posHi: [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.9],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRateE: [-3, 4, </span><span class="s18">\lin</span><span class="s2">, -1, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRateM: [0.1, 10, </span><span class="s18">\exp</span><span class="s2">, 0.01, 0.5],</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// generating control specifications depending on index</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relGranDurs: { </span><span class="s19">|i|</span><span class="s2"> [0.01, 0.1, </span><span class="s18">\lin</span><span class="s2">, 0, i * 0.005 + 0.02] } ! </span><span class="s21">~n</span><span class="s2">,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granDurMul: [0.03, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.25],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlaps: [0.1, 5, </span><span class="s18">\lin</span><span class="s2">, 0, 1.5] ! </span><span class="s21">~n</span><span class="s2">,</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relRates: { </span><span class="s19">|i|</span><span class="s2"> [0.1, 1.5, </span><span class="s18">\lin</span><span class="s2">, 0, (5-i) * 0.1 + 0.5] } ! </span><span class="s21">~n</span><span class="s2">,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rateMul: [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>panMul: [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.6],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>amp: [0.0, 3, </span><span class="s18">\lin</span><span class="s2">, 0, 2]</span></p>
<p class="p12"><span class="s2">],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>synth: </span><span class="s18">\gran_1d</span></p>
<p class="p12"><span class="s2">).gui(</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// color grouping for better overview</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>synthColorGroups: (0..(</span><span class="s21">~n</span><span class="s2">*3+8)).clumps([1,4,</span><span class="s21">~n</span><span class="s2">+1,</span><span class="s21">~n</span><span class="s2">,</span><span class="s21">~n</span><span class="s2">+1,1,1]),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>labelWidth: 90,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sliderWidth: 280<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 1e: <span class="Apple-converted-space">  </span>Buffer granulation Synth with per-grain effect processing (TGrains)</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// TGrains and other granular ugens allow per-grain processing</span></p>
<p class="p19"><span class="s2">// for a limited number of parameters (pos, rate etc.)</span></p>
<p class="p19"><span class="s2">// Nevertheless it is possible to apply arbitrary effects with</span></p>
<p class="p19"><span class="s2">// per-grain parameter changes, even if grains overlap.</span></p>
<p class="p19"><span class="s2">// This can be achieved by defining the granulation output</span></p>
<p class="p19"><span class="s2">// as a multichannel signal and appropriate triggering of fx parameters.</span></p>
<p class="p19"><span class="s2">// The example is adapted from a recommendation of Julian Rohrhuber.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// The method is elegant but also a bit tricky in terms of</span></p>
<p class="p19"><span class="s2">// multichannel triggering and channel routing.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// the multichannel size and equivalently:</span></p>
<p class="p19"><span class="s2">// the maximum number of overlapping grains that might get</span></p>
<p class="p19"><span class="s2">// different fx parameters have to be fixed.</span></p>
<p class="p19"><span class="s2">// For convenience of later L/R-spatialization we take an<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// even number ~n = 2 * ~m</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s21">~m</span><span class="s2"> = 5;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s21">~n</span><span class="s2"> = 2 * </span><span class="s21">~m</span><span class="s2">;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s16">SynthDef</span><span class="s3">(</span><span class="s18">\gran_1e</span><span class="s3">, { </span><span class="s2">|out = 0, soundBuf, posLo = 0.1, posHi = 0.9,<span class="Apple-converted-space"> </span></span></p>
<p class="p20"><span class="s2"><span class="Apple-tab-span">	</span>posRateE = 0, posRateM = 1, rate = 1, panMax = 0.8, bpRQ = 0.1, bpLo = 50, bpHi = 5000,</span></p>
<p class="p20"><span class="s2"><span class="Apple-tab-span">	</span>amp = 1, bpFund = 100, overlap = 2, trigRate = 1, interp = 2|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">var</span><span class="s2"> sig, sigL, sigR, bpFreq, chan, bpFreqSeqs, dUgen,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trig, trigs, bufDur, pos, posRate;<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trig = </span><span class="s16">Impulse</span><span class="s2">.ar(trigRate);</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// we need a multichannel trigger that steps through all consecutive channels</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trigs = { </span><span class="s19">|i|</span><span class="s2"> </span><span class="s16">PulseDivider</span><span class="s2">.ar(trig, </span><span class="s21">~n</span><span class="s2">, </span><span class="s21">~n</span><span class="s2">-1-i) } ! </span><span class="s21">~n</span><span class="s2">;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>chan = </span><span class="s16">Demand</span><span class="s2">.ar(trig, 0, </span><span class="s16">Dseq</span><span class="s2">((0..</span><span class="s21">~n</span><span class="s2">-1), </span><span class="s20">inf</span><span class="s2">));<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDur = </span><span class="s16">BufDur</span><span class="s2">.kr(soundBuf);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = </span><span class="s16">Phasor</span><span class="s2">.ar(0, </span><span class="s16">BufRateScale</span><span class="s2">.kr(soundBuf) * posRate * </span><span class="s16">SampleDur</span><span class="s2">.ir / bufDur, posLo, posHi);</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sig = </span><span class="s16">TGrains</span><span class="s2">.ar(</span><span class="s21">~n</span><span class="s2">, trig, soundBuf, rate, pos * bufDur, overlap/trigRate,<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// Panning convention is that from PanAz,</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// speakers should be from 0 to 2, but (orientation)</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// 1/n has to be substracted for n speakers.</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// If this isn't done correctly grains are spread onto more than one channel</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// and per-grain application of fxs fails.</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chan.linlin(0, </span><span class="s21">~n</span><span class="s2">-1, -1/</span><span class="s21">~n</span><span class="s2">, (2*</span><span class="s21">~n</span><span class="s2"> - 3)/</span><span class="s21">~n</span><span class="s2">), 1, interp);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>dUgen = </span><span class="s16">Dwhite</span><span class="s2">(0.0, 1);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sig = sig.collect { </span><span class="s19">|ch, i|</span><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// this is the place to define fxs per channel/grain</span></p>
<p class="p19"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>// multichannel trigger is polling from a single demand ugen</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bpFreq = </span><span class="s16">Demand</span><span class="s2">.ar(trigs[i], 0, dUgen).linlin(0, 1, bpLo, bpHi);<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// amplitude compensation for lower rq of bandpass filter</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">BPF</span><span class="s2">.ar(ch, bpFreq, bpRQ, (bpRQ ** -1) * (400 / bpFreq ** 0.5));<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>};</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// routing to two channels ...</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sigL = </span><span class="s16">Mix</span><span class="s2">(((0..(</span><span class="s21">~m</span><span class="s2">-1)) * 2).collect(sig[</span><span class="s16">_</span><span class="s2">]));<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sigR = </span><span class="s16">Mix</span><span class="s2">(((0..(</span><span class="s21">~m</span><span class="s2">-1)) * 2 + 1).collect(sig[</span><span class="s16">_</span><span class="s2">]));<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// ... in order to have L/R-spreading with panMax as in other examples</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">Out</span><span class="s2">.ar(0, </span><span class="s16">Pan2</span><span class="s2">.ar(sigL, panMax.neg) + </span><span class="s16">Pan2</span><span class="s2">.ar(sigR, panMax) * amp)<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p12"><span class="s2">)<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s16">VarGui</span><span class="s2">(synthCtr: [</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>soundBuf: b.bufnum,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posLo: [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posHi: [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRateE: [-3, 4, </span><span class="s18">\lin</span><span class="s2">, -1, -1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRateM: [0.1, 10, </span><span class="s18">\exp</span><span class="s2">, 0.01, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlap: [0.1, </span><span class="s21">~n</span><span class="s2">, </span><span class="s18">\lin</span><span class="s2">, 0, 12],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>trigRate: [1, 100, </span><span class="s18">\lin</span><span class="s2">, 0, 45],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rate: [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 1],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bpRQ: [0.05, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.25],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bpLo: [50.0, 5000, </span><span class="s18">\exp</span><span class="s2">, 0, 50],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bpHi: [50.0, 5000, </span><span class="s18">\exp</span><span class="s2">, 0, 5000],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>panMax: [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.85],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>amp: [0.0, 3, </span><span class="s18">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p12"><span class="s2">],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>synth: </span><span class="s18">\gran_1e</span></p>
<p class="p12"><span class="s2">).gui(</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>synthColorGroups: (0..12).clumps([1,4,2,1,3,1,1])<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 1f: <span class="Apple-converted-space">  </span>Buffer granulation Synth with per-grain effect processing (DXEnvFan)</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// DXEnvFan generates a multichannel envelope which can be used as trigger for granulation and fxs on grains.</span></p>
<p class="p19"><span class="s2">// It encapsulates the trigger logic, which has been used explicitely in Ex. 1e.</span></p>
<p class="p19"><span class="s2">// DX ugens can be used for a variety of microsound techniques, see their help files.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p24"><span class="s2">~maxOverlap</span><span class="s3"> = 12;</span></p>
<p class="p12"><span class="s2">a = </span><span class="s16">Bus</span><span class="s2">.audio(s, </span><span class="s21">~maxOverlap</span><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// overlap only settable in SC versions &gt;= 3.9</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s16">SynthDef</span><span class="s3">(</span><span class="s18">\gran_1f</span><span class="s3">, { </span><span class="s2">|out = 0, soundBuf, bus = 0, posLo = 0.1, posHi = 0.9,</span></p>
<p class="p20"><span class="s2"><span class="Apple-converted-space">    </span>posRateE = 0, posRateM = 1, overlap = 2, trigRate = 1, rate = 1,<span class="Apple-converted-space"> </span></span></p>
<p class="p20"><span class="s2"><span class="Apple-tab-span">	</span>bpRQ = 0.1, bpLo = 50, bpHi = 5000, panMax = 0.8, amp = 1|</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span></span><span class="s19">var</span><span class="s2"> sig, bpFreq, dUgen, bufDur, pos, posRate, playbuf, env, maxOverlap = </span><span class="s21">~maxOverlap</span><span class="s2">;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>posRate = 10 ** posRateE * posRateM;</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>bufDur = </span><span class="s16">BufDur</span><span class="s2">.kr(soundBuf);</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>pos = </span><span class="s16">Phasor</span><span class="s2">.ar(0, </span><span class="s16">BufRateScale</span><span class="s2">.kr(soundBuf) * posRate * </span><span class="s16">SampleDur</span><span class="s2">.ir / bufDur, posLo, posHi);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// multichannel trigger</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>env = </span><span class="s16">DXEnvFan</span><span class="s2">.ar(</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span></span><span class="s16">Dseq</span><span class="s2">((0..maxOverlap-1), </span><span class="s20">inf</span><span class="s2">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>trigRate.reciprocal,</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>size: maxOverlap,</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>maxWidth: maxOverlap,</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>width: (</span><span class="s16">Main</span><span class="s2">.versionAtLeast(3, 9)).if { overlap }{ 2 },</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">// option to avoid unwanted triggers</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>zeroThr: 0.002,</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">// take equalPower = 0 for non-squared sine envelopes</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">// more efficient with helper bus</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>equalPower: 0,</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>bus: a</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// multichannel playback, pos is triggered for each grain</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>playbuf = </span><span class="s16">PlayBuf</span><span class="s2">.ar(1, soundBuf, rate, env, pos * </span><span class="s16">BufFrames</span><span class="s2">.ir(soundBuf), 1);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>dUgen = </span><span class="s16">Dwhite</span><span class="s2">(0, 1);</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// multichannel trigger used to poll values from drate ugen</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>bpFreq = </span><span class="s16">Demand</span><span class="s2">.ar(env, 0, dUgen).linlin(0, 1, bpLo, bpHi);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// generate grains by multiplying with envelope</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>sig = playbuf * env;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// different frequency on each grain channel</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>sig = </span><span class="s16">BPF</span><span class="s2">.ar(sig, bpFreq, bpRQ, (bpRQ ** -1) * (400 / bpFreq ** 0.5));</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// generate array of 5 stereo signals</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>sig = </span><span class="s16">Pan2</span><span class="s2">.ar(sig, </span><span class="s16">Demand</span><span class="s2">.ar(env, 0, </span><span class="s16">Dseq</span><span class="s2">([-1, 1], </span><span class="s20">inf</span><span class="s2">) * panMax));</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">// mix to out</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span></span><span class="s16">Out</span><span class="s2">.ar(0, </span><span class="s16">Mix</span><span class="s2">(sig) * amp)</span></p>
<p class="p12"><span class="s2">}, metadata: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>specs: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>posLo: [0.01, 0.99, </span><span class="s18">\lin</span><span class="s2">, 0.01, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>posHi: [0.01, 0.99, </span><span class="s18">\lin</span><span class="s2">, 0.01, 0.5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>posRateE: [-3, 4, </span><span class="s18">\lin</span><span class="s2">, 1, -1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>posRateM: [0.1, 10, </span><span class="s18">\exp</span><span class="s2">, 0.01, 1.35],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>trigRate: [1, 200, </span><span class="s18">\lin</span><span class="s2">, 0.01, 90],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>overlap: [0.2, 12, </span><span class="s18">\lin</span><span class="s2">, 0.01, 7],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>rate: [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0.01, 0.75],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>panMax: [0.0, 1, </span><span class="s18">\lin</span><span class="s2">, 0.005, 0.75],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>bpLo: [100, 5000, </span><span class="s18">\lin</span><span class="s2">, 0, 300],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>bpHi: [100, 5000, </span><span class="s18">\lin</span><span class="s2">, 0, 3000],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>bpRQ: [0.05, 1, </span><span class="s18">\lin</span><span class="s2">, 0, 0.18],</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">        </span>amp: [0.0, 3, </span><span class="s18">\lin</span><span class="s2">, 0.005, 1]</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>)</span></p>
<p class="p12"><span class="s2">)).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p19"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p19"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s18">\gran_1f</span><span class="s2">.sVarGui([</span><span class="s18">\soundBuf</span><span class="s2">, b.bufnum]).gui(</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>tryColumnNum: 1,</span></p>
<p class="p12"><span class="s2"><span class="Apple-converted-space">    </span>synthColorGroups: (0..12).clumps([1,4,2,1,3,1,1])</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>2.) Granulation driven by language</b></span></p>
<p class="p10"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>NOTE:</b><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">Language-driven sequencing is not sample-exact in realtime (with NRT synthesis it is). This is related to hardware control and cannot be overcome currently. However for most practical purposes this might not be relevant. It is anyway a far less strong effect than the inaccuracies related to Out.ar and the combination of OffsetOut.ar and In.ar (see examples 2a-d in <a href="Live Granulation.html"><span class="s5">Live Granulation</span></a>)</span></p>
<p class="p25"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 2a: <span class="Apple-converted-space">  </span>Basic buffer granulation Pbind</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Control parameters like in 1a, but implemented with a SynthDef for</span></p>
<p class="p13"><span class="s2">// playing single grains and an appropriate Pbind,</span></p>
<p class="p13"><span class="s2">// OffsetOut used for exact timing.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p26"><span class="s2">SynthDef</span><span class="s3">(</span><span class="s15">\gran_2a</span><span class="s3">, { </span><span class="s2">|out = 0, pos = 0, sndBuf = 0, windowBuf = 1, granDur = 0.1,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span>rate = 1, loop = 1, panMax = 0, amp = 1|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> window, src;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>src = </span><span class="s14">PlayBuf</span><span class="s2">.ar(1, sndBuf, </span><span class="s14">BufRateScale</span><span class="s2">.kr(sndBuf) * rate,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1, round(pos * </span><span class="s14">BufFrames</span><span class="s2">.kr(sndBuf)), loop, 2);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>window = </span><span class="s14">BufRd</span><span class="s2">.ar(1, windowBuf,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">EnvGen</span><span class="s2">.ar(</span><span class="s14">Env</span><span class="s2">([0, </span><span class="s14">BufFrames</span><span class="s2">.kr(windowBuf)], [granDur]),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>doneAction: 2), loop, 4);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">OffsetOut</span><span class="s2">.ar(out, </span><span class="s14">Pan2</span><span class="s2">.ar(src, panMax, amp) * window);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">w = </span><span class="s14">Buffer</span><span class="s2">.sendCollection(s, </span><span class="s14">Signal</span><span class="s2">.hanningWindow(1024));</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// Determining the correct buffer position depending on</span></p>
<p class="p17"><span class="s2">// posRate, posLo and posHi needs a little calculation.</span></p>
<p class="p17"><span class="s2">// In 1a this was done inside the ugen by a Phasor.</span></p>
<p class="p17"><span class="s2">// See Ex. 3b, 3c for doing position movement with a separate Synth.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// PL placeholder patterns used, could also be Pfunc { ~ ... }</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s2">p = </span><span class="s14">Pbind</span><span class="s2">(<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\gran_2a</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\sndBuf</span><span class="s3">, b,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\windowBuf</span><span class="s3">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, 1 / </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\trigRate</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\granDur</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\time</span><span class="s2">, </span><span class="s14">Ptime</span><span class="s2">(),</span></p>
<p class="p26"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s15">\pos</span><span class="s3">, </span><span class="s2">Pfunc</span><span class="s3"> { </span><span class="s2">|e|</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> relTime = ~posRate * e.time / e.sndBuf.duration, relDif;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relDif = ~posHi - ~posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relTime + rand2(~posDev) % relDif + ~posLo;<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>},</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rate</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\rate</span><span class="s3">), <span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">([-1,1]) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\panMax</span><span class="s2">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, 0</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posLo</span><span class="s2">, [0.0, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posHi</span><span class="s2">, [0.0, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posRate</span><span class="s2">, [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posDev</span><span class="s2">, [0, 0.2, 5, 0, 0.01],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRate</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 120],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDur</span><span class="s2">, [0.01, 0.3, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.06],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rate</span><span class="s2">, [0.1, 3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.25]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>], stream: p</span></p>
<p class="p12"><span class="s2">).gui(varColorGroups: (0..8).clumps([4,1,1,1,1,1]))<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 2b: <span class="Apple-converted-space">  </span>Switching between stochastic distributions</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Extended basic SynthDef from Ex.2a with bandpass filter</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p26"><span class="s2">SynthDef</span><span class="s3">(</span><span class="s15">\gran_2b</span><span class="s3">, { </span><span class="s2">|out = 0, pos = 0, sndBuf = 0, windowBuf = 1, granDur = 0.1,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span>rate = 1, loop = 1, panMax = 0, amp = 1, bpFreq = 500, bpRQ = 0.5, bpWet = 1|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> window, granSrc, src;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granSrc = </span><span class="s14">PlayBuf</span><span class="s2">.ar(1, sndBuf, </span><span class="s14">BufRateScale</span><span class="s2">.kr(sndBuf) * rate,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1, round(pos * </span><span class="s14">BufFrames</span><span class="s2">.kr(sndBuf)), loop, 2);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>window = </span><span class="s14">BufRd</span><span class="s2">.ar(1, windowBuf,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">EnvGen</span><span class="s2">.ar(</span><span class="s14">Env</span><span class="s2">([0, </span><span class="s14">BufFrames</span><span class="s2">.kr(windowBuf)], [granDur]),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>doneAction: 2), loop, 4);</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// do amplitude compensation, estimation like in Wavesets example by Alberto de Campo<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>src = (</span><span class="s14">BPF</span><span class="s2">.ar(granSrc, bpFreq, bpRQ, mul: (bpRQ ** -1) * (400 / bpFreq ** 0.5)) *<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bpWet + (granSrc * (1 - bpWet)));</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">OffsetOut</span><span class="s2">.ar(out, </span><span class="s14">Pan2</span><span class="s2">.ar(src, panMax, amp) * window);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">w = </span><span class="s14">Buffer</span><span class="s2">.sendCollection(s, </span><span class="s14">Signal</span><span class="s2">.hanningWindow(1024));</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// random types</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// 0: low value</span></p>
<p class="p13"><span class="s2">// 1: low or high value, evenly distributed</span></p>
<p class="p13"><span class="s2">// 2: evenly distributed</span></p>
<p class="p13"><span class="s2">// 3: linear decrease from mean value</span></p>
<p class="p13"><span class="s2">// 4: exponential distribution</span></p>
<p class="p13"><span class="s2">// 5: beta distribution, default parameter 0.3 centers value at the borders</span></p>
<p class="p13"><span class="s2">// 6: brownian movement (of first order)<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// 7: brownian movement of second order (stepsize itself generated by brownian movement)<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// A second order brownian movement much more tends to get stuck at the</span></p>
<p class="p13"><span class="s2">// borders than a normal (first order) brownian movement</span></p>
<p class="p13"><span class="s2">// E.g. see Sergio Luque's presentation of Xenakis's stochastic synthesis:</span></p>
<p class="p13"><span class="s2">// "Stochastic Synthesis, Origins and Extensions", pp 25-28<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// http://sergioluque.com</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// Function that generates an array of PLx patterns</span></p>
<p class="p17"><span class="s2">// of different random types (see <a href="PLx suite.html"><span class="s22">PLx suite</span></a>).</span></p>
<p class="p17"><span class="s2">// These placeholders can refer to environmental variables</span></p>
<p class="p17"><span class="s2">// to be set by the VarGui interface later on.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p26"><span class="s3">d = { </span><span class="s2">|keyLo, keyHi, betaProb = 0.3, brownStepFac = 0.01,</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span>brown2Ratio = 1, brown2StepFac = 0.01|</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// keyLo and keyHi must be Symbols,</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// other args may be Symbols</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> patLo, patHi, patDif;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// avoid lo-hi reversing with Pbrown</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>patLo = min(</span><span class="s14">PL</span><span class="s2">(keyLo), </span><span class="s14">PL</span><span class="s2">(keyHi));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>patHi = max(</span><span class="s14">PL</span><span class="s2">(keyLo), </span><span class="s14">PL</span><span class="s2">(keyHi));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>patDif = patHi - patLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>[<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PL</span><span class="s2">(keyLo),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Pfunc</span><span class="s2"> { currentEnvironment[[keyLo, keyHi].choose] },</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PLwhite</span><span class="s2">(keyLo, keyHi),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PLmeanrand</span><span class="s2">(keyLo, keyHi),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PLexprand</span><span class="s2">(keyLo, keyHi),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PLbeta</span><span class="s2">(keyLo, keyHi, betaProb, betaProb),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PLbrown</span><span class="s2">(patLo, patHi, patDif * </span><span class="s14">PL</span><span class="s2">(brownStepFac)),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">PLbrown</span><span class="s2">(patLo, patHi,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">PLbrown</span><span class="s3">(</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span>patDif.neg * </span><span class="s14">PL</span><span class="s2">(brown2Ratio) / 2,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span>patDif * </span><span class="s14">PL</span><span class="s2">(brown2Ratio) / 2,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span>patDif * </span><span class="s14">PL</span><span class="s2">(brown2Ratio) * </span><span class="s14">PL</span><span class="s2">(brown2StepFac)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>]</span></p>
<p class="p12"><span class="s2">};</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// trigrate, granDur, rate and bpFreq are<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// chosen between bounds according to the<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// random distribution type notated with suffix D</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// single grains are filtered with a bandpass</span></p>
<p class="p13"><span class="s2">// amount of effect controlled with bpWet</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s2">p = </span><span class="s14">Pbind</span><span class="s2">(<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\gran_2b</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\sndBuf</span><span class="s3">, b,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\windowBuf</span><span class="s3">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, 1 / </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\trigRateLo</span><span class="s3">, </span><span class="s2">\trigRateHi</span><span class="s3">), </span><span class="s2">\trigRateD</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\granDurLo</span><span class="s3">, </span><span class="s2">\granDurHi</span><span class="s3">), </span><span class="s2">\granDurD</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\time</span><span class="s2">, </span><span class="s14">Ptime</span><span class="s2">(),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\posRate</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\posRate</span><span class="s3">), <span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s15">\pos</span><span class="s3">, </span><span class="s2">Pfunc</span><span class="s3"> { </span><span class="s2">|e|</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> relTime = ~posRate * e.time / e.sndBuf.duration, relDif;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relDif = ~posHi - ~posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relTime + rand2(~posDev) % relDif + ~posLo;<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>},</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rate</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\rateLo</span><span class="s3">, </span><span class="s2">\rateHi</span><span class="s3">), </span><span class="s2">\rateD</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpFreq</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\bpFreqLo</span><span class="s3">, </span><span class="s2">\bpFreqHi</span><span class="s3">), </span><span class="s2">\bpFreqD</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpRQ</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\bpRQ</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpWet</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\bpWet</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">([-1,1]) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\panMax</span><span class="s2">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, 0</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posLo</span><span class="s2">, [0.0, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.21],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posHi</span><span class="s2">, [0.0, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.47],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posRate</span><span class="s2">, [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posDev</span><span class="s2">, [0, 0.2, 5, 0, 0.002],</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRateLo</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 21],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRateHi</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 155],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRateD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 6],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDurLo</span><span class="s2">, [0.01, 0.6, </span><span class="s15">\exp</span><span class="s2">, 0.0, 0.037],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDurHi</span><span class="s2">, [0.01, 0.6, </span><span class="s15">\exp</span><span class="s2">, 0.0, 0.4],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDurD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 6],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateLo</span><span class="s2">, [0.1, 3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1.09],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateHi</span><span class="s2">, [0.1, 3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1.63],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 1],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqLo</span><span class="s2">, [50, 10000, </span><span class="s15">\exp</span><span class="s2">, 0.1, 54],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqHi</span><span class="s2">, [50, 10000, </span><span class="s15">\exp</span><span class="s2">, 0.1,8275],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpRQ</span><span class="s2">, [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.07],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpWet</span><span class="s2">, [0.0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.0, 0.23],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.85],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.25]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>], stream: p</span></p>
<p class="p12"><span class="s2">).gui(varColorGroups: (0..19).clumps([4,3,3,3,5,1,1]))</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 2c: <span class="Apple-converted-space">  </span>Generating granular phrases with Pspawner</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// This example needs SynthDef \gran_2b and Function d to be taken from Ex. 2b</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">w = </span><span class="s14">Buffer</span><span class="s2">.sendCollection(s, </span><span class="s14">Signal</span><span class="s2">.hanningWindow(1024));</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// A simple form of Pspawner is used to generate phrases.</span></p>
<p class="p13"><span class="s2">// Phrase length params are taken a bit roughly as sustain and<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// rest times also depend on randomly varying grain lengths.</span></p>
<p class="p13"><span class="s2">// spSustain controls medium sustain time (without grain length overhead)</span></p>
<p class="p13"><span class="s2">// spLegato controls medium legato factor (disregarding reduction by grain length overhead)</span></p>
<p class="p13"><span class="s2">// spDev is causing separate random deviation of spSustain and spLegato<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// between 1/(1+spDev) and 1+spDev</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// random distribution switching is restricted here to</span></p>
<p class="p13"><span class="s2">// types 6 and 7 (random walks of first and second order)</span></p>
<p class="p13"><span class="s2">// to force individual sound qualities of phrases.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p13"><span class="s2">// declare var here as pattern is repeatedly evaluated from within the Pspawner,</span></p>
<p class="p13"><span class="s2">// interpreter variable would be unsafe if running examples in parallel</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">var</span><span class="s3"> p = </span><span class="s2">Pbind</span><span class="s3">(<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\gran_2b</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\sndBuf</span><span class="s3">, b,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\windowBuf</span><span class="s3">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, 1 / </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\trigRateLo</span><span class="s3">, </span><span class="s2">\trigRateHi</span><span class="s3">), </span><span class="s2">\trigRateD</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\granDurLo</span><span class="s3">, </span><span class="s2">\granDurHi</span><span class="s3">), </span><span class="s2">\granDurD</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\time</span><span class="s2">, </span><span class="s14">Ptime</span><span class="s2">(),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\posRate</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\posRate</span><span class="s3">), <span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// random timeOffset added with each spawning</span></p>
<p class="p26"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s15">\pos</span><span class="s3">, </span><span class="s2">Pfunc</span><span class="s3"> { </span><span class="s2">|e|</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> relTime = ~posRate * e.time / e.sndBuf.duration + e.timeOffset, relDif;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relDif = ~posHi - ~posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relTime + rand2(~posDev) % relDif + ~posLo;<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>},</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rate</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\rateLo</span><span class="s3">, </span><span class="s2">\rateHi</span><span class="s3">), </span><span class="s2">\rateD</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpFreq</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\bpFreqLo</span><span class="s3">, </span><span class="s2">\bpFreqHi</span><span class="s3">), </span><span class="s2">\bpFreqD</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpRQ</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\bpRQ</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpWet</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\bpWet</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">([-1,1]) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\panMax</span><span class="s2">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, 0</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s3">q = </span><span class="s2">Pspawner</span><span class="s3">({ </span><span class="s2">|sp|</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> randomizer = { </span><span class="s14">|x|</span><span class="s2"> </span><span class="s14">var</span><span class="s2"> y = rand(x); 0.5.coin.if { 1 + y }{ 1 / (1 + y) } },</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sus, legato, delta;<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>loop {</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sus = ~spSustain * randomizer.(~spDev);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>legato = ~spLegato * randomizer.(~spDev);</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// take random offset for each phrase</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sp.par(</span><span class="s14">Pfindur</span><span class="s2">(sus, </span><span class="s14">Psetpre</span><span class="s2">(</span><span class="s15">\timeOffset</span><span class="s2">, 5.0.rand, p)));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>delta = sus / (~spLegato * randomizer.(~spDev));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sp.wait(delta)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>}</span></p>
<p class="p12"><span class="s2">});</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posLo</span><span class="s2">, [0.0, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.16],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posHi</span><span class="s2">, [0.0, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.41],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posRate</span><span class="s2">, [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1.4],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posDev</span><span class="s2">, [0, 0.2, 5, 0, 0.0017],</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRateLo</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 70],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRateHi</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 150],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\trigRateD</span><span class="s2">, [6, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 7],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDurLo</span><span class="s2">, [0.01, 0.6, </span><span class="s15">\exp</span><span class="s2">, 0.0, 0.02],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDurHi</span><span class="s2">, [0.01, 0.6, </span><span class="s15">\exp</span><span class="s2">, 0.0, 0.11],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\granDurD</span><span class="s2">, [6, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 6],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateLo</span><span class="s2">, [0.1, 3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateHi</span><span class="s2">, [0.1, 3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1.86],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateD</span><span class="s2">, [6, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 7],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqLo</span><span class="s2">, [50, 10000, </span><span class="s15">\exp</span><span class="s2">, 0.1, 67],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqHi</span><span class="s2">, [50, 10000, </span><span class="s15">\exp</span><span class="s2">, 0.1, 5885],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqD</span><span class="s2">, [6, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 6],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpRQ</span><span class="s2">, [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.17],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpWet</span><span class="s2">, [0.0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.0, 0.38],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\spSustain</span><span class="s2">, [0.2, 2, </span><span class="s15">\linear</span><span class="s2">, 0.0, 0.884],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\spLegato</span><span class="s2">, [0.6, 1.2, </span><span class="s15">\linear</span><span class="s2">, 0.0, 0.996],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\spDev</span><span class="s2">, [0.0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.0, 0.41],</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.85],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.35]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>], stream: q</span></p>
<p class="p12"><span class="s2">).gui(varColorGroups: (0..22).clumps([4,3,3,3,5,3,1,1]) )</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 2d: <span class="Apple-converted-space">  </span>Wave sets</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// For this example you need Alberto de Campo's Wavesets class<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// (Quark extension, implementation following definitions of Trevor Wishart)</span></p>
<p class="p13"><span class="s2">// and the Function d from Ex. 2b</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// the wave set player synth optionally adds a BPF applied to the signal,<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// amount can be controlled with bpWet</span></p>
<p class="p13"><span class="s2">// attack and release time &gt; 0 for smoothening</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s15">\wsPlayer</span><span class="s2">, { </span><span class="s14">arg</span><span class="s2"> out = 0, buf = 0, start = 0, length = 441,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rate = 1, att = 0.03, rel = 0.03, wvDur = 1, panMax = 0, amp = 0.2,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>delayL = 0.0, delayR = 0.0, bpFreq = 500, bpRQ = 0.5, bpWet = 1;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> phasor, env, granSrc, src, attEff, relEff, sus;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>phasor = </span><span class="s14">Phasor</span><span class="s2">.ar(0, </span><span class="s14">BufRateScale</span><span class="s2">.ir(buf) * rate, 0, length) + start;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>attEff = min(att, wvDur/2);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relEff = min(rel, wvDur/2);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sus = wvDur - attEff - relEff;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s14">EnvGen</span><span class="s2">.ar(</span><span class="s14">Env</span><span class="s2">([0, 1, 1, 0], [attEff, sus, relEff], </span><span class="s15">\sine</span><span class="s2">), doneAction: 2);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granSrc = </span><span class="s14">BufRd</span><span class="s2">.ar(1, buf, phasor);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>src = (</span><span class="s14">BPF</span><span class="s2">.ar(granSrc, bpFreq, bpRQ, mul: (bpRQ ** -1) * (400 / bpFreq ** 0.5)) *<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bpWet + (granSrc * (1 - bpWet)));</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">OffsetOut</span><span class="s2">.ar(out, </span><span class="s14">Pan2</span><span class="s2">.ar(src, panMax, amp) * env);</span></p>
<p class="p12"><span class="s2">}).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">a = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p19"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p19"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s14">Buffer</span><span class="s2">.read(s, a);</span></p>
<p class="p12"><span class="s2">w = </span><span class="s14">Wavesets</span><span class="s2">.from(a);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// relative positions of zero crossings</span></p>
<p class="p12"><span class="s2">x = w.fracXings.drop(-1) / w.numFrames;</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Note that trigRate / event duration is not controlled directly in this setup,</span></p>
<p class="p13"><span class="s2">// it's derived from wave set length (may vary) and legato factor.<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// For short wave sets and a low legato value durs could become so short that<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// a sudden mass of grains could cause hangs.</span></p>
<p class="p13"><span class="s2">// To avoid this a parameter maxTrigRate is invented.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// As wavesets start at distinguished positions in the buffer and<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// - together with legato - durations are determined,</span></p>
<p class="p13"><span class="s2">// an additionally given position rate in general cannot result in a "correct"</span></p>
<p class="p13"><span class="s2">// looping through the buffer, there will be a deviation.</span></p>
<p class="p13"><span class="s2">// Here two types of approximation can be choosen with posType:</span></p>
<p class="p13"><span class="s2">// Type 0 takes the waveset nearest to the calculated exact position.</span></p>
<p class="p13"><span class="s2">// Type 1 linearly maps positions to wave set indices.</span></p>
<p class="p13"><span class="s2">// As wave sets are of different length the latter is a rough heuristic</span></p>
<p class="p13"><span class="s2">// accelerating buffer parts with relatively low frequencies.<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">(</span></p>
<p class="p12"><span class="s2">p = </span><span class="s14">Pbind</span><span class="s2">(</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\wsPlayer</span><span class="s3">,</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// refering to interpreter variables within Pfuncs<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// when running several examples in parallel is unsafe,</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// so pass them here, then access from within the event</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\b</span><span class="s2">, b,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\w</span><span class="s2">, w,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\x</span><span class="s2">, x,</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\time</span><span class="s2">, </span><span class="s14">Ptime</span><span class="s2">(),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\posLo</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\posLo</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\posHi</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\posHi</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\posRate</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\posRate</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\pos</span><span class="s2">, </span><span class="s14">Pfunc</span><span class="s2"> { </span><span class="s14">|e|</span><span class="s2"> (e.time * e.posRate / e.b.duration) %<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(e.posHi - e.posLo) + e.posLo },</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// Estimation of ws index from relative position, see explanation above,</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// indexIn might be a bottleneck with large buffers,</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// also a more rough estimation of ws index could be used:</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// \startWs, Pfunc { |e| e.pos.linlin(0, 1, 0, e.w.xings.size - 2).round.asInteger }</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\startWs</span><span class="s3">, </span><span class="s14">Pfunc</span><span class="s3"> { </span><span class="s14">|e|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(~posType == 0).if {</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>e.x.indexIn(e.pos)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}{</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>e.pos.linlin(e.posLo, e.posHi, e.x.indexIn(e.posLo), e.x.indexIn(e.posHi))</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.round.asInteger<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>},</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\numWs</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\numWsLo</span><span class="s3">, </span><span class="s2">\numWsHi</span><span class="s3">), </span><span class="s2">\numWsD</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\repeats</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\repeatsLo</span><span class="s3">, </span><span class="s2">\repeatsHi</span><span class="s3">), </span><span class="s2">\repeatsD</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpFreq</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\bpFreqLo</span><span class="s3">, </span><span class="s2">\bpFreqHi</span><span class="s3">), </span><span class="s2">\bpFreqD</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpRQ</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\bpRQ</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\bpWet</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\bpWet</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rate</span><span class="s3">, </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\rateLo</span><span class="s3">, </span><span class="s2">\rateHi</span><span class="s3">), </span><span class="s2">\rateD</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\data</span><span class="s2">, </span><span class="s14">Pfunc</span><span class="s2"> { </span><span class="s14">|e|</span><span class="s2"> e.w.frameFor(e.startWs, e.numWs)<span class="Apple-converted-space">  </span>},</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\buf</span><span class="s2">, b.bufnum,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\start</span><span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span><span class="s15">\data</span><span class="s2">).collect(</span><span class="s14">_</span><span class="s2">[0]), </span><span class="s23">// startFrame</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\length</span><span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span><span class="s15">\data</span><span class="s2">).collect(</span><span class="s14">_</span><span class="s2">[1]), </span><span class="s23">// length (frameNum)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\wvDur</span><span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span><span class="s15">\data</span><span class="s2">).collect(</span><span class="s14">_</span><span class="s2">[2]) * </span><span class="s14">Pkey</span><span class="s2">(</span><span class="s15">\repeats</span><span class="s2">), </span><span class="s23">// sustain time</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\calculatedDur</span><span class="s3">, </span><span class="s14">Pkey</span><span class="s3">(</span><span class="s2">\wvDur</span><span class="s3">) / </span><span class="s14">PLswitch1</span><span class="s3">(d.(</span><span class="s2">\legatoLo</span><span class="s3">, </span><span class="s2">\legatoHi</span><span class="s3">), </span><span class="s2">\legatoD</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\dur</span><span class="s2">, </span><span class="s14">Pfunc</span><span class="s2"> { </span><span class="s14">|e|</span><span class="s2"> max(e.calculatedDur, 1 / ~maxTrigRate) },</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">([-1,1]) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\panMax</span><span class="s2">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, 0</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posLo</span><span class="s2">, [0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.15],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posHi</span><span class="s2">, [0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.45],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posRate</span><span class="s2">, [0.0, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.25],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\posType</span><span class="s2">, [0, 1, </span><span class="s15">\lin</span><span class="s2">, 1, 0],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\numWsLo</span><span class="s2">, [1, 100, </span><span class="s15">\lin</span><span class="s2">, 1, 5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\numWsHi</span><span class="s2">, [1, 100, </span><span class="s15">\lin</span><span class="s2">, 1, 23],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\numWsD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 6],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\repeatsLo</span><span class="s2">, [1, 4, </span><span class="s15">\lin</span><span class="s2">, 1, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\repeatsHi</span><span class="s2">, [1, 4, </span><span class="s15">\lin</span><span class="s2">, 1, 2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\repeatsD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 6],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\maxTrigRate</span><span class="s2">, [1, 250, </span><span class="s15">\lin</span><span class="s2">, 1, 200],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqLo</span><span class="s2">, [50, 10000, </span><span class="s15">\exp</span><span class="s2">, 0.1, 67],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqHi</span><span class="s2">, [50, 10000, </span><span class="s15">\exp</span><span class="s2">, 0.1, 9600],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpFreqD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 7],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpRQ</span><span class="s2">, [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.22],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\bpWet</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.0],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateLo</span><span class="s2">, [0.05, 2, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.32],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateHi</span><span class="s2">, [0.05, 2, </span><span class="s15">\lin</span><span class="s2">, 0.0, 1.3],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rateD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 7],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\att</span><span class="s2">, [0.0, 0.05, </span><span class="s15">\lin</span><span class="s2">, 0.001, 0.001], <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rel</span><span class="s2">, [0.0, 0.05, </span><span class="s15">\lin</span><span class="s2">, 0.001, 0.001],<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\legatoLo</span><span class="s2">, [0.3, 25, </span><span class="s15">\exp</span><span class="s2">, 0, 0.4],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\legatoHi</span><span class="s2">, [0.3, 25, </span><span class="s15">\exp</span><span class="s2">, 0, 5.5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\legatoD</span><span class="s2">, [0, 7, </span><span class="s15">\lin</span><span class="s2">, 1, 7],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, [0.0, 2.0, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.7] <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>stream: p</span></p>
<p class="p12"><span class="s2">).gui(varColorGroups: (0..25).clumps([4,3,3,1,5,3,2,1,3,1]))</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>3.) Hybrid Implementations</b></span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 3a: <span class="Apple-converted-space">  </span>Granulation with ugen plus step sequencing</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Here the trigger for the TGrains ugen comes from a Pbind</span></p>
<p class="p13"><span class="s2">// which also generates rates like a step sequencer</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s15">\gran_3a</span><span class="s2">, { </span><span class="s14">arg</span><span class="s2"> out = 0, posLo = 0.0, posHi = 1.0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRate = 1, posDev = 0.01, bufNum = 0, t_trig = 0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granDur = 0.1, t_rate = 1.0, rateDev = 0,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>panMax = 1, amp = 0.1, interp = 4;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> pan, pos, bufDur, bufDurSection, posDif;</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDur = </span><span class="s14">BufDur</span><span class="s2">.kr(bufNum);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDurSection = bufDur * posDif;<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = posLo * bufDur +</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</span><span class="s14">Phasor</span><span class="s2">.ar(0, </span><span class="s14">BufRateScale</span><span class="s2">.kr(bufNum) * posRate / </span><span class="s14">SampleRate</span><span class="s2">.ir, posLo * bufDur, posHi * bufDur) +<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</span><span class="s14">TRand</span><span class="s2">.kr(-0.5, 0.5, t_trig) * posDev * bufDur)).mod(bufDurSection); <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s14">Demand</span><span class="s2">.kr(t_trig, 0, </span><span class="s14">Dseq</span><span class="s2">([panMax, panMax.neg], </span><span class="s14">inf</span><span class="s2">) * 0.999);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out, </span><span class="s14">TGrains</span><span class="s2">.ar(2, t_trig, bufNum, t_rate, pos, granDur, pan, 1, interp) * amp);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>}, metadata: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specs: (</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posLo: [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posHi: [0.01, 0.99, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.75],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRate: [0.1, 2, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posDev: [0, 0.2, 5, 0, 0.01],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>panMax: [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp: [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.5]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>)</span></p>
<p class="p12"><span class="s2">).add;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2">)</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// As the setting Pbind needs to know the Synth's nodeID</span></p>
<p class="p17"><span class="s2">// the Synth has to be started explicitely and passed to the VarGui later on</span></p>
<p class="p17"><span class="s2">// (VarGui takes Synths as well as SynthDefs, passing a SynthDef is recommended in general).</span></p>
<p class="p17"><span class="s2">// The Synth starts silently as t_trig defaults to 0.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">(</span></p>
<p class="p15"><span class="s2">x = </span><span class="s14">Synth</span><span class="s2">(</span><span class="s15">\gran_3a</span><span class="s2">, [</span><span class="s15">\bufNum</span><span class="s2">, b]).register;</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">p = </span><span class="s14">Pbind</span><span class="s2">(</span></p>
<p class="p28"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\type</span><span class="s3">, </span><span class="s2">\set</span><span class="s3">,</span></p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\id</span><span class="s2">, x,</span></p>
<p class="p28"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\args</span><span class="s3">, [</span><span class="s2">\t_trig</span><span class="s3">, </span><span class="s2">\t_rate</span><span class="s3">, </span><span class="s2">\granDur</span><span class="s3">],</span></p>
<p class="p29"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, </span><span class="s14">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">) * </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\legato</span><span class="s3">),</span></p>
<p class="p28"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\t_trig</span><span class="s3">, 1,</span></p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\t_rate</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">(</span><span class="s15">\midi</span><span class="s2">).midiratio</span></p>
<p class="p15"><span class="s2">);</span></p>
<p class="p30"><span class="s2">)</span></p>
<p class="p30"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// Do start and pause with the Pbind (EventStreamPlayer) player.</span></p>
<p class="p17"><span class="s2">// If you stop the Synth you cannot resume audio with a new Synth</span></p>
<p class="p17"><span class="s2">// as the EventStreamPlayer has lost the correct nodeID</span></p>
<p class="p17"><span class="s2">// (however the Synth can be paused and resumed).</span></p>
<p class="p30"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">(</span></p>
<p class="p12"><span class="s14">VarGui</span><span class="s2">(varCtr: [</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\dur</span><span class="s2">, [0.01, 0.1, </span><span class="s15">\lin</span><span class="s2">, 0, 0.05],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\legato</span><span class="s2">, [0.3, 3, </span><span class="s15">\lin</span><span class="s2">, 0, 2],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\midi</span><span class="s2">, [-12, 12, </span><span class="s15">\lin</span><span class="s2">, 1, 1] ! 8<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>], synth: x, stream: p</span></p>
<p class="p12"><span class="s2">).gui;</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 3b: <span class="Apple-converted-space">  </span>Using external control synths</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Example needs SynthDef from Ex. 2a</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Also with language-driven granulation<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// controls can be delegated to separate Synths,</span></p>
<p class="p13"><span class="s2">// which output to control busses.</span></p>
<p class="p13"><span class="s2">// Control inputs of single synths can read from</span></p>
<p class="p13"><span class="s2">// these busses (comfortably use aBus.asMap in the Pbind)</span></p>
<p class="p13"><span class="s2">// or synths can read from busses with In.kr (needs extra definition).</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// A nearby parameter to determine with a separate synth is grain position</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p26"><span class="s2">SynthDef</span><span class="s3">(</span><span class="s15">\bufPhasor</span><span class="s3">, { </span><span class="s2">|out = 0, sndBuf = 0, posRate = 1, posLo = 0, posHi = 1, posDev = 0.01|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> pos, posDif;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = </span><span class="s14">Phasor</span><span class="s2">.ar(1, posRate * </span><span class="s14">BufRateScale</span><span class="s2">.kr(sndBuf) / </span><span class="s14">BufFrames</span><span class="s2">.kr(sndBuf), 0, posDif)<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ </span><span class="s14">WhiteNoise</span><span class="s2">.kr(posDev / 2) % posDif + posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.kr(out, </span><span class="s14">A2K</span><span class="s2">.kr(pos));<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>}<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">w = </span><span class="s14">Buffer</span><span class="s2">.sendCollection(s, </span><span class="s14">Signal</span><span class="s2">.hanningWindow(1024));</span></p>
<p class="p12"><span class="s2">c = </span><span class="s14">Bus</span><span class="s2">.control(s,1);</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// in GUI start EventStreamPlayer and bufPhasor Synth</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s2">p = </span><span class="s14">Pbind</span><span class="s2">(<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\gran_2a</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\sndBuf</span><span class="s3">, b,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\windowBuf</span><span class="s3">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, 1 / </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\trigRate</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\granDur</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\pos</span><span class="s2">, c.asMap,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rate</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\rate</span><span class="s3">), <span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">([-1,1]) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\panMax</span><span class="s2">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, 0</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\trigRate</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 50],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\granDur</span><span class="s2">, [0.01, 0.3, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.12],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\rate</span><span class="s2">, [0.1, 3, </span><span class="s15">\lin</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.3]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, c.index,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\sndBuf</span><span class="s2">, b.bufnum,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posLo</span><span class="s2">, [0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.005, 0],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posHi</span><span class="s2">, [0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.005, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posRate</span><span class="s2">, [0.1, 2, </span><span class="s15">\linear</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posDev</span><span class="s2">, [0, 0.2, 5, 0, 0.01]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span>p, </span><span class="s2">\bufPhasor</span></p>
<p class="p12"><span class="s2">).gui(sliderPriority: </span><span class="s15">\synth</span><span class="s2">, playerPriority: </span><span class="s15">\synth</span><span class="s2">);<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p18"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 3c: <span class="Apple-converted-space">  </span>Switching between ugens of external control synths</b></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// Example needs SynthDef from Ex. 2a</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">// external control synth for position as in 3a, but with<span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s2">// different types of movement to select</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p26"><span class="s2">SynthDef</span><span class="s3">(</span><span class="s15">\bufPosLFO</span><span class="s3">, { </span><span class="s2">|out = 0, lfoType = 0, freq = 1, posLo = 0, posHi = 1, posDev = 0.01|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> pos, posDif;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = </span><span class="s14">WhiteNoise</span><span class="s2">.kr(posDev / 2) + </span><span class="s14">Select</span><span class="s2">.kr(lfoType,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[</span><span class="s14">LFDNoise0</span><span class="s2">, </span><span class="s14">LFDNoise1</span><span class="s2">, </span><span class="s14">LFDNoise3</span><span class="s2">].collect(</span><span class="s14">_</span><span class="s2">.kr(freq, posDif))) % posDif + posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.kr(out, pos);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">w = </span><span class="s14">Buffer</span><span class="s2">.sendCollection(s, </span><span class="s14">Signal</span><span class="s2">.hanningWindow(1024));</span></p>
<p class="p12"><span class="s2">c = </span><span class="s14">Bus</span><span class="s2">.control(s,1);</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// added parallel grains</span></p>
<p class="p17"><span class="s2">// in GUI start bufPhasor Synth before or together with EventStreamPlayer</span></p>
<p class="p15"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2">// buffer position movement can be forward and backward</span></p>
<p class="p17"><span class="s2">// lfoType 0: LFDNoise0 (jumps)</span></p>
<p class="p17"><span class="s2">// lfoType 1: LFDNoise1 (linear interpolation)</span></p>
<p class="p17"><span class="s2">// lfoType 2: LFDNoise3 (cubic interpolation, smooth, useful in many control contexts)</span></p>
<p class="p29"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p12"><span class="s2">p = </span><span class="s14">Pbind</span><span class="s2">(<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\gran_2a</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\sndBuf</span><span class="s3">, b,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\windowBuf</span><span class="s3">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, 1 / </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\trigRate</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDur</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\granDur</span><span class="s3">),<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\pos</span><span class="s2">, c.asMap,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\rate</span><span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\rate</span><span class="s2">) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\midiAdd</span><span class="s2">).midiratio,</span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s14">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, </span><span class="s14">PLseq</span><span class="s2">([-1,1]) * </span><span class="s14">PL</span><span class="s2">(</span><span class="s15">\panMax</span><span class="s2">),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, 0</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p26"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\trigRate</span><span class="s2">, [1, 200, </span><span class="s15">\lin</span><span class="s2">, 0.01, 80],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\granDur</span><span class="s2">, [0.01, 0.3, </span><span class="s15">\lin</span><span class="s2">, 0.005, 0.195],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\rate</span><span class="s2">, [0.1, 1.5, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.6],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\midiAdd</span><span class="s2">, [-5, 0].collect([-12, 12, </span><span class="s15">\lin</span><span class="s2">, 1, </span><span class="s24">_</span><span class="s2">]),</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\panMax</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.0, 0.95],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, [0.0, 1, </span><span class="s15">\lin</span><span class="s2">, 0.01, 0.15]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, c.index,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posLo</span><span class="s2">, [0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.005, 0.15],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posHi</span><span class="s2">, [0, 1, </span><span class="s15">\linear</span><span class="s2">, 0.005, 0.43],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\posDev</span><span class="s2">, [0, 0.2, 5, 0, 0.0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\freq</span><span class="s2">, [0.01, 2, </span><span class="s15">\lin</span><span class="s2">, 0, 0.96],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\lfoType</span><span class="s2">, [0, 2, </span><span class="s15">\lin</span><span class="s2">, 1, 2]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s3"><span class="Apple-tab-span">	</span>p, </span><span class="s2">\bufPosLFO</span></p>
<p class="p12"><span class="s2">).gui(sliderPriority: </span><span class="s15">\synth</span><span class="s2">, playerPriority: </span><span class="s15">\synth</span><span class="s2">);<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p11"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>Example 3d: <span class="Apple-converted-space">  </span>Pattern-driven sequencing of granular events using demand rate ugens</b></span></p>
<p class="p10"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// This is basically the same as SynthDef \gran_1d with an additional envelope,</span></p>
<p class="p19"><span class="s2">// grain position phasor is left out, position is determined by a phasor synth via bus and mapping.</span></p>
<p class="p31"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// length of demand rate sequence, you might want to check larger sizes</span></p>
<p class="p19"><span class="s2">// in connection with gui arg tryColumnNum &gt; 1</span></p>
<p class="p12"><span class="s21">~n</span><span class="s2"> = 5;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s16">SynthDef</span><span class="s3">(</span><span class="s18">\gran_3d</span><span class="s3">, { </span><span class="s2">|out = 0, soundBuf, envBuf, att = 0.1, sus = 1, rel = 1, pos = 0.5,</span></p>
<p class="p20"><span class="s2"><span class="Apple-tab-span">	</span>granDurMul = 1, rateMul = 1, overlapMul = 1, panMul = 1, amp = 0.5, interp = 2|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">var</span><span class="s2"> signal, bufDur, granDur, granGate, relGranDurs, overlap, relOverlaps, overlapSeq,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pan, rate, relRates, rateSeq, granDurSeq;<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// array args for demand rate sequencing, short form of NamedControl<span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relGranDurs = </span><span class="s18">\relGranDurs</span><span class="s2">.kr(0.1!</span><span class="s21">~n</span><span class="s2">);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relRates = </span><span class="s18">\relRates</span><span class="s2">.kr(1!</span><span class="s21">~n</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>relOverlaps = </span><span class="s18">\relOverlaps</span><span class="s2">.kr(1!</span><span class="s21">~n</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// Dstutter (or Dunique) necessary as granDurSeq is polled twice: granGate and granDur</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granDurSeq = </span><span class="s16">Dstutter</span><span class="s2">(2, </span><span class="s16">Dseq</span><span class="s2">(relGranDurs, </span><span class="s20">inf</span><span class="s2">)); <span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rateSeq = </span><span class="s16">Dseq</span><span class="s2">(relRates, </span><span class="s20">inf</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlapSeq = </span><span class="s16">Dseq</span><span class="s2">(relOverlaps, </span><span class="s20">inf</span><span class="s2">);<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granGate = </span><span class="s16">TDuty</span><span class="s2">.ar(granDurSeq * granDurMul);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>granDur = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, granDurSeq * granDurMul);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>rate = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, rateSeq) * rateMul;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, </span><span class="s16">Dseq</span><span class="s2">([1, -1], </span><span class="s20">inf</span><span class="s2">)) * 0.999 * panMul;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>overlap = </span><span class="s16">Demand</span><span class="s2">.ar(granGate, 0, overlapSeq) * overlapMul;</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>bufDur = </span><span class="s16">BufDur</span><span class="s2">.kr(soundBuf);</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>signal = </span><span class="s16">TGrains</span><span class="s2">.ar(2, granGate, soundBuf, rate, pos * bufDur, granDur * overlap, pan, 1, interp) *</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">EnvGen</span><span class="s2">.kr(</span><span class="s16">Env</span><span class="s2">([0, 1, 1, 0], [att, sus, rel]), doneAction: 2);</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">Out</span><span class="s2">.ar(out, signal * amp);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}</span></p>
<p class="p12"><span class="s2">).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s16">SynthDef</span><span class="s3">(</span><span class="s18">\bufPhasor_2</span><span class="s3">, { </span><span class="s2">|out = 0, sndBuf = 0, posRateE = 0, posRateM = 1,<span class="Apple-converted-space"> </span></span></p>
<p class="p20"><span class="s2"><span class="Apple-tab-span">	</span>posLo = 0, posHi = 1, posDev = 0.01|</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">var</span><span class="s2"> pos, posDif, posRate;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>pos = </span><span class="s16">Phasor</span><span class="s2">.ar(1, posRate * </span><span class="s16">BufRateScale</span><span class="s2">.kr(sndBuf) / </span><span class="s16">BufFrames</span><span class="s2">.kr(sndBuf), 0, posDif)<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ </span><span class="s16">WhiteNoise</span><span class="s2">.kr(posDev / 2) % posDif + posLo;</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">Out</span><span class="s2">.kr(out, </span><span class="s16">A2K</span><span class="s2">.kr(pos));<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">}<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">).add;<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s2">b = </span><span class="s16">Buffer</span><span class="s2">.read(s, </span><span class="s16">Platform</span><span class="s2">.miSCellaneousDirs[0] +/+ </span><span class="s17">"Sounds"</span><span class="s2"> +/+ </span><span class="s17">"kitchen_sounds_1.wav"</span><span class="s2">);</span></p>
<p class="p16"><span class="s2">// This searches the most likely extension places for the miSCellaneous folder.</span></p>
<p class="p16"><span class="s2">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">c = Bus.control(s,1);</span></p>
<p class="p12"><span class="s2">)</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// Pattern control of granular events</span></p>
<p class="p19"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// Every granular event gets a duration between durLo and durHi (exp distribution)</span></p>
<p class="p19"><span class="s2">// and an envelope according to att, sus and rel.</span></p>
<p class="p19"><span class="s2">// One of four events is randomly defined as rest.<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// arg arrays relGranDurs, relRates and relOverlaps determine</span></p>
<p class="p19"><span class="s2">// demand rate sequencing for granulation as in Ex. 1d.</span></p>
<p class="p19"><span class="s2">// Per event they are multiplied with corresponding factors</span></p>
<p class="p19"><span class="s2">// limited by granDurMulLo/Hi, rateMulLo/Hi and overlapMulLo/Hi</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2">// start phasor synth (first row in player console) before event stream player</span></p>
<p class="p19"><span class="s2">// event stream player might start with rest<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">(</span></p>
<p class="p19"><span class="s2">// Passing arrayed args with an event pattern requires</span></p>
<p class="p19"><span class="s2">// wrapping them into an array or Ref object.</span></p>
<p class="p19"><span class="s2">// This is necessary to distinguish from triggering<span class="Apple-converted-space"> </span></span></p>
<p class="p19"><span class="s2">// several synths per event.</span></p>
<p class="p19"><span class="s2">// .collect(`_) is short for .collect { |x| Ref(x) }</span></p>
<p class="p19"><span class="s2">// .collect([_]) or .collect { |x| [x] } would also be possible</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">p = </span><span class="s16">Pbind</span><span class="s2">(</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\gran_3d</span><span class="s3">,</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\soundBuf</span><span class="s3">, b,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s18">\pos</span><span class="s2">, c.asMap,</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, </span><span class="s16">PLexprand</span><span class="s3">(</span><span class="s2">\durLo</span><span class="s3">, </span><span class="s2">\durHi</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\type</span><span class="s3">, </span><span class="s16">PLshufn</span><span class="s3">(</span><span class="s2">\note</span><span class="s3">!3 ++ </span><span class="s2">\rest</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\att</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\att</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\sus</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\sus</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rel</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\rel</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\relGranDurs</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\relGranDurs</span><span class="s3">).collect(`</span><span class="s16">_</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\granDurMul</span><span class="s3">, </span><span class="s16">PLwhite</span><span class="s3">(</span><span class="s2">\granDurMulLo</span><span class="s3">, </span><span class="s2">\granDurMulHi</span><span class="s3">),</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\relOverlaps</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\relOverlaps</span><span class="s3">).collect(`</span><span class="s16">_</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\overlapMul</span><span class="s3">, </span><span class="s16">PLwhite</span><span class="s3">(</span><span class="s2">\overlapMulLo</span><span class="s3">, </span><span class="s2">\overlapMulHi</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\relRates</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\relRates</span><span class="s3">).collect(`</span><span class="s16">_</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\rateMul</span><span class="s3">, </span><span class="s16">PLwhite</span><span class="s3">(</span><span class="s2">\rateMulLo</span><span class="s3">, </span><span class="s2">\rateMulHi</span><span class="s3">),</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\panMul</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\panMul</span><span class="s3">),</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s16">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">)</span></p>
<p class="p12"><span class="s2">);</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p21"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\durLo</span><span class="s2">, [0.05, 1.5, </span><span class="s18">\lin</span><span class="s2">, 0, 0.16],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\durHi</span><span class="s2">, [0.05, 1.5, </span><span class="s18">\lin</span><span class="s2">, 0, 1.2],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\att</span><span class="s2">, [0.01, 0.6, </span><span class="s18">\lin</span><span class="s2">, 0, 0.4],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\sus</span><span class="s2">, [0.01, 0.6, </span><span class="s18">\lin</span><span class="s2">, 0, 0.05],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\rel</span><span class="s2">, [0.01, 0.6, </span><span class="s18">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\relGranDurs</span><span class="s2">, { </span><span class="s19">|i|</span><span class="s2"> [0.01, 0.1, </span><span class="s18">\lin</span><span class="s2">, 0, i * 0.005 + 0.02] } ! </span><span class="s21">~n</span><span class="s2">,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\granDurMulLo</span><span class="s2">, [0.03, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.05],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\granDurMulHi</span><span class="s2">, [0.03, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 1.8],<span class="Apple-tab-span">	</span></span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\relRates</span><span class="s2">, { </span><span class="s19">|i|</span><span class="s2"> [0.1, 1.5, </span><span class="s18">\lin</span><span class="s2">, 0, (5-i) * 0.1 + 0.5] } ! </span><span class="s21">~n</span><span class="s2">,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\rateMulLo</span><span class="s2">, [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\rateMulHi</span><span class="s2">, [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 1.5],</span></p>
<p class="p12"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\relOverlaps</span><span class="s2">, [0.5, 3, </span><span class="s18">\lin</span><span class="s2">, 0, 2] ! </span><span class="s21">~n</span><span class="s2">,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\overlapMulLo</span><span class="s2">, [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 0.25],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\overlapMulHi</span><span class="s2">, [0.1, 2, </span><span class="s18">\lin</span><span class="s2">, 0, 1.8],</span></p>
<p class="p14"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\panMul</span><span class="s2">, [0.0, 1, </span><span class="s18">\lin</span><span class="s2">, 0.0, 0.8],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\amp</span><span class="s2">, [0.0, 3, </span><span class="s18">\lin</span><span class="s2">, 0.01, 1.8]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\out</span><span class="s2">, c.index,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\sndBuf</span><span class="s2">, b.bufnum,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\posLo</span><span class="s2">, [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0.005, 0.1],<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\posHi</span><span class="s2">, [0, 1, </span><span class="s18">\lin</span><span class="s2">, 0.005, 0.9],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\posRateE</span><span class="s2">, [-3, 4, </span><span class="s18">\lin</span><span class="s2">, -1, 0],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\posRateM</span><span class="s2">, [0.1, 10, </span><span class="s18">\exp</span><span class="s2">, 0.01, 1],</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s18">\posDev</span><span class="s2">, [0, 0.2, 5, 0, 0.01]</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span>p, </span><span class="s2">\bufPhasor_2</span></p>
<p class="p12"><span class="s2">).gui(</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>tryColumnNum: 2,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sliderPriority: </span><span class="s18">\synth</span><span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>playerPriority: </span><span class="s18">\synth</span><span class="s2">,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>varColorGroups: (0..(</span><span class="s21">~n</span><span class="s2">*3+12)).clumps([2,3,</span><span class="s21">~n</span><span class="s2">+2,</span><span class="s21">~n</span><span class="s2">+2,</span><span class="s21">~n</span><span class="s2">+2,1,1]),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>synthColorGroups: (0..6).clumps([1,1,2,2,1]),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>labelWidth: 90,</span></p>
<p class="p12"><span class="s2"><span class="Apple-tab-span">	</span>sliderWidth: 300</span></p>
<p class="p12"><span class="s2">);    </span></p>
<p class="p12"><span class="s2">)<span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s2"><b>4.) Extensions of Setups</b></span></p>
<p class="p10"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">.)<span class="Apple-tab-span">	</span><b>Changing ranges and scaling</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p4"><span class="s2"><span class="Apple-tab-span">	</span>This concerns all control parameters in question. E.g. the layering of long grains (&gt; 200 ms) in connection with small rates of position changes (posRate) often has interesting effects. One may want to drop the term granulation in that case, though it's the same structure of synthesis. For such parameters with a very large coefficient boundHi / boundLo one may take exponential scaling, and if this is not fine enough you can invent a control pair of mantissa and exponent (as for posRate in Ex. 1b).</span></p>
<p class="p5"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2">.)<span class="Apple-tab-span">	</span><b>Parameter linkage</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p4"><span class="s2"><span class="Apple-tab-span">	</span>On the one hand a logical restriction, on the other hand it can make sense from a musical / perceptional point of view. E.g. shortening of grains could be linked with a raise of rate (as low frequencies might fail to unfold in short grains). Anyway parameter linkage is reducing complexity - it's a trade-off between simplicity of the interface and exclusion of certain constellations which should be considered from case to case.</span></p>
<p class="p5"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p4"><span class="s2">.)<span class="Apple-tab-span">	</span><b>Inventing and extending controls and LFO changes dependant on specific buffers and parameter sets</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2"><span class="Apple-tab-span">	</span>Say one has started playing around with a certain buffer and a general granulation patch. A parameter set that gives an interesting sound may react in a very interesting way on a change of a single parameter e.g., trigger rate. Then it may be an option to build in a control or a LFO specifically designed for that parameter - LFO is meant here in a general sense, it could be a LFO in a Synth, a dedicated LFO synth or defined by a rapidly sequencing Pattern.</span></p>
<p class="p32"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2">.)<span class="Apple-tab-span">	</span><b>Iterated granulation</b></span></p>
<p class="p32"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2"><span class="Apple-tab-span">	</span>Granulation of buffers themselves resulting from buffer granulation can give interesting effects.</span></p>
<p class="p32"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2">.)<span class="Apple-tab-span">	</span><b>Spatialization</b></span></p>
<p class="p32"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2"><span class="Apple-tab-span">	</span>For the sake of ease and comparison a L/R-switch per grain with one panning parameter was used in the examples above. Needless to say that spatial scattering of grains remains a large field of experimentation. Generally spoken spatialization can be part of the synthesis process or carried through independently afterwards, but also a combination of both approaches is feasible.</span></p>
<p class="p33"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p32"><span class="s2">.)<span class="Apple-tab-span">	</span><b>Effects</b></span></p>
<p class="p32"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2"><span class="Apple-tab-span">	</span>Effect processing can be applied to all or single grains in a language-driven granulation setup. There can be one or more effects, serial or in parallel, defined outside or inside the Synth playing the buffer, as with the BPF in Ex 2b - 2d. In these examples the bandpass is applied in general, but also a sequencing of effects can be done. And even in the case of just one effect (e.g. reverb) a decent sequencing of Fx- / noFx-events can sound very interesting. This can be done with PbindFx (as in the project <a href="kitchen studies.html"><span class="s25">kitchen studies</span></a>), sequencing not more than one effect per grain can be done straightly: continously running effect synths read from different buses and events with different out values cause the player synths to output to these buses.<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></span></p>
<p class="p33"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p32"><span class="s2"><span class="Apple-converted-space"> </span>.)<span class="Apple-tab-span">	</span><b>Micro rhythm</b></span></p>
<p class="p32"><span class="s2"><br>
</span></p>
<p class="p32"><span class="s2"><span class="Apple-tab-span">	</span>See Xenakis' suggestion of Sieves with rhythm generation as a special application, a granulation example is contained in the example section of: <a href="Sieves and Psieve patterns.html"><span class="s25">Sieves and Psieve patterns</span></a>. PSPdiv, a dynamic multi-layer pulse divider, which is based on Pspawner, can also be used in this context, see the last example of <a href="PSPdiv.html"><span class="s25">PSPdiv</span></a>.<span class="Apple-converted-space"> </span></span></p>
<p class="p33"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p33"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p33"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p33"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p33"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
</body>
</html>
