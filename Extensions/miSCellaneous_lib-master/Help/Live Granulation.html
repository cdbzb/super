<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1404.47">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 21.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #0000ee; -webkit-text-stroke: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; line-height: 16.0px; font: 14.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 16.0px; font: 14.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #cd1c00; -webkit-text-stroke: #cd1c00}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #1e39f6; -webkit-text-stroke: #1e39f6}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #0433ff; -webkit-text-stroke: #0433ff}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #d00c0c; -webkit-text-stroke: #d00c0c}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #0326cb; -webkit-text-stroke: #0326cb}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #ff7c00; -webkit-text-stroke: #ff7c00}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #008300; -webkit-text-stroke: #008300}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #cf0c0c; -webkit-text-stroke: #cf0c0c}
p.p17 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; line-height: 14.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #000000; -webkit-text-stroke: #000000; min-height: 12.0px}
p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 10.0px; font: 9.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p20 {margin: 0.0px 0.0px 0.0px 29.0px; text-indent: -29.0px; line-height: 16.0px; font: 14.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #162bc4; -webkit-text-stroke: #162bc4}
p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #008323; -webkit-text-stroke: #008323}
p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 12.0px; font: 9.0px Monaco; color: #737373; -webkit-text-stroke: #737373}
span.s1 {font: 18.0px Helvetica; font-kerning: none}
span.s2 {font-kerning: none}
span.s3 {font-kerning: none; color: #000000; -webkit-text-stroke: 0px #000000}
span.s4 {text-decoration: underline ; font-kerning: none; color: #0000ee; -webkit-text-stroke: 0px #0000ee}
span.s5 {text-decoration: underline ; font-kerning: none; color: #01caff; -webkit-text-stroke: 0px #01caff}
span.s6 {font-kerning: none; color: #00bbff; -webkit-text-stroke: 0px #00bbff}
span.s7 {text-decoration: underline ; font-kerning: none; color: #00caff; -webkit-text-stroke: 0px #00caff}
span.s8 {text-decoration: underline ; font-kerning: none}
span.s9 {text-decoration: underline ; font-kerning: none; color: #042eee}
span.s10 {text-decoration: underline ; font-kerning: none; color: #042eee; -webkit-text-stroke: 0px #042eee}
span.s11 {font-kerning: none; color: #0327ce; -webkit-text-stroke: 0px #0327ce}
span.s12 {font-kerning: none; color: #ff7c00; -webkit-text-stroke: 0px #ff7c00}
span.s13 {font-kerning: none; color: #0326cb; -webkit-text-stroke: 0px #0326cb}
span.s14 {font-kerning: none; color: #162bc4; -webkit-text-stroke: 0px #162bc4}
span.s15 {font-kerning: none; color: #008323; -webkit-text-stroke: 0px #008323}
span.s16 {font-kerning: none; color: #008300; -webkit-text-stroke: 0px #008300}
span.s17 {font-kerning: none; color: #0433ff; -webkit-text-stroke: 0px #0433ff}
span.s18 {font-kerning: none; color: #434ccb; -webkit-text-stroke: 0px #434ccb}
span.s19 {font-kerning: none; color: #ff7826; -webkit-text-stroke: 0px #ff7826}
span.s20 {font-kerning: none; color: #1e39f6; -webkit-text-stroke: 0px #1e39f6}
span.s21 {font-kerning: none; color: #737373; -webkit-text-stroke: 0px #737373}
span.s22 {font-kerning: none; color: #7b7ec6; -webkit-text-stroke: 0px #7b7ec6}
span.s23 {font-kerning: none; color: #d01d0c; -webkit-text-stroke: 0px #d01d0c}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>Live Granulation<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><span class="s2"><b>different approaches to live granulation with gui examples<span class="Apple-converted-space"> </span></b></span><span class="s1"><b><span class="Apple-tab-span">	</span></b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p3"><span class="s3"><b>Part of:</b> <a href="miSCellaneous.html"><span class="s4">miSCellaneous</span></a></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p3"><span class="s3"><b>See also:</b> <a href="Buffer Granulation.html"><span class="s5">Buffer Granulation</span></a>, <a href="Introduction to miSCellaneous.html"><span class="s4">Introduction to miSCellaneous</span></a></span><span class="s6">,</span><span class="s3"> <a href="VarGui.html"><span class="s7">VarGui</span></a></span><span class="s6">,</span><span class="s3"> <a href="VarGui shortcut builds.html"><span class="s4">VarGui shortcut builds</span></a></span><span class="s6">,</span><span class="s3"> <a href="PLx suite.html"><span class="s4">PLx suite</span></a></span><span class="s6">,</span><span class="s3"> <a href="PbindFx.html"><span class="s4">PbindFx</span></a></span><span class="s6">,</span><span class="s3"> <a href="kitchen studies.html"><span class="s4">kitchen studies</span></a></span><span class="s6">,</span><span class="s3"> <a href="Sieves and Psieve patterns.html"><span class="s4">Sieves and Psieve patterns</span></a></span><span class="s6">,</span><span class="s3"> <a href="PSPdiv.html"><span class="s4">PSPdiv</span></a></span><span class="s8">,</span><span class="s3"> <a href="DX suite.html"><span class="s9">DX suite</span></a>, <a href="DXMix.html"><span class="s10">DXMix</span></a>, <a href="DXMixIn.html"><span class="s10">DXMixIn</span></a>,<b> </b><a href="DXEnvFan.html"><span class="s10">DXEnvFan</span></a>,<b> </b><a href="DXEnvFanOut.html"><span class="s10">DXEnvFanOut</span></a>, <a href="DXFan.html"><span class="s10">DXFan</span></a>, <a href="DXFanOut.html"><span class="s10">DXFanOut</span></a></span></p>
<p class="p3"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">This file is a complement to the Buffer Granulation tutorial. It contains variants of granulation that are applied to an audio signal directly, without the explicit use of a buffer. As with buffer granulation there exist language-driven and server-driven as well as hybrid variants. Especially pattern-based live granulation raises certain accuracy issues, which are summarized in this tutorial.<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>WARNING:</b><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">1.) <span class="Apple-tab-span">	</span>Be careful with amplitudes !<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span>To reduce feedback I've built in tanh, LPF and delay into examples with SoundIn,<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span>though better use headphones to avoid feedback at all.<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span>For tips on reducing feedback or creative use of feedback see Nathaniel Virgo's Feedback quark.</span></p>
<p class="p4"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2">2.) <span class="Apple-tab-span">	</span>Avoid too early freeing of audio buses:</span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a) When there are still running synths, unintendedly sound might be routed to a processing resp. feedback chain.</span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>b) For the same reason don't free buses if they are hard-wired to SynthDefs, you still want to use.<span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span>You can free buses on oaccasion if you are sure that nothing is running and you won't need them again.</span></p>
<p class="p2"><span class="s2"><span class="Apple-tab-span">	</span>Keep in mind that you can also (re-)start the server with a higher number of audio buses available (Ex. 2c)</span></p>
<p class="p4"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p5"><span class="s2">3.)<span class="Apple-tab-span">	</span>I haven't used below setups for live performances. Although all of them work stable for me as they are, in general hangs can occasionally happen with pattern-driven setups. Often this can be tracked down to sequences of extremely short event durations (and/or long grain durations). Where this can happen as a side-effect, thresholds can be built in.<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s2"><span class="Apple-tab-span">	</span>Another possible source of hangs is careless deep nesting of Patterns where mistakes can easily occur. Starting with clear Pattern structures is recommended - and if more complications are involved: testing without sound first, after saving your patch, might be a good idea.<span class="Apple-tab-span">	</span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>NOTE:</b><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">With the exception of Exs. 2d all examples use SoundIn, supposing to use input from your computer resp. soundcard. Depending on your setup you might have to change the standard input (bus = 0) passed to VarGui resp. the SoundIn ugen. Use headphones to avoid feedback!</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><b>NOTE:</b><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">All live granulation variants of this file can of course be applied to any signal, thus also to any playback of a buffer. Vice versa all variants from <a href="Buffer Granulation.html"><span class="s5">Buffer Granulation</span></a> can be applied to a buffer, which is occasionally (or continuously) filled with live input.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s2">s = </span><span class="s11">Server</span><span class="s2">.local;</span></p>
<p class="p6"><span class="s11">Server</span><span class="s2">.default = s;</span></p>
<p class="p6"><span class="s2">s.boot;</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p5"><span class="s2"><br>
</span></p>
<p class="p7"><span class="s8"><b>1.) Live granulation scheduled by server</b></span></p>
<p class="p7"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">This can be done with the GrainIn ugen or self-defined enveloping. An advantage of server-driven live granulation is, that accuracy issues and their workarounds, as described in Exs. 2a-2d, are avoided. As a restriction, sequenced processing of grains, e.g. as with PbindFx, is more difficult.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p8"><span class="s2"><b>Example 1a: <span class="Apple-converted-space">  </span>Basic live granulation with GrainIn</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s12">~audioBus_ex_1a</span><span class="s2"> = </span><span class="s13">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// pass envelopes with buffer, hanning is GrainIn's default anyway</span></p>
<p class="p6"><span class="s2">h = </span><span class="s13">Signal</span><span class="s2">.hanningWindow(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s13">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\soundIn</span><span class="s3">, { </span><span class="s2">|out, in, ampIn = 1|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out, </span><span class="s14">SoundIn</span><span class="s2">.ar(in) * ampIn)</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\live_gran_1a</span><span class="s3">, { </span><span class="s2">|out, in, envBuf, trigRate = 50, overlap = 0.5, panMax = 0.5,</span></p>
<p class="p11"><span class="s2"><span class="Apple-tab-span">	</span>panType = 0, amp = 1, minGrainDur = 0.001|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s17">var</span><span class="s2"> inSig, sig, trig, grainDur, pan;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">In</span><span class="s2">.ar(in, 1);</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">DelayC</span><span class="s2">.ar(</span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000), 0.1, 0.01);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>trig = </span><span class="s13">Impulse</span><span class="s2">.ar(trigRate);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>grainDur = max(trigRate.reciprocal * overlap, minGrainDur);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// select L/R or random sequencing</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s13">Demand</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trig,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0,</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">Dswitch1</span><span class="s3">([</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Dseq</span><span class="s2">([1, -1], </span><span class="s18">inf</span><span class="s2">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Dwhite</span><span class="s2">(-1, 1)</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], panType)</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>) * min(panMax, 0.999);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>sig = </span><span class="s13">GrainIn</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>2,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trig,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>grainDur,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pan,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, sig * </span><span class="s13">EnvGate</span><span class="s2">.new * amp);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// to avoid feedback use with headphones<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p9"><span class="s2">// start granulation (first row) before to ensure right order</span></p>
<p class="p13"><span class="s2">VarGui</span><span class="s3">(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>synthCtr: [</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\envBuf</span><span class="s2">, e.bufnum,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s3">, </span><span class="s2">~audioBus_ex_1a</span><span class="s3">.index,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\trigRate</span><span class="s2">, [5, 500, </span><span class="s16">\lin</span><span class="s2">, 0, 50],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, [0.05, 3, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panType</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 1, 0],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panMax</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s2">, </span><span class="s19">~audioBus_ex_1a</span><span class="s2">.index,<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// you might have to pass a different 'in' bus for SoundIn</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// depending on your setup</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s2">, 0,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\ampIn</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>],</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span>synth: [</span><span class="s2">\live_gran_1a</span><span class="s3">, </span><span class="s2">\soundIn</span><span class="s3">]</span></p>
<p class="p6"><span class="s2">).gui</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">Even with overlapping grains, sequenced effect processing per grain is possible with GrainIn, but requires more effort, see Ex. 1e in the Buffer Granulation tutorial.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p8"><span class="s2"><b>Example 1b: <span class="Apple-converted-space">  </span>Live granulation with server-driven enveloping</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">In this example only non-overlapping grains are regarded, for overlapping a multichannel approach as in Ex. 1e of the Buffer Granulation tutorial can be applied. In comparison to live granulation example 1a there is hardly an advantage in this basic variant. However intermediate processings can be built into this SynthDef, which aren't possible in the above example, where granulation is encapsulated in a UGen, manipulation of the envelope signal could be one.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s12">~audioBus_ex_1b</span><span class="s2"> = </span><span class="s13">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p6"><span class="s2">h = </span><span class="s13">Signal</span><span class="s2">.hanningWindow(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s13">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\soundIn</span><span class="s3">, { </span><span class="s2">|out, in, ampIn = 1|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out, </span><span class="s14">SoundIn</span><span class="s2">.ar(in) * ampIn)</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// suppose overlap &lt; 1</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\live_gran_1b</span><span class="s3">, { </span><span class="s2">|out, in, envBuf, trigRate = 50, overlap = 0.5, panMax = 0.5,</span></p>
<p class="p11"><span class="s2"><span class="Apple-tab-span">	</span>panType = 0, amp = 1, minGrainDur = 0.001, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s17">var</span><span class="s2"> inSig, env, numFrames = </span><span class="s13">BufFrames</span><span class="s2">.kr(envBuf), startTrig, grainDur,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>latchedTrigRate, latchedStartTrig, latchedOverlap, pan;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s13">In</span><span class="s2">.ar(in, 1);</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">DelayC</span><span class="s2">.ar(</span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000), 0.1, 0.01);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>startTrig = </span><span class="s13">Impulse</span><span class="s2">.ar(trigRate);</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// why this ? - shape of envelope shouldn't be changed while application</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>latchedTrigRate = </span><span class="s13">Latch</span><span class="s2">.ar(</span><span class="s13">K2A</span><span class="s2">.ar(trigRate), startTrig);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>latchedStartTrig = </span><span class="s13">Impulse</span><span class="s2">.ar(latchedTrigRate);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>latchedOverlap = </span><span class="s13">Latch</span><span class="s2">.ar(</span><span class="s13">K2A</span><span class="s2">.ar(overlap), startTrig);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>latchedOverlap = max(latchedOverlap, latchedTrigRate * minGrainDur);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>grainDur = (latchedOverlap / latchedTrigRate);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s13">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Sweep</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>latchedStartTrig,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>latchedOverlap.reciprocal * latchedTrigRate * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>pan = </span><span class="s13">Demand</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>latchedStartTrig,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0,</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">Dswitch1</span><span class="s3">([</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Dseq</span><span class="s2">([1, -1], </span><span class="s18">inf</span><span class="s2">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Dwhite</span><span class="s2">(-1, 1)</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], panType)</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>) * panMax * 0.999;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, </span><span class="s13">Pan2</span><span class="s2">.ar(inSig * env * amp, pan) * </span><span class="s13">EnvGate</span><span class="s2">.new);</span></p>
<p class="p6"><span class="s2">}).add</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// to avoid feedback use with headphones<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p9"><span class="s2">// start granulation (first row) before to ensure right order</span></p>
<p class="p13"><span class="s2">VarGui</span><span class="s3">(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>synthCtr: [</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\envBuf</span><span class="s2">, e.bufnum,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s3">, </span><span class="s2">~audioBus_ex_1b</span><span class="s3">.index,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\trigRate</span><span class="s2">, [5, 500, </span><span class="s16">\lin</span><span class="s2">, 0, 50],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, [0.05, 0.99, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panType</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 1, 0],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panMax</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s15">\out</span><span class="s3">, </span><span class="s2">~audioBus_ex_1b</span><span class="s3">.index,</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// you might have to pass a different 'in' bus for SoundIn</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// depending on your setup</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s2">, 0,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\ampIn</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>],</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span>synth: [</span><span class="s2">\live_gran_1b</span><span class="s3">, </span><span class="s2">\soundIn</span><span class="s3">]</span></p>
<p class="p6"><span class="s2">).gui</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p14"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p17"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p7"><span class="s8"><b>2.) Live granulation driven by language</b></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">The crucial point of this strategy is a kind of incompatibility of In.ar and OffsetOut. Normally we use OffsetOut for exact buffer granulation with patterns, as the start of the synth (the grain) is corrected by a shift (standard Out.ar is only able to start at control block boundaries). However, when In.ar and OffsetOut.ar are used in the same synth the read input signal is also shifted, which results in a correct grain distance but an fluctuating input delay. This can be overcome by a little trick: we can use OffsetOut to send a trigger to a bus, which indicates its correct delay. Then the trigger can be read in the same synth and trigger again a gated envelope for the input signal, the resulting grain can be output with normal Out.ar. So grain distances are correct and input is not fluctuating (see Ex. 2d for an accuracy comparison). Nevertheless language-driven sequencing is not sample-exact in realtime, no matter if In.ar is used or not, this is related to hardware control and cannot be overcome. This might be an issue with a strictly periodic input signal and very short grain distances. You can e.g. check out with granulation of a fixed-pitch triangular wave or similar, every few seconds or so there will happen an audible jump due to an irregular time interval, which is necessary for clock calibration; at that point there will, in general, also be a phase shift of the input signal (see last example of 2d). This might not be noticed with an input of spoken voice e.g.</span></p>
<p class="p2"><span class="s2">Control block length is also a boundary for gated envelopes defined with EnvGen – here envelopes are established with an env buffer used by BufRd and Sweep ugens, a flexible method as Envelopes shape can be defined arbitrarily in language.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p8"><span class="s2"><b>Example 2a: <span class="Apple-converted-space">  </span>Basic Pbind live granulation</b></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">At that point I haven't seen a solution to pass the trigger bus as argument, in the example it is hard-wired. As the SynthDef uses a SetResetFF ugen, which relies on two triggers within control block length, grainDelta shouldn't be shorter than that. If shorter grainDeltas are required this would be possible with alternating SynthDefs and buses. For the same reason this SynthDef should only be used once at the same time by a Pbind/EventStreamPlayer. Alternatively – as in Ex. 2b – a SynthDef factory can produce a number of structurally equal SynthDefs bound to a number of buses.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p9"><span class="s2">// input bus and trigger bus</span></p>
<p class="p9"><span class="s2">// trigger bus must be hard-wired in SynthDef though</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~audioBus_ex_2a</span><span class="s2"> = </span><span class="s13">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s12">~trigBus_ex_2a</span><span class="s2"> = </span><span class="s13">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p6"><span class="s2">h = </span><span class="s13">Signal</span><span class="s2">.hanningWindow(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s13">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\soundIn</span><span class="s3">, { </span><span class="s2">|out, in, ampIn = 1|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, </span><span class="s13">SoundIn</span><span class="s2">.ar(in) * ampIn)</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\live_gran_2a</span><span class="s3">, { </span><span class="s2">|out, inBus, envBuf, grainDelta, pan = 0,</span></p>
<p class="p11"><span class="s2"><span class="Apple-tab-span">	</span>overlap = 1, amp = 1, minGrainDur = 0.001, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s17">var</span><span class="s2"> inSig, offset, env, numFrames = </span><span class="s13">BufFrames</span><span class="s2">.ir(envBuf), gate,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>defaultOffset = </span><span class="s13">ControlRate</span><span class="s2">.ir.reciprocal;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s13">In</span><span class="s2">.ar(inBus, 1);</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// low overlap bound given by minimal grain duration</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>overlap = max(overlap, minGrainDur / grainDelta);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// impulse for offset check</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">OffsetOut</span><span class="s3">.ar(</span><span class="s12">~trigBus_ex_2a</span><span class="s3">, </span><span class="s2">Impulse</span><span class="s3">.ar(0));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// additional gate to start with 0 in delayed case</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// this is necessary as OffsetOut outputs impulse twice</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>gate = </span><span class="s13">SetResetFF</span><span class="s2">.ar(</span><span class="s13">In</span><span class="s2">.ar(</span><span class="s12">~trigBus_ex_2a</span><span class="s2">));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s13">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Sweep</span><span class="s2">.ar(</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">In</span><span class="s3">.ar(</span><span class="s2">~trigBus_ex_2a</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(overlap * grainDelta).reciprocal * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// to finish synth</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Line</span><span class="s2">.ar(dur: overlap * grainDelta + defaultOffset, doneAction: 2);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// shifted accurate output</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, </span><span class="s13">Pan2</span><span class="s2">.ar(env * gate * inSig * amp, pan));</span></p>
<p class="p6"><span class="s2">}).add</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// to avoid feedback use with headphones<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// start synth and event stream player</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s2">p = </span><span class="s13">Pbind</span><span class="s2">(</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\live_gran_2a</span><span class="s3">,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s16">\inBus</span><span class="s3">, </span><span class="s2">~audioBus_ex_2a</span><span class="s3">,</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\envBuf</span><span class="s3">, e,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\dur</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~trigRate</span><span class="s2">.reciprocal },</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\grainDelta</span><span class="s3">, </span><span class="s13">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~overlap</span><span class="s2"> },</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~amp</span><span class="s2"> },</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\pan</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~panMax</span><span class="s2"> } * </span><span class="s13">PLseq</span><span class="s2">([1, -1]),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\addAction</span><span class="s3">, </span><span class="s2">\addToTail</span></p>
<p class="p6"><span class="s2">);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\trigRate</span><span class="s2">, [20, 500, </span><span class="s16">\lin</span><span class="s2">, 0, 100],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, [0.1, 2, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panMax</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\out</span><span class="s3">, </span><span class="s2">~audioBus_ex_2a</span><span class="s3">.index,</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// you might have to pass a different 'in' bus for SoundIn</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// depending on your setup</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s2">, 0,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\ampIn</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span>], p, </span><span class="s2">\soundIn</span></p>
<p class="p6"><span class="s2">).gui</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p8"><span class="s2"><b>Example 2b: <span class="Apple-converted-space">  </span>Parallel Pbind live granulation</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">As trigger buses have to be hard-wired, a SynthDef factory produces a number of structurally equal SynthDefs bound to a number of buses. In this variant the granulation is combined with a bandpass filter.</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p12"><span class="s2">// input bus and trigger bus</span></p>
<p class="p12"><span class="s2">// trigger bus must be hard-wired in SynthDef though</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~audioBus_ex_2b</span><span class="s2"> = </span><span class="s14">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p6"><span class="s2">h = </span><span class="s14">Signal</span><span class="s2">.hanningWindow(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s14">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\soundIn</span><span class="s3">, { </span><span class="s2">|out, in, ampIn = 1|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, </span><span class="s13">SoundIn</span><span class="s2">.ar(in) * ampIn)</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// "SynthDef factory", as each SynthDef neads hard-wired bus, make 3 of each</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~trigBus_ex_2b</span><span class="s2"> = { </span><span class="s14">Bus</span><span class="s2">.audio(s, 1) } ! 3;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p10"><span class="s3">{ </span><span class="s2">|i|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s20">var</span><span class="s2"> name = </span><span class="s15">\live_gran_2b</span><span class="s2"> ++ </span><span class="s21">"_"</span><span class="s2"> ++ i.asString;</span></p>
<p class="p10"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s14">SynthDef</span><span class="s3">(name, { </span><span class="s2">|out, inBus, envBuf, grainDelta, pan = 0, rq = 0.1, center = 500,</span></p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>overlap = 1, amp = 1, minGrainDur = 0.001, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s20">var</span><span class="s2"> sig, inSig, offset, env, numFrames = </span><span class="s14">BufFrames</span><span class="s2">.ir(envBuf), gate,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>defaultOffset = </span><span class="s14">ControlRate</span><span class="s2">.ir.reciprocal;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">In</span><span class="s2">.ar(inBus, 1);</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// amplitude compensation for lower rq of bandpass filter</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">BPF</span><span class="s2">.ar(inSig, center, rq, (rq ** -1) * (400 / center ** 0.5));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// low overlap bound given by minimal grain duration</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>overlap = max(overlap, minGrainDur / grainDelta);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// impulse for offset check</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">OffsetOut</span><span class="s2">.ar(</span><span class="s12">~trigBus_ex_2b</span><span class="s2">[i], </span><span class="s14">Impulse</span><span class="s2">.ar(0));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// additional gate to start with 0 in delayed case</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// this is necessary as OffsetOut outputs impulse twice</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gate = </span><span class="s14">SetResetFF</span><span class="s2">.ar(</span><span class="s14">In</span><span class="s2">.ar(</span><span class="s12">~trigBus_ex_2b</span><span class="s2">[i]));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>env = </span><span class="s14">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Sweep</span><span class="s2">.ar(</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">In</span><span class="s3">.ar(</span><span class="s2">~trigBus_ex_2b</span><span class="s3">[i]),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(overlap * grainDelta).reciprocal * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// to finish synth</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Line</span><span class="s2">.ar(dur: overlap * grainDelta + defaultOffset, doneAction: 2);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sig = env * gate * inSig * amp;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// shifted accurate output</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out, </span><span class="s14">Pan2</span><span class="s2">.ar(sig, pan));</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>}).add</span></p>
<p class="p6"><span class="s2">} ! 3</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// to avoid feedback use with headphones<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// start synth and event stream players</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p9"><span class="s2">// pattern maker, we need the three different instruments</span></p>
<p class="p6"><span class="s2">p = { </span><span class="s17">|i|</span><span class="s2"> </span><span class="s13">Pbind</span><span class="s2">(</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\live_gran_2b</span><span class="s3"> ++ </span><span class="s21">"_"</span><span class="s3"> ++ i.asString,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s16">\inBus</span><span class="s3">, </span><span class="s2">~audioBus_ex_2b</span><span class="s3">,</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\envBuf</span><span class="s3">, e,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\dur</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~trigRate</span><span class="s2">.reciprocal },</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\grainDelta</span><span class="s3">, </span><span class="s13">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~overlap</span><span class="s2"> },</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\rq</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~rq</span><span class="s2"> },</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\center</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~center</span><span class="s2"> },</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~amp</span><span class="s2"> },</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s16">\pan</span><span class="s2">, </span><span class="s13">Pfunc</span><span class="s2"> { </span><span class="s12">~panMax</span><span class="s2"> } * </span><span class="s13">PLseq</span><span class="s2">([1, -1]),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\addAction</span><span class="s3">, </span><span class="s2">\addToTail</span></p>
<p class="p6"><span class="s2">) };</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\trigRate</span><span class="s2">, [20, 500, </span><span class="s16">\lin</span><span class="s2">, 0, 100],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, [0.1, 2, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panMax</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\center</span><span class="s2">, [100, 3000, </span><span class="s16">\exp</span><span class="s2">, 0, 800],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\rq</span><span class="s2">, [0.1, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.1],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>] ! 3,[</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\out</span><span class="s3">, </span><span class="s2">~audioBus_ex_2b</span><span class="s3">.index,</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// you might have to pass a different 'in' bus for SoundIn</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// depending on your setup</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s2">, 0,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\ampIn</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>], p ! 3, </span><span class="s16">\soundIn</span></p>
<p class="p6"><span class="s2">).gui</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2"><br>
</span></p>
<p class="p19"><span class="s2"><br>
</span></p>
<p class="p8"><span class="s2"><b>Example 2c: <span class="Apple-converted-space">  </span>Live granulation with PbindFx</b></span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// extended ressources needed</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s2">s.options.numPrivateAudioBusChannels = 1024;</span></p>
<p class="p6"><span class="s2">s.options.memSize = 8192 * 16;</span></p>
<p class="p6"><span class="s2">s.reboot;</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p9"><span class="s2">// input bus and trigger bus</span></p>
<p class="p9"><span class="s2">// trigger bus must be hard-wired in SynthDef though</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~audioBus_ex_2c</span><span class="s2"> = </span><span class="s13">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s12">~trigBus_ex_2c</span><span class="s2"> = </span><span class="s13">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p6"><span class="s2">h = </span><span class="s13">Signal</span><span class="s2">.hanningWindow(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s13">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\soundIn</span><span class="s3">, { </span><span class="s2">|out, in, ampIn = 1|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, </span><span class="s13">SoundIn</span><span class="s2">.ar(in) * ampIn)</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// two fx SynthDefs</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\resample</span><span class="s3">, { </span><span class="s2">|out = 0, in, mix = 0.5, amp = 1, resampleRate = 44100|</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span></span><span class="s17">var</span><span class="s2"> sig, inSig = </span><span class="s13">In</span><span class="s2">.ar(in, 2);</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span>sig = </span><span class="s13">Latch</span><span class="s2">.ar(inSig, </span><span class="s13">Impulse</span><span class="s2">.ar(resampleRate));</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span></span><span class="s13">Out</span><span class="s2">.ar(out, ((1 - mix) * inSig + (sig * mix)) * amp);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\bpf</span><span class="s3">, { </span><span class="s2">|out = 0, in, freq = 440, rq = 0.1, amp = 1, mix = 1|</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span></span><span class="s17">var</span><span class="s2"> sig, inSig = </span><span class="s13">In</span><span class="s2">.ar(in, 2);</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span>sig = </span><span class="s13">BPF</span><span class="s2">.ar(inSig, freq, rq, (rq ** -1) * (400 / freq ** 0.5));</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span></span><span class="s13">Out</span><span class="s2">.ar(out, (mix * sig + ((1 - mix) * inSig)) * amp);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p11"><span class="s13">SynthDef</span><span class="s3">(</span><span class="s16">\live_gran_2c</span><span class="s3">, { </span><span class="s2">|out, inBus, envBuf, grainDelta, pan = 0,</span></p>
<p class="p11"><span class="s2"><span class="Apple-tab-span">	</span>overlap = 1, amp = 1, minGrainDur = 0.001, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s17">var</span><span class="s2"> inSig, offset, env, numFrames = </span><span class="s13">BufFrames</span><span class="s2">.ir(envBuf), gate,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>defaultOffset = </span><span class="s13">ControlRate</span><span class="s2">.ir.reciprocal;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s13">In</span><span class="s2">.ar(inBus, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// low overlap bound given by minimal grain duration</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>overlap = max(overlap, minGrainDur / grainDelta);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// impulse for offset check</span></p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">OffsetOut</span><span class="s3">.ar(</span><span class="s12">~trigBus_ex_2c</span><span class="s3">, </span><span class="s2">Impulse</span><span class="s3">.ar(0));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// additional gate to start with 0 in delayed case</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// this is necessary as OffsetOut outputs impulse twice</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>gate = </span><span class="s13">SetResetFF</span><span class="s2">.ar(</span><span class="s13">In</span><span class="s2">.ar(</span><span class="s12">~trigBus_ex_2c</span><span class="s2">));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s13">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">Sweep</span><span class="s2">.ar(</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">In</span><span class="s3">.ar(</span><span class="s2">~trigBus_ex_2c</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(overlap * grainDelta).reciprocal * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// to finish synth</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Line</span><span class="s2">.ar(dur: overlap * grainDelta + defaultOffset, doneAction: 2);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// shifted accurate output</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s13">Out</span><span class="s2">.ar(out, </span><span class="s13">Pan2</span><span class="s2">.ar(env * gate * inSig * amp, pan));</span></p>
<p class="p6"><span class="s2">}).add</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p9"><span class="s2">// start without fx</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p14"><span class="s2">~fxOrder</span><span class="s3"> = 0;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// playing the PbindFx in a new group ensures that soundIn synth is placed before when started later</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">g = </span><span class="s13">Group</span><span class="s2">.new;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s3">p = </span><span class="s2">PbindFx</span><span class="s3">([</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\live_gran_2c</span><span class="s3">,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\inBus</span><span class="s3">, </span><span class="s2">~audioBus_ex_2c</span><span class="s3">,</span></p>
<p class="p9"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// allow hard-wired bus (bus connections check)</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\otherBusArgs</span><span class="s2">, [</span><span class="s16">\inBus</span><span class="s2">, </span><span class="s12">~trigBus_ex_2c</span><span class="s2">.index.asFloat],</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\envBuf</span><span class="s3">, e,</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\dur</span><span class="s3">, 1 / </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\trigRate</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\grainDelta</span><span class="s3">, </span><span class="s13">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\overlap</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\overlap</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\amp</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\pan</span><span class="s2">, </span><span class="s13">PL</span><span class="s2">(</span><span class="s16">\panMax</span><span class="s2">) * </span><span class="s13">PLseq</span><span class="s2">([1, -1]),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\fxOrder</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\fxOrder</span><span class="s3">, envir: </span><span class="s2">'t'</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\cleanupDelay</span><span class="s3">, 0.1,</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\group</span><span class="s3">, g</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\fx</span><span class="s3">, </span><span class="s2">\resample</span><span class="s3">,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\mix</span><span class="s2">, 1,</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\amp_resample</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\resampleRate</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\resampleRate_resample</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\cleanupDelay</span><span class="s3">, 0.01</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\fx</span><span class="s3">, </span><span class="s2">\bpf</span><span class="s3">,</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\freq</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\freq_bpf</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\rq</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\rq_bpf</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\mix</span><span class="s2">, 1,</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\amp</span><span class="s3">, </span><span class="s13">PL</span><span class="s3">(</span><span class="s2">\amp_bpf</span><span class="s3">),</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\cleanupDelay</span><span class="s3">, 0.01</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>]</span></p>
<p class="p6"><span class="s2">);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p13"><span class="s2">VarGui</span><span class="s3">([</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\trigRate</span><span class="s2">, [20, 500, </span><span class="s16">\lin</span><span class="s2">, 0, 100],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\overlap</span><span class="s2">, [0.1, 2, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\panMax</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.5],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.1],</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\resampleRate_resample</span><span class="s2">, [200, 3000, </span><span class="s16">\exp</span><span class="s2">, 0, 500],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp_resample</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1],</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\freq_bpf</span><span class="s2">, [50, 3000, </span><span class="s16">\exp</span><span class="s2">, 0, 200],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\rq_bpf</span><span class="s2">, [0.1, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 0.3],</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\amp_bpf</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>],[</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\out</span><span class="s3">, </span><span class="s2">~audioBus_ex_2c</span><span class="s3">.index,</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// you might have to pass a different 'in' bus for SoundIn</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">// depending on your setup</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\in</span><span class="s2">, 0,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s16">\ampIn</span><span class="s2">, [0, 1, </span><span class="s16">\lin</span><span class="s2">, 0, 1]</span></p>
<p class="p15"><span class="s3"><span class="Apple-tab-span">	</span>], p, </span><span class="s2">\soundIn</span></p>
<p class="p6"><span class="s2">).gui(</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span>varColorGroups: (0..8).clumps([4, 2, 3]),</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span>tryColumnNum: 1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span>labelWidth: 140,</span></p>
<p class="p6"><span class="s2"><span class="Apple-converted-space">    </span>sliderWidth: 350</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// check fxs and their params, mix is fixed to 1</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// resample</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p14"><span class="s2">~fxOrder</span><span class="s3"> = 1</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// band pass</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p14"><span class="s2">~fxOrder</span><span class="s3"> = 2</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// resample -&gt; band pass</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = [1, 2]</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// band pass -&gt; resample<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = [2, 1]</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p9"><span class="s2">// fx alternations</span></p>
<p class="p9"><span class="s2">// Pstutter with repeats equal 2 ensures L/R balance</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = </span><span class="s13">Pstutter</span><span class="s2">(2, </span><span class="s13">PLseq</span><span class="s2">([1, 2]))</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = </span><span class="s13">Pstutter</span><span class="s2">(2, </span><span class="s13">PLseq</span><span class="s2">([[1, 2], 1]))</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = </span><span class="s13">Pstutter</span><span class="s2">(2, </span><span class="s13">PLseq</span><span class="s2">([[1, 2], 2]))</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = </span><span class="s13">Pstutter</span><span class="s2">(2, </span><span class="s13">PLseq</span><span class="s2">([[2, 1], 1]))</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~fxOrder</span><span class="s2"> = </span><span class="s13">Pstutter</span><span class="s2">(2, </span><span class="s13">PLseq</span><span class="s2">([[2, 1], 2]))</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s19">~fxOrder</span><span class="s2"> = </span><span class="s14">Pstutter</span><span class="s2">(2, </span><span class="s14">PLseq</span><span class="s2">([[1, 2], [2, 1]]))</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s2"><br>
</span></p>
<p class="p20"><span class="s2"><b>Example 2d: <span class="Apple-converted-space">  </span>Accuracy comparison</b></span></p>
<p class="p20"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2">This example compares the inaccuracies occuring with "normal" usage of Out.ar and the usage of In.ar + OffsetOut.ar with the strategy recommended in Ex. 2a. Run the three examples, the audio output is played and recorded into three files in the recordings directory (you get the path with thisProcess.platform.recordingsDir).</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// test with source of added sines, inaccuracies with straight use of Out.ar</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s12">~audioBus_ex_2d1</span><span class="s2"> = </span><span class="s14">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p12"><span class="s2">// envelope with sharp attack to make effect more clear</span></p>
<p class="p6"><span class="s2">h = </span><span class="s14">Env</span><span class="s2">([0, 1, 1, 0], [1, 10, 1].normalizeSum, curve: </span><span class="s15">\sine</span><span class="s2">).discretize(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s14">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// sine as test signal</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\sineIn</span><span class="s3">, { </span><span class="s2">|directOut, granOut, freq = 200, amp = 0.03, in|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>freq = freq * (1..8);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(directOut, </span><span class="s14">SinOsc</span><span class="s2">.ar(freq).sum * amp * </span><span class="s14">EnvGate</span><span class="s2">.new);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(granOut, </span><span class="s14">SinOsc</span><span class="s2">.ar(freq).sum * amp);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// envelopes in left channel, granulation in right</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\live_gran_shaky_1</span><span class="s3">, { </span><span class="s2">|out, inBus, envBuf, grainDelta,</span></p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span>overlap = 1, amp = 1, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s20">var</span><span class="s2"> inSig, offset, env, numFrames = </span><span class="s14">BufFrames</span><span class="s2">.ir(envBuf),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>defaultOffset = </span><span class="s14">ControlRate</span><span class="s2">.ir.reciprocal;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">In</span><span class="s2">.ar(inBus, 1);</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback with sound in source</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s14">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Sweep</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(overlap * grainDelta).reciprocal * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// to finish synth</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Line</span><span class="s2">.ar(dur: overlap * grainDelta + defaultOffset, doneAction: 2);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out + 1, inSig * env);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p21"><span class="s3">p = </span><span class="s2">Pfindur</span><span class="s3">(1, </span><span class="s2">Pbind</span><span class="s3">(</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\live_gran_shaky_1</span><span class="s3">,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s15">\inBus</span><span class="s3">, </span><span class="s2">~audioBus_ex_2d1</span><span class="s3">,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\envBuf</span><span class="s3">, e,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\dur</span><span class="s2">, 0.005,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\grainDelta</span><span class="s3">, </span><span class="s14">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\overlap</span><span class="s3">, 0.5,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, 0.1,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\addAction</span><span class="s3">, </span><span class="s2">\addToTail</span></p>
<p class="p6"><span class="s2">));</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p12"><span class="s2">// record live input and granulation (which comes with delay due to normal pbind latency)</span></p>
<p class="p12"><span class="s2">// see the file in an editor then:</span></p>
<p class="p12"><span class="s2">// distances are irregular due to Out ugen's accuracy limit control block boundary,</span></p>
<p class="p12"><span class="s2">// though source signal is not delayed</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">{</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">~date</span><span class="s2"> = </span><span class="s14">Date</span><span class="s2">.getDate.stamp;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">~fileName</span><span class="s2"> = </span><span class="s22">thisProcess</span><span class="s2">.platform.recordingsDir +/+</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span>(</span><span class="s2">"live_gran_shaky_1"</span><span class="s3"> ++ </span><span class="s2">"_"</span><span class="s3"> ++ </span><span class="s19">~date</span><span class="s3"> ++ </span><span class="s2">".aiff"</span><span class="s3">);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.record(</span><span class="s19">~fileName</span><span class="s2">);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.sync;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>x = </span><span class="s14">Synth</span><span class="s2">(</span><span class="s15">\sineIn</span><span class="s2">, args: [directOut: 0, granOut: </span><span class="s12">~audioBus_ex_2d1</span><span class="s2">]);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>p.play;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>1.5.wait;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>x.release;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.stopRecording;</span></p>
<p class="p6"><span class="s2">}.fork</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p14"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">/////////////////////////</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// test with source of added sines, inaccuracies with use of In.ar + OffsetOut.ar<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s12">~audioBus_ex_2d2</span><span class="s2"> = </span><span class="s14">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p12"><span class="s2">// envelope with sharp attack to make effect more clear</span></p>
<p class="p6"><span class="s2">h = </span><span class="s14">Env</span><span class="s2">([0, 1, 1, 0], [1, 10, 1].normalizeSum, curve: </span><span class="s15">\sine</span><span class="s2">).discretize(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s14">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// sine as test signal</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\sineIn</span><span class="s3">, { </span><span class="s2">|directOut, granOut, freq = 200, amp = 0.03, in|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>freq = freq * (1..8);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(directOut, </span><span class="s14">SinOsc</span><span class="s2">.ar(freq).sum * amp * </span><span class="s14">EnvGate</span><span class="s2">.new);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(granOut, </span><span class="s14">SinOsc</span><span class="s2">.ar(freq).sum * amp);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// envelopes in left channel, granulation in right</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\live_gran_shaky_2</span><span class="s3">, { </span><span class="s2">|out, inBus, envBuf, grainDelta,</span></p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span>overlap = 1, amp = 1, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s20">var</span><span class="s2"> inSig, offset, env, numFrames = </span><span class="s14">BufFrames</span><span class="s2">.ir(envBuf),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>defaultOffset = </span><span class="s14">ControlRate</span><span class="s2">.ir.reciprocal;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">In</span><span class="s2">.ar(inBus, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback with sound in source</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s14">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Sweep</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(overlap * grainDelta).reciprocal * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// to finish synth</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Line</span><span class="s2">.ar(dur: overlap * grainDelta + defaultOffset, doneAction: 2);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">OffsetOut</span><span class="s2">.ar(out + 1, inSig * env);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p21"><span class="s3">p = </span><span class="s2">Pfindur</span><span class="s3">(1, </span><span class="s2">Pbind</span><span class="s3">(</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\live_gran_shaky_2</span><span class="s3">,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s15">\inBus</span><span class="s3">, </span><span class="s2">~audioBus_ex_2d2</span><span class="s3">,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\envBuf</span><span class="s3">, e,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\dur</span><span class="s2">, 0.005,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\grainDelta</span><span class="s3">, </span><span class="s14">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\overlap</span><span class="s3">, 0.5,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, 0.1,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\addAction</span><span class="s3">, </span><span class="s2">\addToTail</span></p>
<p class="p6"><span class="s2">));</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// record live input and granulation (which comes with delay due to normal pbind latency)</span></p>
<p class="p12"><span class="s2">// see the file in an editor then:</span></p>
<p class="p12"><span class="s2">// distances are regular due to OffsetOut, but source signal is delayed</span></p>
<p class="p12"><span class="s2">// between 0 and control block length</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p6"><span class="s2">{</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">~date</span><span class="s2"> = </span><span class="s14">Date</span><span class="s2">.getDate.stamp;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">~fileName</span><span class="s2"> = </span><span class="s22">thisProcess</span><span class="s2">.platform.recordingsDir +/+</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span>(</span><span class="s2">"live_gran_shaky_2"</span><span class="s3"> ++ </span><span class="s2">"_"</span><span class="s3"> ++ </span><span class="s19">~date</span><span class="s3"> ++ </span><span class="s2">".aiff"</span><span class="s3">);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.record(</span><span class="s19">~fileName</span><span class="s2">);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.sync;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>x = </span><span class="s14">Synth</span><span class="s2">(</span><span class="s15">\sineIn</span><span class="s2">, args: [directOut: 0, granOut: </span><span class="s12">~audioBus_ex_2d2</span><span class="s2">]);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>p.play;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>1.5.wait;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>x.release;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.stopRecording;</span></p>
<p class="p6"><span class="s2">}.fork</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p2"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">/////////////////////////</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// test with source of added sines, granulation done as in Ex. 2a <span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p12"><span class="s2">// input bus and trigger bus</span></p>
<p class="p12"><span class="s2">// trigger bus must be hard-wired in SynthDef though</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s12">~audioBus_ex_2d3</span><span class="s2"> = </span><span class="s14">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s12">~trigBus_ex_2d3</span><span class="s2"> = </span><span class="s14">Bus</span><span class="s2">.audio(s, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// pass envelopes with buffer</span></p>
<p class="p12"><span class="s2">// envelope with sharp attack to make effect more clear</span></p>
<p class="p6"><span class="s2">h = </span><span class="s14">Env</span><span class="s2">([0, 1, 1, 0], [1, 10, 1].normalizeSum, curve: </span><span class="s15">\sine</span><span class="s2">).discretize(1000);</span></p>
<p class="p6"><span class="s2">e = </span><span class="s14">Buffer</span><span class="s2">.loadCollection(s, h);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// sine as test signal</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\sineIn</span><span class="s3">, { </span><span class="s2">|directOut, granOut, freq = 200, amp = 0.03, in|</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>freq = freq * (1..8);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(directOut, </span><span class="s14">SinOsc</span><span class="s2">.ar(freq).sum * amp * </span><span class="s14">EnvGate</span><span class="s2">.new);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(granOut, </span><span class="s14">SinOsc</span><span class="s2">.ar(freq).sum * amp);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// envelopes in left channel, granulation in right</span></p>
<p class="p10"><span class="s14">SynthDef</span><span class="s3">(</span><span class="s15">\live_gran_ok</span><span class="s3">, { </span><span class="s2">|out, inBus, envBuf, grainDelta, gate,</span></p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span>overlap = 1, amp = 1, interpolation = 4|</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s20">var</span><span class="s2"> inSig, offset, env, numFrames = </span><span class="s14">BufFrames</span><span class="s2">.ir(envBuf),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>defaultOffset = </span><span class="s14">ControlRate</span><span class="s2">.ir.reciprocal;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">In</span><span class="s2">.ar(inBus, 1);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// reduce feedback with sound in source</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>inSig = </span><span class="s14">LPF</span><span class="s2">.ar(inSig.tanh, 2000);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// impulse for offset check</span></p>
<p class="p21"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">OffsetOut</span><span class="s3">.ar(</span><span class="s12">~trigBus_ex_2d3</span><span class="s3">, </span><span class="s2">Impulse</span><span class="s3">.ar(0));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// necessary additional gate to start with 0 in delayed case</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>gate = </span><span class="s14">SetResetFF</span><span class="s2">.ar(</span><span class="s14">In</span><span class="s2">.ar(</span><span class="s12">~trigBus_ex_2d3</span><span class="s2">));</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>env = </span><span class="s14">BufRd</span><span class="s2">.ar(</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>envBuf,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">Sweep</span><span class="s2">.ar(</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s14">In</span><span class="s3">.ar(</span><span class="s2">~trigBus_ex_2d3</span><span class="s3">),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(overlap * grainDelta).reciprocal * numFrames,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).clip(0, numFrames - 1),</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>interpolation: interpolation</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>);</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// to finish synth</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Line</span><span class="s2">.ar(dur: overlap * grainDelta + defaultOffset, doneAction: 2);</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">// shifted accurate output</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">Out</span><span class="s2">.ar(out + 1, inSig * env * gate);</span></p>
<p class="p6"><span class="s2">}).add;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p21"><span class="s3">p = </span><span class="s2">Pfindur</span><span class="s3">(1, </span><span class="s2">Pbind</span><span class="s3">(</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\instrument</span><span class="s3">, </span><span class="s2">\live_gran_ok</span><span class="s3">,</span></p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s15">\inBus</span><span class="s3">, </span><span class="s2">~audioBus_ex_2d3</span><span class="s3">,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\envBuf</span><span class="s3">, e,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\dur</span><span class="s2">, 0.005,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\grainDelta</span><span class="s3">, </span><span class="s14">Pkey</span><span class="s3">(</span><span class="s2">\dur</span><span class="s3">),</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\overlap</span><span class="s3">, 0.5,</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s15">\amp</span><span class="s2">, 0.1,</span></p>
<p class="p22"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s2">\addAction</span><span class="s3">, </span><span class="s2">\addToTail</span></p>
<p class="p6"><span class="s2">));</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">(</span></p>
<p class="p12"><span class="s2">// record live input and granulation (which comes with delay due to normal pbind latency)</span></p>
<p class="p12"><span class="s2">// see the file in an editor then:</span></p>
<p class="p12"><span class="s2">// distances are regular due to OffsetOut, and source signal is not delayed</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p12"><span class="s2">// However also in this case, because of hardware output calibration, </span><span class="s23">it happens that </span><span class="s2">phase shifts</span></p>
<p class="p12"><span class="s2">// occur in granulation.</span></p>
<p class="p12"><span class="s2">// This is currently unavoidable in SC's realtime mode, but probably irrelevant in most cases of<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s2">// live granulation, where there is no strictly periodic input signal</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2">{</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">~date</span><span class="s2"> = </span><span class="s14">Date</span><span class="s2">.getDate.stamp;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s19">~fileName</span><span class="s2"> = </span><span class="s22">thisProcess</span><span class="s2">.platform.recordingsDir +/+</span></p>
<p class="p23"><span class="s3"><span class="Apple-tab-span">	</span>(</span><span class="s2">"\live_gran_ok"</span><span class="s3"> ++ </span><span class="s2">"_"</span><span class="s3"> ++ </span><span class="s19">~date</span><span class="s3"> ++ </span><span class="s2">".aiff"</span><span class="s3">);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.record(</span><span class="s19">~fileName</span><span class="s2">);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.sync;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>x = </span><span class="s14">Synth</span><span class="s2">(</span><span class="s15">\sineIn</span><span class="s2">, args: [directOut: 0, granOut: </span><span class="s12">~audioBus_ex_2d3</span><span class="s2">]);</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>p.play;</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>1.5.wait;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>x.release;</span></p>
<p class="p6"><span class="s2"><span class="Apple-tab-span">	</span>s.stopRecording;</span></p>
<p class="p6"><span class="s2">}.fork</span></p>
<p class="p6"><span class="s2">)</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
<p class="p6"><span class="s2"><br>
</span></p>
</body>
</html>
