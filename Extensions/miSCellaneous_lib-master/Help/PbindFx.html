<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1187.4">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #042eee}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p8 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 85.0px; text-indent: -85.0px; font: 12.0px Helvetica}
p.p10 {margin: 0.0px 0.0px 0.0px 85.0px; text-indent: -85.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Arial}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p15 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p16 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Helvetica; min-height: 11.0px}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #c41a00}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00}
p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0433ff}
p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; min-height: 12.0px}
p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #cd1c00}
p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco}
p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #0326cb}
p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #008300}
p.p25 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p26 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0326cb}
p.p27 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #008300}
p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #c40000}
p.p29 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00; min-height: 12.0px}
p.p30 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c08; min-height: 12.0px}
p.p31 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c08}
p.p32 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #de1f06}
p.p33 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0243f7}
p.p34 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0133c4}
p.p35 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #008322}
p.p36 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0135cb}
p.p37 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #008324}
p.p38 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco}
p.p39 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #cd1c00}
p.p40 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #008300}
p.p41 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #0326cb}
p.p42 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0326cb; min-height: 12.0px}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #000000}
span.s3 {text-decoration: underline}
span.s4 {color: #00bbff}
span.s5 {text-decoration: underline ; color: #042eee}
span.s6 {text-decoration: underline ; color: #0000ee}
span.s7 {font: 5.0px Helvetica}
span.s8 {font: 6.0px Helvetica}
span.s9 {text-decoration: underline ; color: #0043f7}
span.s10 {font: 12.0px Helvetica}
span.s11 {font: 12.0px Arial}
span.s12 {font: 9.0px Monaco}
span.s13 {color: #008300}
span.s14 {color: #0326cb}
span.s15 {color: #434ccb}
span.s16 {color: #0433ff}
span.s17 {color: #c41a00}
span.s18 {color: #ff7c00}
span.s19 {color: #0133c4}
span.s20 {color: #008322}
span.s21 {color: #0243f7}
span.s22 {color: #c41a08}
span.s23 {color: #008324}
span.s24 {color: #0135cb}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>PbindFx<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>event pattern for effect handling on per-event base<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></b></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>Part of:</b> <a href="miSCellaneous.html"><span class="s3">miSCellaneous</span></a></span></p>
<p class="p2"><br></p>
<p class="p1"><b>Inherits from: Pchain</b></p>
<p class="p4"><span class="s2"><br>
<b>See also:</b> <a href="Introduction to miSCellaneous.html"><span class="s3">Introduction to miSCellaneous</span></a></span><span class="s4">,</span><span class="s2"> <a href="Buffer Granulation.html"><span class="s3">Buffer Granulation</span></a>, <a href="Live Granulation.html"><span class="s3">Live Granulation</span></a>, <a href="kitchen studies.html"><span class="s3">kitchen studies</span></a></span><span class="s4">, <a href="PmonoPar.html"><span class="s5">PmonoPar</span></a></span><span class="s3">,</span><span class="s2"> <a href="PpolyPar.html"><span class="s6">PpolyPar</span></a></span><span class="s3">,</span><span class="s4"> <a href="DX suite.html"><span class="s5">DX suite</span></a></span><span class="s2">, <a href="DXMix.html"><span class="s6">DXMix</span></a>, <a href="DXMixIn.html"><span class="s6">DXMixIn</span></a>,<b> </b><a href="DXEnvFan.html"><span class="s6">DXEnvFan</span></a>,<b> </b><a href="DXEnvFanOut.html"><span class="s6">DXEnvFanOut</span></a>, <a href="DXFan.html"><span class="s6">DXFan</span></a>, <a href="DXFanOut.html"><span class="s6">DXFanOut</span></a></span><span class="s4">,</span><span class="s2"> <a href="../../ZeroXBufRd.html"><span class="s3">ZeroXBufRd</span></a>,<b> </b><a href="../../TZeroXBufRd.html"><span class="s3">TZeroXBufRd</span></a>,<b> </b><a href="../../ZeroXBufWr.html"><span class="s3">ZeroXBufWr</span></a></span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">PbindFx works like a normal Pbind of event type 'note' in most regards, but with the additional option to define a number of effects. Their order and parameters can also be defined with patterns which allows a great flexibility: for each event an arbitrary multichannel effect graph can be applied, mixing sequential and parallel arrangement ad libitum. This requires a relatively high amount of resource management: bus allocation, routing and node ordering as well as delayed cleanup have to be done for each event. All necessary bookkeeping is done automatically, for some critical parameters though it's the user's responsibility to pass meaningful values (e.g. cleanupDelay for reverb has to be defined sufficiently high, otherwise reverb synth and audio bus might be freed before reverb has ended). There is always a tradeoff between flexibility and processing effort, if you won't change fx parameters on a per-event base or you won't reorder your effect arrangement, then you might prefer playing effects from and to predefined buses and control them otherwise, e.g. per LFOs (additionally possible also with PbindFx) or dedicated setting streams, see <a href="PmonoPar.html"><span class="s5">PmonoPar</span></a> and <a href="PpolyPar.html"><span class="s5">PpolyPar</span></a>. However with the strategy of effects bound to buses you have the same effect arrangements and parameters concerning all source signals sent to the same bus, more variation with such setups needs more (pre-)definition of buses, whereas with PbindFx overlapping events can be processed with different effect arrangements and parameters with no explicit effort. <span class="Apple-converted-space"> </span></p>
<p class="p1">One possible application of PbindFx is applying effects per grain, for the project <a href="kitchen studies.html"><span class="s5">kitchen studies</span></a> I documented the source code of a fixed media piece in six parts, using this technique.</p>
<p class="p2"><br></p>
<p class="p1"><b>WARNING:</b></p>
<p class="p1">As bus allocation is done dynamically per event, there is a circumvented, but still potential danger of creating feedback loops. To prevent this, additional "zero synths" are started with bus-reading fx synths, playing a zero signal with ReplaceOut to the buses in question, they are placed before those fx / source synth(s), which will play there too. For all test examples, even with deliberately bad values, zero synths turned out to be an effective way to block unwanted input signals and feedback, as they last as long as fx / source synths (they even overlap them a bit). However, with extraordinary parameter values for timing, improperly defined fx / source synths, sloppy audio bus mapping and / or parallel actions that affect resource management globally, feedback, as in any situation of heavy bus repatching, can not be totally excluded. Be aware of that, avoid high levels and be careful with headphones !</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5"><b>Creation / Class Methods</b></p>
<p class="p6"><br></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>*new (pbindData ... fxData)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Creates a new PbindFx object.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>pbindData </b>- SequenceableCollection of Pbind's key/value pairs or event pattern.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Passing a list saves explicitely typing Pbind, but passing an event pattern is more flexible,</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>as it allows replacement (Ex.7), event pattern filtering (Ex.3a) and similar operations.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specific keys:</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\fxOrder </b>- For each event it can be given in three ways, for single effects and</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sequential ordering it may be<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>(a) an Integer</b>, or<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>(b) a SequenceableCollection of Integers</b>,<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>indicating the effect order. Effect counting starts with 1, 0 means no effect (default).</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>E.g. if three effects are passed to <b>fxData</b>, [1], [2], [3], [1, 2], [1, 3], [2, 3],<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[2, 1], [3, 1], [3, 2], [1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1],</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>would represent all possible effect orders with each effect applied once.<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Passing single Integers is equivalent to passing them in an array.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Data concerning one event can also be given as</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>(c) a Ref object containing an IdentityDictionary</b>, representing the effect graph.<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Keys of the dictionary – single Integers – are identified with effects of <b>fxData</b>, values</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>of the dictionary might be single Integers or SequenceableCollections of</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Integers, indicating a branching of effects (whenever you want a branching of effects</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>or routing two different effects to a third one, the input must be given as a ref'd IdentityDictionary).</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Within the effect graph an explicit direct out can be denoted with the Symbol \o,</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0 represents the source. The graph must be acyclic, a check is performed.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>fxOrder</b> can also be a Pattern, sequencing effect orders of the forms (a) - (c).</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>See principles of operation below and examples 10 (a)-(c).</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\cleanupDelay </b>- Number or Pattern to generate Numbers, taken as seconds.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Its meaning differs, depending if source synth (passed by \instrument) has</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a gated or fixed length envelope. If a gate control is encountered in the SynthDef</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>description, a gated envelope is assumed.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>In the latter case this arg determines the earliest time after release when</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>cleanup may start. With a fixed-length envelope it determines the earliest time<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>after synth start when cleanup may start.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>With effects defined, cleanupDelays of source and effects are summarized.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Defaults to the class variable <b>defaultSourceCleanupDelay </b>which defaults to 0.3.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Typically you would take the releaseTime of the source synth's / synthdef's<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gated envelope, or the maximum overall length of the fixed-length envelope,</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>each plus a small delta.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\cleanupClock </b>- The clock on which freeing of audio buses is scheduled with SkipJack objects.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>As the clock should survive CmdPeriod its permanent flag must be set to true.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Per default the SystemClock is used, but for certain cases, e.g. granulation<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>you might want to pass a TempoClock with higher queueSize, see examples below.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\cleanupDt </b>- Number or Pattern to generate Numbers, taken as seconds.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Determines the delta time for cleanup with SkipJack objects. In those intervals<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>it is checked whether event-specific cleanup delaytimes have been reached<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>and cleanup (freeing buses) should be performed. Defaults to the class variable<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>defaultCleanupDt </b>which defaults to 0.2. With higher values more SkipJack objects</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>have to be scheduled at the same time, although with fewer activity.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\freePerGroup </b>- Boolean, defaults to false.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Determines if effects and zero synths of the chain should be freed separately or</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>removed at the end of the chain by freeing the enclosing group.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>With more effects and longer cleanupDelays the latter leads to a larger number</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>of parallel synths and might be wasteful thus. On the other hand it can be<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a useful option with short events and cleanupDelays, e.g. in case of granulation.<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>See below timing scheme for a more detailled description.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\otherBusArgs </b>- Takes SequenceableCollection of Symbols, defaults to nil.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>For all passed symbols the source synth is enabled to read from and write to external buses,</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>which are passed to an arg of that name, LocalIn and LocalOut are allowed anyway.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Per default a restrictive check of synth I/O ugens and matching is performed in order to prevent</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>unintended reading from resp. writing to buses. With this option you can allow reading</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>and writing in a controlled way, see Ex. 6a and 6b.</p>
<p class="p10"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>fxData </b>- SequenceableCollection(s) of key/value pairs defining effect sequencing or event pattern.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Passing a list saves explicitely typing Pbind, but passing an event pattern is more flexible,</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>as it allows replacement (Ex.7), event pattern filtering (Ex.3a) and similar operations.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specific keys:</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\fx </b>- <span class="Apple-tab-span">	</span>Symbol or Pattern to generate Symbols.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Determines the effect synthdef.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\cleanupDelay </b>- Number or Pattern to generate Numbers, taken as seconds.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Determines the earliest time after effect node delay when cleanup,<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>including freeing the effect synth, may start.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>With effects defined, cleanupDelays of source and effects are summarized.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Defaults to the class variable <b>defaultFxCleanupDelay </b>which defaults to 0.05.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Typically you would take the maximum delay of the effect synth plus a small delta.<span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>\otherBusArgs </b>- Takes SequenceableCollection of Symbols, defaults to nil.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>For all passed symbols the fx synth is enabled to read from and write to external buses,</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>which are passed to an arg of that name, LocalIn and LocalOut are allowed anyway.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Per default a restrictive check of synth I/O ugens and matching is performed in order to prevent</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>unintended reading from resp. writing to buses. With this option you can allow reading</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>in a controlled way, see Ex. 6a and 6b.</p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span>*<b>defaultSourceCleanupDelay<span class="Apple-converted-space"> </span></b></p>
<p class="p10"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Get the value of this class variable. Defaults to 0.3.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span>*<b>defaultSourceCleanupDelay_(value)</b></p>
<p class="p10"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Set this class variable to <b>value</b>.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span>*<b>defaultCleanupDt<span class="Apple-converted-space"> </span></b></p>
<p class="p10"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Get the value of this class variable. Defaults to 0.2.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span>*<b>defaultCleanupDt_(value)</b></p>
<p class="p10"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Set this class variable to <b>value</b>.<span class="Apple-converted-space"> </span></p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span>*<b>defaultFxCleanupDelay<span class="Apple-converted-space"> </span></b></p>
<p class="p10"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Get the value of this class variable. Defaults to 0.05.</p>
<p class="p10"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span>*<b>defaultFxCleanupDelay_(value)</b></p>
<p class="p10"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Set this class variable to <b>value</b>.<span class="Apple-converted-space"> </span></p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p5"><b>Principle of operation</b></p>
<p class="p11"><br></p>
<p class="p1"><b>Per-event effect routing with PbindFx, example scheme of two effects applied sequentially:</b></p>
<p class="p2"><br></p>
<p class="p1">This can typically be achieved by passing an array [i, j] to \fxOrder, where i and j denote</p>
<p class="p1">arbitrary unequal positive effect numbers (numbers smaller or equal than the size of <b>fxData</b>).</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p1">Effects FX#1 and FX#2 read from buses BUS#1 and BUS#2 which are reserved for the duration<span class="Apple-converted-space"> </span></p>
<p class="p1">of the event plus a cleanup time. BUS#1 and BUS#2 get their data from source synth SRC resp. FX#1.<span class="Apple-converted-space"> </span></p>
<p class="p1">"Zero synths" Z#1 and Z#2 are placed before them in node order, they are lasting as long as<span class="Apple-converted-space"> </span></p>
<p class="p1">(in fact a bit longer than) FX#1 and FX#2, playing zero signals to BUS#1 and BUS#2 with ReplaceOut and<span class="Apple-converted-space"> </span></p>
<p class="p1">cancelling out possible residual signals on those buses, thus blocking feedback.<span class="Apple-converted-space"> </span></p>
<p class="p1">BUS#1 and BUS#2 might be multichannel buses, in that case a number of mono zero synths<span class="Apple-converted-space"> </span></p>
<p class="p1">is established for each Z#i.<span class="Apple-converted-space"> </span></p>
<p class="p1">Two dedicated groups are generated for each event: FXGRP is the container for all</p>
<p class="p1">event-generated synths and SRCGRP is placed at its head. Z#1 is placed at the head of</p>
<p class="p1">SRCGRP, other zero synths and effects are sequentially placed upwards from the tail</p>
<p class="p1">of FXGRP, interlaced in the way described below.</p>
<p class="p1">Finally source synth(s) are placed at tail of SRCGRP (the group passed further to the note event).</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-tab-span">	</span>node ordering for n = 2</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-tab-span">	</span>FXGRP:</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>SRCGRP:</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Z#1</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>SRC</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Z#2<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></p>
<p class="p1"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>FX#1<span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>FX#2<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">You can also pass a group (or a pattern of groups) to PbindFx, in that case</p>
<p class="p1">FXGRP is related to the group depending on \addAction (default \addToHead):</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-tab-span">	</span>general node ordering with n sequentially applied effects for n &gt; 2<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>group GRP passed to PbindFx with key \group,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>default addAction \addToHead</p>
<p class="p2"><br></p>
<p class="p1"><span class="s8"><span class="Apple-tab-span">	</span></span>GRP:</p>
<p class="p1"><span class="Apple-converted-space"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>FXGRP:</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>SRCGRP:</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Z#1</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>SRC</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Z#2<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></p>
<p class="p1"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>FX#1<span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>...</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>...</p>
<p class="p1"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>Z#n</p>
<p class="p1"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>FX#n-1<span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>FX#n<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">Note that effect order is arbitrary per event, determined by key <b>\fxOrder</b>,<span class="Apple-converted-space"> </span></p>
<p class="p1">in these examples FX#i denote the order in the regarded event,<span class="Apple-converted-space"> </span></p>
<p class="p1">not the order in which the effects are passed to PbindFx.</p>
<p class="p1">The whole process is implemented via dedicated event type 'pbindFx',<span class="Apple-converted-space"> </span></p>
<p class="p1">an extension of event type 'note', which is chosen with PbindFx by default.</p>
<p class="p9">The following schemes refer to server-side timing, additional lang-side offset might be passed with<span class="Apple-converted-space"> </span></p>
<p class="p9">lag (in seconds) to ensure proper timing for sequences combining delayed and non-delayed effects<span class="Apple-converted-space"> </span></p>
<p class="p9">e.g. including occasional echo as in several of the examples below.</p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p1"><b>Timing scheme of PbindFx with two effects applied sequentially,<span class="Apple-converted-space"> </span></b></p>
<p class="p1"><b>source synth with gated envelope:</b></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">t#0:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>start SRC, Z#i, FX#i and groups with server-side ordering as described in routing scheme,</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>in fact Z#i are started slightly earlier.</p>
<p class="p1">t#1:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>begin of SRC envelope release period, caused by a release message (set gate arg to 0)</p>
<p class="p1">t#2:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>end of SRC envelope release period, probably end of source synth (doneAction = 2)</p>
<p class="p1">t#3:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>supposed latest end of source synth due to given cleanupDelay of source, added to t#1</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(cleanupDelay might be passed as a constant maximum release time for all events)</p>
<p class="p1">t#4:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>with ~freePerGroup == false (default): freeing of FX#1 and Z#1, the latter a bit later.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>with ~freePerGroup == true: do nothing</p>
<p class="p1">t#5:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>free FXGRP, thus also FX#2 and Z#2.</p>
<p class="p2"><br></p>
<p class="p1">For longer effect chains with n effects the case distinction of t#4 applies to all pairs Z#i / FX#i for 1 &lt; i &lt; n:</p>
<p class="p1">with ~freePerGroup == true they all are freed at last by freeing the group.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>Timing scheme of PbindFx with two effects applied sequentially,<span class="Apple-converted-space"> </span></b></p>
<p class="p1"><b>source synth with fixed-length envelope:</b></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p1">t#0:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>start SRC, Z#i, FX#i and groups with server-side ordering as described in routing scheme,</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>in fact Z#i are started slightly earlier.</p>
<p class="p1">t#1:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>begin of SRC envelope release period, caused by the synth itself (no setting gate to 0)</p>
<p class="p1">t#2:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>end of SRC envelope release period, probably end of source synth (doneAction = 2)</p>
<p class="p1">t#3:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>supposed latest end of source synth due to given cleanupDelay of source, added to t#0</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(cleanupDelay might be passed as a constant maximum envelope length for all events)</p>
<p class="p1">t#4 - t#5:<span class="Apple-tab-span">	</span>as with gated envelope</p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p1"><b>Parallel effect processing, arbitrary effect graphs:</b></p>
<p class="p2"><br></p>
<p class="p1">The most simple case of applying two effects in parallel can be triggered by passing `(0: [1, 2]) to fxOrder.</p>
<p class="p1">Effect numbers occurring in arrays of dictionary values cause a routing from these effects to out.</p>
<p class="p1">Symbol \o (for destination out) can also be passed explicitely.</p>
<p class="p2"><br></p>
<p class="p1">Branching like this requires the use of a split synth which routes the output to the demanded</p>
<p class="p1">multitude of fx buses. A suitable predefined split synthdef is chosen according to the number of branches</p>
<p class="p1">and the channel number of the signal to be splitted – currently both is limited by 8, however</p>
<p class="p1">synths, which are only playing to out directly, might have an arbitrary number of output channels.</p>
<p class="p2"><br></p>
<p class="p1">Different to sequential fx processing, both fx bus zero synths have to be added before the source,</p>
<p class="p1">additional zero synth(s) for the split bus are prepended.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p1">The following effect graph can be established by fxOrder `(0: [1, 2, 3], 2: [4, \o], 3: 2),</p>
<p class="p1">split synths, zero synths (for fx buses and split buses) are omitted in this scheme.</p>
<p class="p1">For each (acyclic) fx graph a topological order is calculated (here it could e.g. be [0,1,3,2,4])</p>
<p class="p1">and the node ordering, including FXGRP and SRCGRP, similar to the sequential case,<span class="Apple-converted-space"> </span></p>
<p class="p1">is derived accordingly. Some small differences, especially concerning the cleanup delay times,<span class="Apple-converted-space"> </span></p>
<p class="p1">have to be taken into account, these details are omitted here.</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p11"><br></p>
<p class="p5"><b>Conventions<span class="Apple-converted-space"> </span></b></p>
<p class="p2"><br></p>
<p class="p1">1.) <span class="Apple-tab-span">	</span>Source instrument and effect SynthDefs must be known to SynthDescLib.global<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>(e.g. by creating SynthDefs with methods 'add' or 'store')</p>
<p class="p2"><br></p>
<p class="p1">2.)<span class="Apple-tab-span">	</span>Fx SynthDefs must be defined with arg 'out' for the outbus index, arg 'in' for inbus index</p>
<p class="p1"><span class="Apple-tab-span">	</span>and use In.ar(in, ...) within the SynthDef.</p>
<p class="p1"><span class="Apple-tab-span">	</span>It's up to the user whether to define the effect with dry/wet mix option.</p>
<p class="p1"><span class="Apple-tab-span">	</span>Effect synths don't need to have an envelope, their freeing is handled by the event type function.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">3.) <span class="Apple-tab-span">	</span>Effect chains must be defined properly in terms of in/out channel number.</p>
<p class="p1"><span class="Apple-tab-span">	</span>For each event the bus matching of the effect chain is checked, following these conventions:</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span>.)<span class="Apple-tab-span">	</span>For source and fx SynthDefs there must be only one out ugen using 'out' as bus arg,</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>LocalOut is allowed, other out ugens can be admitted by <b>\otherBusArgs.</b></p>
<p class="p1"><span class="Apple-tab-span">	</span>.)<span class="Apple-tab-span">	</span>Source SynthDefs must not have in ugens, except LocalIn or they are admitted by <b>\otherBusArgs</b>.<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>.)<span class="Apple-tab-span">	</span>Fxs must read from buses with ugen In.ar(in, ...) refering to the bus arg 'in',<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>there must not be other in ugens within the fx SynthDef except LocalIn or<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>they are admitted by <b>\otherBusArgs</b>, see Exs. 6a and 6b.</p>
<p class="p1"><span class="Apple-tab-span">	</span>.) <span class="Apple-tab-span">	</span>Number of out channels of preceeding source / fx synth must not be greater than<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>the number of the following fx synth's in channels, this is checked for all pairs of an fx graph.</p>
<p class="p1"><span class="Apple-tab-span">	</span>.) <span class="Apple-tab-span">	</span>Mismatches of above points lead to errors.</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p1">4.) <span class="Apple-tab-span">	</span>Checks of (3) are also based on info in SynthDescLib.global. It is possible to replace SynthDefs<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>on the fly (Ex. 7a, 7b), in that case I'd recommend to use also methods 'add' or 'store' –<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>e.g. in case of using 'send' for redefinition no bus matching check is performed and<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>a possibly wrong routing would be undetected.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">5.)<span class="Apple-tab-span">	</span>As shown in above graphics the source synth's cleanupDelay is interpretated differentely<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>with gated and non-gated (fixed-length) envelopes. This is done automatically by looking<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>for a 'gate' arg in the SynthDef's SynthDesc. It's the users responsibility to use the<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>conventional arg 'gate' for release in the SynthDef and omit a 'gate' arg with<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>SynthDefs employing fixed-length envelopes.</p>
<p class="p2"><br></p>
<p class="p1">6.) <span class="Apple-tab-span">	</span>As with normal event patterns the source Pbind / Pbind pairs may be defined with arrays<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>to produce multiple synths per event, then the whole source signal is routed to the fx graph<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>(see Ex. 2b, 2c and others). fxData pairs can also be defined with arrays, which causes<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>parallel processing per node ("implicit parallelism"), see Ex. 4a.</p>
<p class="p1"><span class="Apple-tab-span">	</span>For applying different fxs to parallel events (resp. chords) use parallel PbindFxs (Exs. 3a, 3b).<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>It is of course also possible that fx synths have array args and fx patterns are passing them<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>with the double-bracketing convention used for these cases (see <a href="../../miSC_v0.12/helpfiles/Event patterns and array args.html"><span class="s9">Event patterns and array args</span></a>).</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">7.) <span class="Apple-tab-span">	</span>Source instrument and effect SynthDefs are allowed to have args of same name.<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>There is no problem as key/value pairs are stored in separate lists/events.</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p1">8.) <span class="Apple-tab-span">	</span>PbindFx is implemented per automatically chosen effect type 'pbindFx', which employs<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>event type 'note', thus an event type must neither be passed to pbindData nor to fxData.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">9.) <span class="Apple-tab-span">	</span>The value conversion framework can be used for fxData, e.g. by passing \midinote instead of</p>
<p class="p1"><span class="Apple-tab-span">	</span>\freq or \db instead of \amp as with Pbind, see Ex.9. Other than with Pbind, freq and amp event defaults<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>are not passed to fx synths, if no such values are passed via fxData.<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>In that case default values of fx synths are taken.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">10.) <span class="Apple-tab-span">	</span>While playing PbindFx you should not play with allocation affecting private buses.</p>
<p class="p1"><span class="Apple-tab-span">	</span>Freeing buses is done by SkipJack objects, so you should not forcefully stop<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>all SkipJack objects while playing PbindFx.</p>
<p class="p2"><br></p>
<p class="p1">11.)<span class="Apple-tab-span">	</span>Keys \group and \addAction may be passed, they determine how the group enclosing<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>event-generated synths is related to the passed group, see scheme 'Principles of operation'.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">12.) <span class="Apple-tab-span">	</span>Zero synths are using the SynthDefs 'pbindFx_zero' and 'pbindFx_splitZero' which<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>are written to disk at startup time, as well as split synths pbindFx_split_axb for a = 2,...,8</p>
<p class="p1"><span class="Apple-tab-span">	</span>and b = 1,...,8. Of course these SynthDefs shouldn't be deleted or exchanged.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p5"><b>Resources, troubleshooting</b></p>
<p class="p2"><br></p>
<p class="p12"><span class="s10">1.) <span class="Apple-tab-span">	</span></span>You might encounter the error message "Meta_Bus:audio: failed to get an audio bus allocated."<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="s11"><span class="Apple-tab-span">	</span></span>As audio buses for effect chains are allocated and freed per event a higher number of<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>private audio buses is likely to be required (more than default 128).<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="s10"><span class="Apple-tab-span">	</span></span>You might also encounter the error message "<span class="s10">exception in real time: alloc failed,<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="Apple-tab-span">	</span>increase server's memory allocation (e.g. via ServerOptions)".</p>
<p class="p1"><span class="Apple-tab-span">	</span>Hence it's recommended to set the concerned server options before (re-)booting and working with PbindFx, e.g.:</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="s12">(</span></p>
<p class="p13"><span class="s10"><span class="Apple-tab-span">	</span></span>s.options.numPrivateAudioBusChannels = 1024;</p>
<p class="p13"><span class="Apple-tab-span">	</span>s.options.memSize = 8192 * 16;</p>
<p class="p13"><span class="Apple-tab-span">	</span>s.reboot;</p>
<p class="p13"><span class="Apple-tab-span">	</span>)</p>
<p class="p2"><br></p>
<p class="p12"><span class="s10">2.)<span class="Apple-tab-span">	</span></span>You might encounter the warning "Scheduler queue is full."</p>
<p class="p1"><span class="s11"><span class="Apple-tab-span">	</span></span>Per default delayed freeing of buses is scheduled on SystemClock, which defaults to queueSize 1024.</p>
<p class="p1"><span class="Apple-tab-span">	</span>In case of granulation and/or large cleanup delays it's recommended to pass a cleanup clock with</p>
<p class="p1"><span class="Apple-tab-span">	</span>sufficiently large queueSize via <b>pbindData</b>, its permanent flag must be set to true, e.g.:</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="s10"><span class="Apple-tab-span">	</span></span>...</p>
<p class="p13"><span class="s10"><span class="Apple-tab-span">	</span></span><span class="s13">\cleanupClock</span>, t = <span class="s14">TempoClock</span>(queueSize: 8192).permanent_(<span class="s15">true</span>)<span class="s10"><span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="s10"><span class="Apple-tab-span">	</span></span>...</p>
<p class="p14"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="s12"><span class="Apple-tab-span">	</span></span>Note that this clock keeps on running and survives CmdPeriod, you should explicitely stop it</p>
<p class="p1"><span class="Apple-tab-span">	</span>if you don't need it anymore, hence it should be stored in a variable. In case you haven't done that</p>
<p class="p1"><span class="Apple-tab-span">	</span>you can still stop all TempoClocks and remove them from CmdPeriod with</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="s10"><span class="Apple-tab-span">	</span></span><span class="s14">TempoClock</span>.all.copy.do(<span class="s14">_</span>.stop)</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">3.)<span class="Apple-tab-span">	</span>Cleanup delays for source and effects (or, if not passed, their default values) should be sufficiently large</p>
<p class="p1"><span class="Apple-tab-span">	</span>(see description of <b>\cleanupDelay</b>), otherwise effects and audio buses might be freed too early</p>
<p class="p1"><span class="Apple-tab-span">	</span>and signals cut.</p>
<p class="p2"><br></p>
<p class="p1">4.)<span class="Apple-tab-span">	</span>Some effects, like echo, introduce a delay. If sequencing mixes delayed events</p>
<p class="p1"><span class="Apple-tab-span">	</span>with non-delayed events, entries of the latter have to be delayed accordingly to preserve correct timing,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>this can be done by setting an offset in seconds with \lag. See examples with echo below.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p15"><b>Example 1:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Straight usage with unchanged effect order</b></p>
<p class="p2"><br></p>
<p class="p15"><b>Example 1a:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Source synth with sustained envelope</b></p>
<p class="p16"><br></p>
<p class="p14"><br></p>
<p class="p17">// boot server with extended resources</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13">s.options.numPrivateAudioBusChannels = 1024;</p>
<p class="p13">s.options.memSize = 8192 * 16;</p>
<p class="p13">s.reboot;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// basic source and effect synthdefs for this help file</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p17">// All ins and outs use two channels</p>
<p class="p14"><br></p>
<p class="p18">// source synthdef</p>
<p class="p18">// take releaseTime = decayTime</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\source</span><span class="s2">, { </span>|out = 0, freq = 400, decayTime = 0.5,</p>
<p class="p19"><span class="Apple-tab-span">	</span>attackTime = 0.005, amp = 0.1, gate = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> env, sig = <span class="s14">Decay</span>.ar(<span class="s14">Impulse</span>.ar(0), decayTime, <span class="s14">Saw</span>.ar(freq));</p>
<p class="p13"><span class="Apple-tab-span">	</span>env = <span class="s14">EnvGen</span>.ar(<span class="s14">Env</span>.asr(attackTime, amp, decayTime, <span class="s13">\lin</span>), gate, doneAction: 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, sig ! 2 * env)</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// spat fx</p>
<p class="p18">// This effect introduces a very small delay,</p>
<p class="p18">// in examples balancing by lag (as it obviously has to be done with echo) is neglected.</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\spat</span><span class="s2">, { </span>|out, in, freq = 1, maxDelayTime = 0.005,</p>
<p class="p19"><span class="Apple-tab-span">	</span>amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">DelayC</span>.ar(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>maxDelayTime,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{ <span class="s14">LFDNoise3</span>.ar(freq, maxDelayTime, maxDelayTime/2) } ! 2,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp</p>
<p class="p13"><span class="Apple-tab-span">	</span>);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// echo fx, always unified delay maxEchoDelta</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\echo</span><span class="s2">, { </span>|out, in, maxEchoDelta = 0.2, echoDelta = 0.1,</p>
<p class="p19"><span class="Apple-tab-span">	</span>decayTime = 1, amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">DelayL</span>.ar(<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">CombL</span>.ar(inSig, maxEchoDelta, echoDelta, decayTime, amp),<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>maxEchoDelta,<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>maxEchoDelta - echoDelta</p>
<p class="p13"><span class="Apple-tab-span">	</span>);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// wah-wah fx</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\wah</span><span class="s2">, { </span>|out, in, resLo = 200, resHi = 5000,</p>
<p class="p19"><span class="Apple-tab-span">	</span>cutOffMoveFreq = 0.5, rq = 0.1, amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">RLPF</span>.ar(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">LinExp</span>.kr(<span class="s14">LFDNoise3</span>.kr(cutOffMoveFreq), -1, 1, resLo, resHi),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rq,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp</p>
<p class="p13"><span class="Apple-tab-span">	</span>).softclip;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// reverb fx</p>
<p class="p18">// rough estimation: freeVerb's room arg = decayTime / 10</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\reverb</span><span class="s2">, { </span>|out, in, damp = 0.5,</p>
<p class="p19"><span class="Apple-tab-span">	</span>decayTime = 10, amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, <span class="s14">FreeVerb</span>.ar(inSig, mix, min(decayTime, 10) / 10, damp, amp));</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p20"><br></p>
<p class="p20"><br></p>
<p class="p21">// Fx params are sequenced on a per-event base.</p>
<p class="p20"><br></p>
<p class="p21">// see server window: number of groups (divided by 2) indicates<span class="Apple-converted-space"> </span></p>
<p class="p21">// the number of parallel event chains in action</p>
<p class="p21">// check while running with s.queryAllNodes</p>
<p class="p20"><br></p>
<p class="p22">(</p>
<p class="p23"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.2,</p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(80, 90, 1),</p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Prand</span>([60, 67, 70, 73]) + <span class="s14">Prand</span>([0, -12.3, -23.7], <span class="s15">inf</span>),</p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p20"><br></p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, [1, 2],<span class="Apple-converted-space"> </span></p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// With a sustained envelope \cleanupDelay refers to the maximum release time,</p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// in SynthDef \source releaseTime = decayTime, so take cleanupDelay = decayTime</p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.2, 2),</p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p22"><span class="Apple-tab-span">	</span>],[</p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// oscillation of delay -&gt; frequency modulation of source signal</p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Prand</span>([1, 2, 3], <span class="s15">inf</span>),</p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p22"><span class="Apple-tab-span">	</span>],[</p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// variation by sequencing of params</p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, <span class="s14">Pseq</span>([0.2, 0.5, 0.7], <span class="s15">inf</span>),</p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([1, 2, 5, 10], <span class="s15">inf</span>),</p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p22"><span class="Apple-tab-span">	</span>]</p>
<p class="p22">);</p>
<p class="p20"><br></p>
<p class="p22">q = p.play;</p>
<p class="p22">)</p>
<p class="p20"><br></p>
<p class="p21">// see server window and compare "regular" stop<span class="Apple-converted-space"> </span></p>
<p class="p21">// (descending number of groups, synths and ugens reflects delayed cleanup)</p>
<p class="p21">// with stopping the same example by Cmd-Period</p>
<p class="p20"><br></p>
<p class="p22">q.stop;</p>
<p class="p25"><br></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 1b:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Source synth with fixed-length envelope</b></p>
<p class="p16"><br></p>
<p class="p18">// SynthDefs from Ex. 1a plus</p>
<p class="p17">// SynthDef variation with adsr args</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\source_adsrFixed</span><span class="s2">, { </span>|out = 0, freq = 400, decayTime = 0.5,<span class="Apple-converted-space"> </span></p>
<p class="p19"><span class="Apple-tab-span">	</span>att = 0.005, dec = 0.01, sus = 0.2, rel = 0.3, susLevel = 0.5, amp = 0.1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> env, sig = <span class="s14">Saw</span>.ar(freq);</p>
<p class="p13"><span class="Apple-tab-span">	</span>env = <span class="s14">EnvGen</span>.kr(<span class="s14">Env</span>([0, 1, susLevel, susLevel, 0], [att, dec, sus, rel]), doneAction: 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, sig ! 2 * env * amp)</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// adsr values passed, \cleanupDelay estimated as max of sum</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source_adsrFixed<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, <span class="s14">Pwhite</span>(0.005, 0.01),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dec</span>, <span class="s14">Pwhite</span>(0.01, 0.02),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sus</span>, <span class="s14">Pwhite</span>(0.02, 0.3),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rel</span>, <span class="s14">Pwhite</span>(0.2, 1.5),</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\susLevel<span class="s2">, 0.4,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.2,</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(80, 90, 1),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Prand</span>([60, 67, 70, 73]) + <span class="s14">Prand</span>([0, -12.3, -23.7], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p22"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, [1, 2],<span class="Apple-converted-space"> </span></p>
<p class="p20"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// cleanupDelay must be larger than max env length, otherwise events might be cut !</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// here we do an estimation (att + dec + sus + rel &lt; 2),</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// but it could be summed from those event values too, e.g. with</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// \cleanupDelay, Pfunc { |e| e.att + e.dec + e.sus + e.rel }</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 2</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Prand</span>([1, 2, 3], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, <span class="s14">Pseq</span>([0.2, 0.5, 0.7], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([1, 2, 5, 10], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// check node order while running</p>
<p class="p14"><br></p>
<p class="p13">s.queryAllNodes;</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p20"><br></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 2:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Sequencing of different effect chains</b></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 2a:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Determined fx sequence</b></p>
<p class="p16"><br></p>
<p class="p28">// PbindFx using spat and echo effects.</p>
<p class="p28">// Especially relevant keys here are \fxOrder which determines fx sequencing</p>
<p class="p28">// and \cleanupDelay for proper releaseTimes of source and effects</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p29"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.3,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pwhite</span>(50, 90),</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// fx sequence \spat, \spat + \echo, etc.</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pseq</span>([1, [1,2]], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// echo is delayed (maxEchoDelta = 0.2),</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// compensate here by shift when no echo</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// we need \lag rather than \timingOffset as the whole delaytime calculation refers to seconds</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pseq</span>([0.2, 0], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// in SynthDef \source releaseTime = decayTime, so take cleanupDelay = decayTime</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pseq</span>([1, 0.1], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// define effect with index 1</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// oscillation of delay -&gt; frequence modulation of source signal</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pseq</span>([1, 1, 10], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// define effect with index 2</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 0.08,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.8, 3),</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 2b:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Random fx sequence</b></p>
<p class="p14"><br></p>
<p class="p18">// If more than one synth per event is produced (here by key 'midinote'),<span class="Apple-converted-space"> </span></p>
<p class="p18">// the effect chain is applied to all of them, see Ex. 3 for applying<span class="Apple-converted-space"> </span></p>
<p class="p18">// different effects to parallel synths.</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p29"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.2,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.3,</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// downwards tendency + chord sequence</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pseq</span>((90, 80..50), <span class="s15">inf</span>) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([[0, 5], 0, [0, 2.5], [-2.5, 12.5], [-3, 0]])),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Prand</span>([1, [1,2], [1,2]], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// lag must be adapted to maxEchoDelta</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.isArray.if { 0 }{ 0.2 } },</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// echo -&gt; shorter source decay</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.isArray.if { 0.1 }{ 0.7 } },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\echoDelta</span>, <span class="s14">Pseq</span>((1..5)/50, <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 1,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 2c:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Some extensions</b></p>
<p class="p14"><br></p>
<p class="p18">// Additional use of rests, reverb added.</p>
<p class="p18">// Here the reverb usage is deliberately wasteful, see Ex.2d for an alternative.</p>
<p class="p18">// The use of Pn + Pshuf (or equivalently Pshufn) gives<span class="Apple-converted-space"> </span></p>
<p class="p18">// balanced random variation for several key streams</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>(0.2!5 ++ <span class="s14">Rest</span>(0.2))),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pseq</span>((90, 80..40), <span class="s15">inf</span>) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([[0, 5], 0, [0, 2.5], [-2.5, 12.5], [-3, 0]])),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([[1,2], [1,2,3], [3,1], 1])),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> (e.fxOrder != [1,2]).if { 0.3 }{ 0.6 } },</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, </span><span class="s14">Pfunc</span><span class="s2"> { </span><span class="s16">|e|</span><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rrand(0.3, 0.8) / (e.fxOrder.asArray.includes(2).if { 10 }{ 1 })<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>},</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 1, 1, 5, 20, 50])),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\echoDelta</span>, <span class="s14">Pseq</span>((1..5)/50, <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\reverb<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, 0.3,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\damp</span>, 0.1,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(3.0, 10),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 2d:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Saving resources<span class="Apple-converted-space"> </span></b></p>
<p class="p14"><br></p>
<p class="p18">// If effects have a long cleanup delay, you will get a possibly large number of</p>
<p class="p18">// overlapping effect chains. E.g. in Ex. 2c many reverb synths can be there in</p>
<p class="p18">// parallel, the decayTime is controlled by Pwhite(3.0, 10), so it might well be</p>
<p class="p18">// that reverbs with decayTimes 7.95, 8, and 8.1 are instantiated in parallel,</p>
<p class="p18">// which doesn't make much difference and is quite wasteful.</p>
<p class="p18">// Reverb is often placed at the last position of the effect chain,</p>
<p class="p18">// so a more efficient approach would be the following: do</p>
<p class="p18">// all effect sequencing without reverb with PbindFx and pipe</p>
<p class="p18">// the overall out to a permanently running reverb.</p>
<p class="p29"><br></p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p29"><br></p>
<p class="p18">// start two reverbs with different parameters, read from dedicated buses</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13">a = <span class="s14">Bus</span>.audio(s, 2);</p>
<p class="p13">b = <span class="s14">Bus</span>.audio(s, 2);</p>
<p class="p14"><br></p>
<p class="p13">x = <span class="s14">Synth</span>(<span class="s13">\reverb</span>, [mix: 0.3, damp: 0.1, decayTime: 3, in: a]);</p>
<p class="p13">y = <span class="s14">Synth</span>(<span class="s13">\reverb</span>, [mix: 0.2, damp: 0.1, decayTime: 10, in: b]);</p>
<p class="p13">)</p>
<p class="p14"><span class="Apple-converted-space">  </span></p>
<p class="p18">// play PbindFx<span class="Apple-converted-space"> </span></p>
<p class="p18">// compare CPU usage with Ex.2c</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>(0.2!5 ++ <span class="s14">Rest</span>(0.2))),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pseq</span>((90, 80..40), <span class="s15">inf</span>) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([[0, 5], 0, [0, 2.5], 0, [-2.5, 12.5], [-3, 0]])),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 2, [1,2]])),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> (e.fxOrder != [1,2]).if { 0.3 }{ 0.6 } },</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, </span><span class="s14">Pfunc</span><span class="s2"> { </span><span class="s16">|e|</span><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rrand(0.3, 0.8) / (e.fxOrder.asArray.includes(2).if { 10 }{ 1 })<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>},</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">),</span></p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// pipe out to different reverbs resp. 0 (no reverb)</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([0, 0, a, a, b]))</p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 1, 1, 5, 20, 50])),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\echoDelta</span>, <span class="s14">Pseq</span>((1..5)/50, <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// stop</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p18">// free extra resources</p>
<p class="p14"><br></p>
<p class="p13">[x, y, a, b].do(<span class="s14">_</span>.free);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 3:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Different effects for parallel synths</b></p>
<p class="p25"><br></p>
<p class="p18">// This can be done with parallel PbindFxs</p>
<p class="p25"><br></p>
<p class="p15"><b>Example 3a:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Using a template Pbind</b></p>
<p class="p14"><br></p>
<p class="p18">// Here the option of passing a source Pbind instead of a list of Pbind pairs can be used.</p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// master pattern, fxOrders defines fxOrder for voices of chord</p>
<p class="p13">f = <span class="s14">Pbind</span>(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.3,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\type<span class="s2">, </span>\rest<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fxOrders<span class="s2">, </span><span class="s14">Pn</span><span class="s2">(</span><span class="s14">Pshuf</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[[1, 3], 2, 1], [1, [1, 3], 2], [2, 1, [1, 3]],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[0, 1, 1], [1, 0, 1], [1, 1, 0]</p>
<p class="p13"><span class="Apple-tab-span">	</span>]).collect { <span class="s16">|o|</span> <span class="s18">~o</span> = o })</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p18">// core source Pbind</p>
<p class="p13">a = <span class="s14">Pbind</span>(</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.3,</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// reference to fxOrder will be got from Pchains below</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.any([2,3].includes(<span class="s14">_</span>)).if { 0.3 }{ 0.1 } },</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> rrand(0.5, 0.7) / (e.fxOrder.includes(2).if { 10 }{ 1 }) },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p18">// lists of fx pairs</p>
<p class="p13">b = [[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 2, 3, 10])),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13">],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 3/50,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13">],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, 0.5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([5, 10], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13">]];</p>
<p class="p14"><br></p>
<p class="p18">// derive three Pchains from core Pbind,<span class="Apple-converted-space"> </span></p>
<p class="p18">// voice-specific fxOrder will be read from master pattern</p>
<p class="p13">u = a &lt;&gt; <span class="s14">Pbind</span>(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pfunc</span> { <span class="s18">~o</span>[0].asArray },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, 72</span></p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">v = a &lt;&gt; <span class="s14">Pbind</span>(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pfunc</span> { <span class="s18">~o</span>[1].asArray },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pstutter</span>(<span class="s14">Pwhite</span>(5, 10), <span class="s14">Prand</span>((60..70), <span class="s15">inf</span>))</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">w = a &lt;&gt; <span class="s14">Pbind</span>(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pfunc</span> { <span class="s18">~o</span>[2].asArray },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pstutter</span>(<span class="s14">Pwhite</span>(5, 10), <span class="s14">Prand</span>((75..85), <span class="s15">inf</span>))</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// play in parallel, master must be before</p>
<p class="p14"><br></p>
<p class="p13">d = 0.001;</p>
<p class="p14"><br></p>
<p class="p13">q = <span class="s14">Ptpar</span>([</p>
<p class="p13"><span class="Apple-tab-span">	</span>0, f,</p>
<p class="p13"><span class="Apple-tab-span">	</span>d, <span class="s14">PbindFx</span>(u, *b),</p>
<p class="p13"><span class="Apple-tab-span">	</span>d, <span class="s14">PbindFx</span>(v, *b),</p>
<p class="p13"><span class="Apple-tab-span">	</span>d, <span class="s14">PbindFx</span>(w, *b)</p>
<p class="p13">]).play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p20"><br></p>
<p class="p20"><br></p>
<p class="p15"><b>Example 3b:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Using a PbindFx generator Function</b></p>
<p class="p25"><br></p>
<p class="p18">// Equivalent to Ex. 3a, but might look more straight, as<span class="Apple-converted-space"> </span></p>
<p class="p18">// fxOrder pair already generated with PbindFx Function.</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// master pattern for fxOrder</p>
<p class="p13">f = <span class="s14">Pbind</span>(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.3,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\type<span class="s2">, </span>\rest<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fxOrders<span class="s2">, </span><span class="s14">Pn</span><span class="s2">(</span><span class="s14">Pshuf</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[[1, 3], 2, 1], [1, [1, 3], 2], [2, 1, [1, 3]],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[0, 1, 1], [1, 0, 1], [1, 1, 0]</p>
<p class="p13"><span class="Apple-tab-span">	</span>]).collect { <span class="s16">|o|</span> <span class="s18">~o</span> = o })</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p18">// PbindFx generator</p>
<p class="p14"><br></p>
<p class="p13">g = { <span class="s16">|i|</span> <span class="s14">PbindFx</span>([</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.3,</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pfunc</span> { <span class="s18">~o</span>[i].asArray },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.any([2,3].includes(<span class="s14">_</span>)).if { 0.3 }{ 0.1 } },</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> rrand(0.5, 0.7) / (e.fxOrder.includes(2).if { 10 }{ 1 }) },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">),</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 2, 3, 10])),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 3/50,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, 0.5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([5, 10], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p13">};</p>
<p class="p14"><br></p>
<p class="p18">// derive three Pbindfs from PbindFx generator,</p>
<p class="p18">// as PbindFx is a subclass of Pbind, you can apply Pbindf as to Pbind</p>
<p class="p14"><br></p>
<p class="p13">u = <span class="s14">Pbindf</span>(g.(0), <span class="s13">\midinote</span>, 72);</p>
<p class="p13">v = <span class="s14">Pbindf</span>(g.(1), <span class="s13">\midinote</span>, <span class="s14">Pstutter</span>(<span class="s14">Pwhite</span>(5, 10), <span class="s14">Prand</span>((60..70), <span class="s15">inf</span>)));</p>
<p class="p13">w = <span class="s14">Pbindf</span>(g.(2), <span class="s13">\midinote</span>, <span class="s14">Pstutter</span>(<span class="s14">Pwhite</span>(5, 10), <span class="s14">Prand</span>((75..85), <span class="s15">inf</span>)));</p>
<p class="p14"><br></p>
<p class="p13">d = 0.001;</p>
<p class="p13">q = <span class="s14">Ptpar</span>([0, f, d, u, d, v, d, w]).play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p22">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 4:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Applying the same fx SynthDef more than once in a chain</b></p>
<p class="p25"><br></p>
<p class="p30"><br></p>
<p class="p15"><b>Example 4a:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Implicit duplication (= implicit parallelism)</b></p>
<p class="p25"><br></p>
<p class="p31">// Within a graph node parallelism can be established in analogy to<span class="Apple-converted-space"> </span></p>
<p class="p31">// the generation of multiple synths with Pbind:<span class="Apple-converted-space"> </span></p>
<p class="p31">// by passing an array as value within fxData.</p>
<p class="p30"><br></p>
<p class="p13">(</p>
<p class="p32">// pitchshift fx, result can easily be controlled by ear</p>
<p class="p14"><br></p>
<p class="p33"><span class="s19">SynthDef</span><span class="s2">(</span><span class="s20">\pitchShift</span><span class="s2">, { </span>|out, in, windowSize = 0.2, midiShift = 1,</p>
<p class="p33"><span class="Apple-converted-space">    </span>pitchDispersion = 0, timeDispersion = 0, amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-converted-space">    </span><span class="s21">var</span> sig, inSig = <span class="s19">In</span>.ar(in, 2);</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s19">PitchShift</span>.ar(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>windowSize,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>midiShift.midiratio,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pitchDispersion,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>timeDispersion</p>
<p class="p13"><span class="Apple-tab-span">	</span>);</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-converted-space">    </span><span class="s19">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix) * amp);</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p34"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s20">\dur</span>, 0.5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s20">\amp</span>, 0.2,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s20">\midinote</span>, <span class="s19">Pwhite</span>(50, 80),</p>
<p class="p14"><br></p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fxOrder<span class="s2">, 1,</span></p>
<p class="p32"><span class="s2"><span class="Apple-converted-space">        </span></span>// With a sustained envelope \cleanupDelay refers to the maximum release time,</p>
<p class="p32"><span class="s2"><span class="Apple-converted-space">        </span></span>// in SynthDef \source releaseTime = decayTime, so take cleanupDelay = decayTime</p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 1.5,</span></p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s19">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p32"><span class="s2"><span class="Apple-converted-space">        </span></span>// variation by sequencing of params</p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\pitchShift<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s20">\mix</span>, 0.8,</p>
<p class="p32"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// implicitely generate parallel processing with different fx params</p>
<p class="p32"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>// the two fxs applied in parallel together with the source result in a sequence of major triads</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s20">\midiShift</span>, [4, 7],</p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\windowSize<span class="s2">, 0.04,</span></p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\timeDispersion<span class="s2">, 0.005,</span></p>
<p class="p35"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-converted-space">    </span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p25"><br></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 4b:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Explicit duplication<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></p>
<p class="p25"><br></p>
<p class="p31">// By passing the same fx in different fxData args you have all options</p>
<p class="p31">// by defining the fx graph: in sequence, in parallel or however.</p>
<p class="p31">// Here is an example for explicit duplication in sequence,</p>
<p class="p31">// for defining explicit parallelism and arbitrary fx graphs see Ex. 10</p>
<p class="p14"><br></p>
<p class="p31">// SynthDefs from Ex. 1a, <span class="s22">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p36"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\dur</span>, 1/3,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\amp</span>, <span class="s24">Pseq</span>([0.2, 0.4, 0.3], <span class="s15">inf</span>),</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s24">Pseq</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s24">Pwhite</span>(35, 48, 1) + [-14, 0, 14],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s24">Pshuf</span>([60, 67, 70, 73], 1) + <span class="s24">Pshuf</span>([0, 12], 1) + [0, 4, 12],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\fxOrder</span>, <span class="s24">Pseq</span>([1, [1, 2], [1, 2, 3]], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\lag</span>, <span class="s24">Pseq</span>([0.17, 0.03, 0.00], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\decayTime</span>, <span class="s24">Pseq</span>([2.5, 0.1, 0.1], <span class="s15">inf</span>),</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s24">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\freq</span>, <span class="s24">Prand</span>([1, 2, 3], <span class="s15">inf</span>),</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s24">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\echoDelta</span>, <span class="s24">Pwhite</span>(0.06, 0.1),</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 1,</span></p>
<p class="p14"><br></p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s24">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p31"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// short delta results in additional frequency</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s23">\echoDelta</span>, <span class="s24">Pwhite</span>(0.005, 0.01),</p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.2,</span></p>
<p class="p14"><br></p>
<p class="p37"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s24">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 5:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Tempo control</b></p>
<p class="p25"><br></p>
<p class="p18">// Tempo control works as with Pbind and can be<span class="Apple-converted-space"> </span></p>
<p class="p18">// influenced by a number of parameters.</p>
<p class="p14"><br></p>
<p class="p18">// As cleanup parameters of PbindFx are passed in seconds,</p>
<p class="p18">// tempo control can be done independent from making cleanup time changes</p>
<p class="p18">// (though you might do so as well)</p>
<p class="p14"><br></p>
<p class="p18">// The use of a dedicated TempoClock as master tempo control is a good idea.</p>
<p class="p18">// Setting tempo for individual streams can be done with 'stretch'</p>
<p class="p14"><br></p>
<p class="p18">// The following example employs a PbindFx generator Function,</p>
<p class="p18">// the tempo of streams can be controlled individually and generally.</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// PbindFx generator Function,</p>
<p class="p18">// streams will get different midinote offsets,</p>
<p class="p18">// tempo will be read from a passed array</p>
<p class="p14"><br></p>
<p class="p19"><span class="s2">g = { </span>|midiOffset, tempoArray, index|</p>
<p class="p14"><br></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\stretch</span>, <span class="s14">Pfunc</span> { 1 / tempoArray[index] },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(55, 75, 1),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([60, 67, 70, 73])),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>) + midiOffset,</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 1, [1, 2], [1, 3]])),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.2,</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> rrand(0.3, 0.8) / (e.fxOrder.asArray.includes(2).if { 10 }{ 1 }) },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, 2,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\echoDelta</span>, <span class="s14">Pseq</span>((1..5)/50, <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, 0.5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\resLo</span>, 400,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\reHi</span>, 2000,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cutOffMoveFreq<span class="s2">, 10,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">) };</p>
<p class="p14"><br></p>
<p class="p18">// master TempoClock</p>
<p class="p14"><br></p>
<p class="p26"><span class="s2">t = </span>TempoClock<span class="s2">.new;</span></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// array for individual tempo factors</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~tempo</span> = [1, 1, 2]/2;</p>
<p class="p14"><br></p>
<p class="p18">// start first player on quant grid,</p>
<p class="p18">// it refers to the tempo factor ~tempo[0]</p>
<p class="p18">// note that quant refers to the tempo of the TempoClock</p>
<p class="p14"><br></p>
<p class="p13">x = g.(-24, <span class="s18">~tempo</span>, 0).play(t, quant: 1);</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// start other players on quant grid</p>
<p class="p14"><br></p>
<p class="p13">y = g.(0, <span class="s18">~tempo</span>, 1).play(t, quant: 1);</p>
<p class="p14"><br></p>
<p class="p13">z = g.(12, <span class="s18">~tempo</span>, 2).play(t, quant: 1);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// change player's individual tempos,</p>
<p class="p18">// note that tempo changes do not necessarily happen on quant grid,</p>
<p class="p18">// so a rhythmic "phase shift" (which can be nice) might happen</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~tempo</span>[2] = 2/3</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~tempo</span>[1] = 1/3</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~tempo</span>[0] = 1</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// set general tempo</p>
<p class="p14"><br></p>
<p class="p13">t.tempo = 3/4</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop players individually</p>
<p class="p14"><br></p>
<p class="p13">x.stop;</p>
<p class="p14"><br></p>
<p class="p13">y.stop;</p>
<p class="p14"><br></p>
<p class="p13">z.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop clock</p>
<p class="p14"><br></p>
<p class="p13">t.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 6:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Further external routing</b></p>
<p class="p25"><br></p>
<p class="p18">// This means the use of buses, which are not internally used by PbindFx's event Function.</p>
<p class="p18">// As shown in Ex.2d it can be useful to route PbindFx's out to an external reverb,</p>
<p class="p18">// Vice versa data can be read from external buses, from source synths as well as from fx synths.</p>
<p class="p18">// Audio routing benefits from the possibility to pass groups to PbindFx.</p>
<p class="p18">// Then all temporary groups, generated during playing the PbindFx,</p>
<p class="p18">// are enclosed by it and node order can be clearly defined.</p>
<p class="p18">// For audio bus routing better use In.ar than mapping with asMap,</p>
<p class="p18">// that way matching of ins and outs of fx chains is checked and it avoids<span class="Apple-converted-space"> </span></p>
<p class="p18">// issues with using asMap and stopping the external source (occuring at least in SC 3.6.6).<span class="Apple-converted-space"> </span></p>
<p class="p29"><br></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 6a:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Source synth reading audio modulation signals from external buses</b></p>
<p class="p14"><br></p>
<p class="p18">// source synth based on SinOsc and additional ring modulation,</p>
<p class="p18">// while reading from an audio bus with no signal, it outputs only the sine</p>
<p class="p14"><br></p>
<p class="p38">(</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\source_mod</span><span class="s2">, { </span>|out = 0, freq = 400, decayTime = 0.5,</p>
<p class="p19"><span class="Apple-tab-span">	</span>attackTime = 0.005, amp = 0.1, modIn, gate = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> env, sig;</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">Decay</span>.ar(<span class="s14">Impulse</span>.ar(0), decayTime, <span class="s14">SinOsc</span>.ar(freq) * (1 + <span class="s14">In</span>.ar(modIn)));</p>
<p class="p13"><span class="Apple-tab-span">	</span>env = <span class="s14">EnvGen</span>.ar(<span class="s14">Env</span>.asr(attackTime, amp, decayTime, <span class="s13">\lin</span>), gate, doneAction: 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, sig ! 2 * env)</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// new group and bus for the modulation signal</p>
<p class="p13">g = <span class="s14">Group</span>.new;</p>
<p class="p13">a = <span class="s14">Bus</span>.audio(s, 1);</p>
<p class="p14"><br></p>
<p class="p18">// play source with spat effect only</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source_mod<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.1,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(80, 90, 1),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Prand</span>([60, 67, 70, 73]) + <span class="s14">Prand</span>([0, -12.3, -23.7], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p20"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p24"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fxOrder<span class="s2">, 1,<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\modIn</span>, a,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// to enable this reading the fx chain check must know</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\otherBusArgs<span class="s2">, [</span>\modIn<span class="s2">],</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\group</span>, g,</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.2, 2),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Prand</span>([1, 2, 10], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// while playing PbindFx, play modulation synth to dedicated bus,</p>
<p class="p18">// placing before group ensures that all generated synths can read from the bus</p>
<p class="p14"><br></p>
<p class="p13">x = { <span class="s14">Out</span>.ar(a, <span class="s14">SinOsc</span>.ar(500, 0, 0.5)) }.play(target: g, addAction: <span class="s13">\addBefore</span>);</p>
<p class="p14"><br></p>
<p class="p18">// no modulation again</p>
<p class="p14"><br></p>
<p class="p13">x.free;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// modulation with other signal</p>
<p class="p14"><br></p>
<p class="p13">y = { <span class="s14">Out</span>.ar(a, <span class="s14">Pulse</span>.ar(700, 0.5, 0.5)) }.play(target: g, addAction: <span class="s13">\addBefore</span>);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// add a further modulation signal</p>
<p class="p14"><br></p>
<p class="p13">z = { <span class="s14">Out</span>.ar(a, <span class="s14">Formant</span>.ar(700, 1200, mul: 0.5)) }.play(target: g, addAction: <span class="s13">\addBefore</span>);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// formant modulation only</p>
<p class="p14"><br></p>
<p class="p13">y.free;</p>
<p class="p14"><br></p>
<p class="p18">// stop it also</p>
<p class="p14"><br></p>
<p class="p13">z.free;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop and PbindFx cleanup</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// cleanup of other resources, free bus and group</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13">g.free;</p>
<p class="p13">a.free;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 6b:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Fx synths reading audio modulation signals from external buses</b></p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// simple sine source synth</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\source_sine</span><span class="s2">, { </span>|out = 0, freq = 400, decayTime = 0.5,</p>
<p class="p19"><span class="Apple-tab-span">	</span>attackTime = 0.005, amp = 0.1, gate = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> env, sig;</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">Decay</span>.ar(<span class="s14">Impulse</span>.ar(0), decayTime, <span class="s14">SinOsc</span>.ar(freq));</p>
<p class="p13"><span class="Apple-tab-span">	</span>env = <span class="s14">EnvGen</span>.ar(<span class="s14">Env</span>.asr(attackTime, amp, decayTime, <span class="s13">\lin</span>), gate, doneAction: 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, sig ! 2 * env)</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p18">// ring modulation fx synth, expecting to read the modulation signal from a bus</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\ring</span><span class="s2">, { </span>|out, in, modIn, amp = 2, mix = 0.5|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = inSig * <span class="s14">In</span>.ar(modIn, 1);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// spat SynthDef from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// new group and buses for the modulation signal</p>
<p class="p13">g = <span class="s14">Group</span>.new;</p>
<p class="p14"><br></p>
<p class="p13">a = <span class="s14">Bus</span>.audio(s, 1);</p>
<p class="p13">b = <span class="s14">Bus</span>.audio(s, 1);</p>
<p class="p14"><br></p>
<p class="p18">// two ring modulation fxs</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source_sine<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.12,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(80, 90, 1),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Prand</span>([60, 67, 70, 73]) + <span class="s14">Prand</span>([0, -12.3, -23.7], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\group</span>, g,</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, [1, 2], [1, 3]])),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.2, 2),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Prand</span>([1, 2, 10], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\ring<span class="s2">,</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// need the index explicitely here</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\modIn</span>, a.index,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// to enable this reading the fx chain check must know</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\otherBusArgs<span class="s2">, [</span>\modIn<span class="s2">],</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\ring<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\modIn</span>, b.index,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// to enable this reading the fx chain check must know</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\otherBusArgs<span class="s2">, [</span>\modIn<span class="s2">],</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// now live change of modulation as in Ex. 6a, but this applies only to one of three events</p>
<p class="p14"><br></p>
<p class="p13">x = { <span class="s14">Out</span>.ar(a, <span class="s14">SinOsc</span>.ar(500, 0, 0.5)) }.play(target: g, addAction: <span class="s13">\addBefore</span>);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// also modulate events where fx reads from b</p>
<p class="p14"><br></p>
<p class="p13">y = { <span class="s14">Out</span>.ar(b, <span class="s14">Pulse</span>.ar(700, 0.5, 0.5)) }.play(target: g, addAction: <span class="s13">\addBefore</span>);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// add a further modulation signal</p>
<p class="p14"><br></p>
<p class="p13">z = { <span class="s14">Out</span>.ar(a, <span class="s14">Formant</span>.ar(700, 1200, mul: 0.5)) }.play(target: g, addAction: <span class="s13">\addBefore</span>);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// remove two others</p>
<p class="p14"><br></p>
<p class="p13">x.free;</p>
<p class="p14"><br></p>
<p class="p13">y.free;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop it also</p>
<p class="p14"><br></p>
<p class="p13">z.free;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop and PbindFx cleanup</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// cleanup of other resources, free buses and group</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13">g.free;</p>
<p class="p13">a.free;</p>
<p class="p13">b.free;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 6c:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Controlling effects with LFOs</b></p>
<p class="p14"><br></p>
<p class="p18">// control the amount / mix of an effect continously</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// bus for LFO control</p>
<p class="p13">c = <span class="s14">Bus</span>.control(s, 1);</p>
<p class="p14"><br></p>
<p class="p18">// play source with spat and wah-wah effect,</p>
<p class="p18">// as initially bus value is zero there is no wah at start</p>
<p class="p14"><br></p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.15,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(80, 90, 1),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Prand</span>([60, 67, 70, 73]) + <span class="s14">Prand</span>([0, -12.3, -23.7], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, [1, 2],<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.2, 2),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, 2,<span class="Apple-converted-space"> </span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// maps each fx synth's mix input to the control bus</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, c.asMap,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// other params might still be controlled per event</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([5, 20], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// chime in with wah from 0 (start phase == -pi/2)</p>
<p class="p14"><br></p>
<p class="p13">x = { <span class="s14">Out</span>.kr(c, <span class="s14">SinOsc</span>.kr(0.15, -pi/2).range(0, 0.8)) }.play</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop and free resources</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13">q.stop;</p>
<p class="p13">x.free;</p>
<p class="p13">c.free;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 7:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Replacement</b></p>
<p class="p25"><br></p>
<p class="p18">// Replacement can affect certain key streams only or whole source resp.</p>
<p class="p18">// fx patterns, the latter can be done with using the option of<span class="Apple-converted-space"> </span></p>
<p class="p18">// passing source / fx patterns instead of lists.</p>
<p class="p25"><br></p>
<p class="p15"><b>Example 7a:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Replacement restricted to key streams</b></p>
<p class="p25"><br></p>
<p class="p18">// This can be done with Pbind + Pdefn or Pbind + PL,</p>
<p class="p18">// a specific possibility with PbindFx is the replacement of \fxOrder</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13"><span class="s18">~midi</span> = <span class="s14">PLseq</span>([60, 60, 60, 62]);</p>
<p class="p13"><span class="s18">~fxs</span> = <span class="s14">PLseq</span>([0, 0, 1, 3]);</p>
<p class="p14"><br></p>
<p class="p18">// Pdefn(\midi, Pseq([60, 60, 60, 62], inf));</p>
<p class="p18">// Pdefn(\fxs, Pseq([0, 0, 1, 3], inf));</p>
<p class="p14"><br></p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\midinote</span><span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span><span class="s13">\midi</span><span class="s2">), </span>// Pdefn(\midi),</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\fxOrder</span><span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span><span class="s13">\fxs</span><span class="s2">),<span class="Apple-tab-span">	</span></span>// Pdefn(\fxs),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.15,</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.2,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, 2,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 0.06,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([5, 20], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p29"><br></p>
<p class="p18">// exchange midinote and effect sequencing on the fly</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~midi</span> = <span class="s14">PLseq</span>([60, 62, 63]);</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~fxs</span> = <span class="s14">PLseq</span>([1, [1, 2], [1, 3], [1, 2, 3]]);</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p13"><span class="s18">~midi</span> = <span class="s14">PLshufn</span>([60, 62, 63]) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">PLshufn</span>([-24, -12, 0]) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">PLshufn</span>([0, [0, 7], [0, 7, 12]]);</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop and free resources</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 7b:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Replacement of source and fx patterns</b></p>
<p class="p25"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p25"><br></p>
<p class="p13">(</p>
<p class="p18">// define source and effect patterns</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~midi</span> = <span class="s14">PLseq</span>([60, 60, 62, 63]);</p>
<p class="p13"><span class="s18">~fxs</span> = <span class="s14">PLseq</span>([1, [1, 2], [1, 3], [1, 2, 3]]);</p>
<p class="p14"><br></p>
<p class="p26"><span class="s18">~src</span><span class="s2"> = </span>Pbind<span class="s2">(</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\midi<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fxOrder<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\fxs<span class="s2">),</span></p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.15,</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.2,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p26"><span class="s18">~fx1</span><span class="s2"> = </span>Pbind<span class="s2">(</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, 2,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p26"><span class="s18">~fx2</span><span class="s2"> = </span>Pbind<span class="s2">(</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 0.06,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p26"><span class="s18">~fx3</span><span class="s2"> = </span>Pbind<span class="s2">(</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([5, 20], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p18">// pass PLx or Pdef placeholder patterns to PbindFx</p>
<p class="p13">p = <span class="s14">PbindFx</span>(<span class="s14">PL</span>(<span class="s13">\src</span>), <span class="s14">PL</span>(<span class="s13">\fx1</span>), <span class="s14">PL</span>(<span class="s13">\fx2</span>), <span class="s14">PL</span>(<span class="s13">\fx3</span>));</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// chorus fx</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\chorus</span><span class="s2">, { </span>|out, in, amp = 1, loDelay = 0.001, hiDelay = 0.005,</p>
<p class="p19"><span class="Apple-tab-span">	</span>maxDelayTime = 0.1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>inSig = <span class="s14">Mix</span>.fill(10, { <span class="s16">|i|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">DelayL</span>.ar(inSig, maxDelayTime, <span class="s14">LFDNoise3</span>.ar(2).range(loDelay, hiDelay))</p>
<p class="p13"><span class="Apple-tab-span">	</span>});</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = inSig * amp / 2;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// replace on the fly, fxOrder sequencing stays the same, but effect changes</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s18">~fx3</span><span class="s2"> = </span>Pbind<span class="s2">(</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\chorus<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.01,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\loDelay</span>, 0.001,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\hiDelay</span>, 0.01,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13">);</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// new source SynthDef</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\source_pulse</span><span class="s2">, { </span>|out = 0, freq = 400, decayTime = 0.5,</p>
<p class="p19"><span class="Apple-tab-span">	</span>attackTime = 0.005, amp = 0.1, gate = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> env, sig;</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">Decay</span>.ar(<span class="s14">Impulse</span>.ar(0), decayTime, <span class="s14">Pulse</span>.ar(freq));</p>
<p class="p13"><span class="Apple-tab-span">	</span>env = <span class="s14">EnvGen</span>.ar(<span class="s14">Env</span>.asr(attackTime, amp, decayTime, <span class="s13">\lin</span>), gate, doneAction: 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, sig ! 2 * env)</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// replace source, building of phrases with rests</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s18">~src</span><span class="s2"> = </span>Pbind<span class="s2">(</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source_pulse<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, 1, 2, 2, 2, 2, 2, 4, <span class="s14">Rest</span>(5)], <span class="s15">inf</span>)) / 8,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">PL</span>(<span class="s13">\midi</span>) + <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([-24, -19, 0, 19, 24], <span class="s15">inf</span>)),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\fxOrder<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\fxs<span class="s2">),</span></p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.1,</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.1,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13">);</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p6"><br></p>
<p class="p15"><b>Example 7c:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Replacement with Pbindef</b></p>
<p class="p25"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p25"><br></p>
<p class="p38">(</p>
<p class="p39">// source and fxs passed as Pbindefs</p>
<p class="p6"><br></p>
<p class="p39">// list of instrument symbols</p>
<p class="p40"><span class="s2">i = [</span>\src<span class="s2">, </span>\fx1<span class="s2">, </span>\fx2<span class="s2">, </span>\fx3<span class="s2">];</span></p>
<p class="p6"><br></p>
<p class="p41">Pbindef<span class="s2">(</span><span class="s13">\src</span><span class="s2">,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.25,</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pseq</span>([60, 60, 60, 62], <span class="s15">inf</span>),</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pseq</span>([0, 0, 1, 3], <span class="s15">inf</span>),</p>
<p class="p6"><br></p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.15,</p>
<p class="p6"><br></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.2,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p38">);</p>
<p class="p6"><br></p>
<p class="p41">Pbindef<span class="s2">(</span><span class="s13">\fx1</span><span class="s2">,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, 2,</p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p38">);</p>
<p class="p6"><br></p>
<p class="p41">Pbindef<span class="s2">(</span><span class="s13">\fx2</span><span class="s2">,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 0.06,</span></p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.3, 1.8),</p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p38">);</p>
<p class="p6"><br></p>
<p class="p41">Pbindef<span class="s2">(</span><span class="s13">\fx3</span><span class="s2">,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([5, 20], <span class="s15">inf</span>),</p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p38">);</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p38">p = <span class="s14">PbindFx</span>(*i.collect { <span class="s16">|x|</span> <span class="s14">Pbindef</span>(x) });</p>
<p class="p6"><br></p>
<p class="p38">q = p.play;</p>
<p class="p38">)</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p39">// replace some of source's key streams</p>
<p class="p6"><br></p>
<p class="p38">(</p>
<p class="p41">Pbindef<span class="s2">(</span><span class="s13">\src</span><span class="s2">,</span></p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([60, 62, 63])) +</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([-24, -12, 0])) +</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([0, [0, 7], [0, 7, 12]])),</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pseq</span>([[1, 3], [1, 2, 3]], <span class="s15">inf</span>)</p>
<p class="p38">)</p>
<p class="p38">)</p>
<p class="p6"><br></p>
<p class="p39">// replace some of an effect's key streams</p>
<p class="p39">// note: this kind of multiple key replacement in Pbindef doesn't work with SC 3.5</p>
<p class="p6"><br></p>
<p class="p38">(</p>
<p class="p41">Pbindef<span class="s2">(</span><span class="s13">\fx3</span><span class="s2">,</span></p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p38"><span class="Apple-tab-span">	</span>[<span class="s13">\resLo</span>, <span class="s13">\resHi</span>], <span class="s14">Pwrand</span>([[200, 300], [1500, 2000]], [0.8, 0.2], <span class="s15">inf</span>),</p>
<p class="p38"><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([1, 5, 20], <span class="s15">inf</span>),</p>
<p class="p40"><span class="s2"><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p38">)</p>
<p class="p38">)</p>
<p class="p6"><br></p>
<p class="p38">q.stop;</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p39">// before playing again do Pbindef cleanup</p>
<p class="p6"><br></p>
<p class="p38">i.do { <span class="s16">|x|</span> <span class="s14">Pbindef</span>(x).clear };</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 8:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>GUI control</b></p>
<p class="p14"><br></p>
<p class="p18">// control of fx params with VarGui</p>
<p class="p18">// control of fx sequencing by code</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// ensure we are in top envir</p>
<p class="p13">currentEnvironment = topEnvironment;</p>
<p class="p14"><br></p>
<p class="p18">// pattern for fxOrder sequencing</p>
<p class="p18">// we want to exchange this on the fly later on</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~fxs</span> = <span class="s14">PLshufn</span>([1, 2, 3, [2, 3], [1, 2, 3]]);</p>
<p class="p14"><br></p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\dur<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\degree<span class="s2">, </span><span class="s14">PLshufn</span><span class="s2">(</span>\degree<span class="s2">),</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// Spec returns a float, so write like this</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\octave</span>, <span class="s14">Pfunc</span> { rrand(<span class="s18">~octaveLo</span>.asInteger, <span class="s18">~octaveHi</span>.asInteger) },</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// we want to read from code in top envir</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">PL</span>(<span class="s13">\fxs</span>, envir: topEnvironment),</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s14">Pfunc</span> { <span class="s16">|e|</span> e.fxOrder.asArray.includes(2).if { 0 }{ 0.2 } },</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\attackTime<span class="s2">, </span><span class="s14">PLwhite</span><span class="s2">(</span>\attackTimeLo<span class="s2">, </span>\attackTimeHi<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, </span><span class="s14">PLwhite</span><span class="s2">(</span>\decayTimeLo<span class="s2">, </span>\decayTimeHi<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\freq<span class="s2">, </span><span class="s14">PLwhite</span><span class="s2">(</span>\spatFreqLo<span class="s2">, </span>\spatFreqHi<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\echoDelta<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, </span><span class="s14">PLwhite</span><span class="s2">(</span>\echoDecayLo<span class="s2">, </span>\echoDecayHi<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\resLo<span class="s2">, </span><span class="s14">PLwhite</span><span class="s2">(</span>\wahResLo<span class="s2">, </span>\wahResHi<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cutOffMoveFreq<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\wahCutOffMoveFreq<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix<span class="s2">, </span><span class="s14">PL</span><span class="s2">(</span>\wahMix<span class="s2">),</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">v = <span class="s14">VarGui</span>([</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\degree</span>, { <span class="s16">|i|</span> [0, 6, <span class="s13">\lin</span>, 1, i+2] }!4,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\octaveLo</span>, [3, 6, <span class="s13">\lin</span>, 1, 4],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\octaveHi</span>, [3, 6, <span class="s13">\lin</span>, 1, 6],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, [0.2, 0.3, <span class="s13">\lin</span>, 0, 0.2],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\attackTimeLo</span>, [0.01, 0.1, <span class="s13">\lin</span>, 0, 0.02],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\attackTimeHi</span>, [0.01, 0.1, <span class="s13">\lin</span>, 0, 0.05],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, [0.0, 0.5, <span class="s13">\lin</span>, 0, 0.2],</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\decayTimeLo</span>, [0.1, 0.5, <span class="s13">\lin</span>, 0, 0.2],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\decayTimeHi</span>, [0.1, 0.5, <span class="s13">\lin</span>, 0, 0.4],</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\spatFreqLo</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 0.5],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\spatFreqHi</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 2],</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\echoDelta</span>, [0.03, 0.1, <span class="s13">\lin</span>, 0, 0.05],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\echoDecayLo</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 0.3],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\echoDecayHi</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 1.8],</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span></span>\wahCutOffMoveFreq<span class="s2">, [0, 10, </span>\lin<span class="s2">, 0, 5],</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\wahResLo</span>, [100, 3000, <span class="s13">\exp</span>, 0, 200],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\wahResHi</span>, [100, 3000, <span class="s13">\exp</span>, 0, 2000],</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\wahMix</span>, [0, 1, <span class="s13">\lin</span>, 0, 1]</p>
<p class="p13"><span class="Apple-tab-span">	</span>], stream: p</p>
<p class="p13">).gui(</p>
<p class="p13"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p13"><span class="Apple-tab-span">	</span>labelWidth: 120,</p>
<p class="p13"><span class="Apple-tab-span">	</span>varColorGroups: (0..20).clumps([12, 2, 3, 4]);</p>
<p class="p13">);</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// start playing with gui and test params</p>
<p class="p18">// change of echoDelta necessarily causes a delay as<span class="Apple-converted-space"> </span></p>
<p class="p18">// delays for events without echo have to be adapted</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// change effect order sequencing</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~fxs</span> = <span class="s14">PLseq</span>([1, 1, 2, 2, 3, 3]);</p>
<p class="p14"><br></p>
<p class="p18">// only spat + wah</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~fxs</span> = [1, 3];</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// no effects</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~fxs</span> = 0;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// kind of polyrhythm with effects and pitches</p>
<p class="p18">// all 4 pitch classes are permanently reordered by PLshufn</p>
<p class="p18">// fixed effect sequencing</p>
<p class="p14"><br></p>
<p class="p13"><span class="s18">~fxs</span> = <span class="s14">PLseq</span>([1, [1, 2], [1, 2, 3]]);</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// stop by gui or explicitely</p>
<p class="p14"><br></p>
<p class="p13">v.streams[0].stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 9:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Using value conversions with fx data</b></p>
<p class="p14"><br></p>
<p class="p18">// Effects can produce their own characteristic frequencies.</p>
<p class="p18">// For this it can be practical to use Event's value conversion framework.</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// filter bank effect, level of signal very much depends on input frequencies</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\klank</span><span class="s2">, { </span>|out, in, freq = 400, add = 7, amp = 1, ringTime = 0.1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">DynKlank</span>.ar(`[freq * [1, add.midiratio], <span class="s15">nil</span>, ringTime ! 2], inSig) * amp / 100;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.2,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, <span class="s14">Pseq</span>([0.15, 0.1, 0.1], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([36, 36, 48, 48, 60, 65, 67])) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pseq</span>([<span class="s14">Pn</span>(0, 40), <span class="s14">Pn</span>(7, 10), <span class="s14">Pn</span>(-5, 10)], <span class="s15">inf</span>) +</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pn</span>(<span class="s14">Pshuf</span>([0, 0, 0, [0, 7], [0, 9], [0, 14]])),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime</span>, <span class="s14">Pwhite</span>(0.8, 1.5),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([1, [1, 2], [1, 2]])),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Prand</span>([1, 2, 3] / 5, <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\klank<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\octave</span>, <span class="s14">Pwhite</span>(5, 8),</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// passing notes instead of frequencies is more pleasant here</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// resulting signal is louder if pitches are near overtones of source</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\note</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([0, 4, 5, 7])),<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\add</span>, <span class="s14">Prand</span>([7, 12], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.1,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\ringTime</span>, <span class="s14">Pwhite</span>(0.1, 0.3),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, 0.7,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\ringTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 10:<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Parallel effects and arbitrary effect graphs</b></p>
<p class="p25"><br></p>
<p class="p15"><b>Example 10a:<span class="Apple-tab-span">	</span>Parallel effects</b></p>
<p class="p25"><br></p>
<p class="p29"><br></p>
<p class="p18">// here source is routed to echo #1 and echo #2 in parallel,</p>
<p class="p18">// echo #1 (fx index 2) is a "classical" echo whereas echo #2 (fx index 3),<span class="Apple-converted-space"> </span></p>
<p class="p18">// due to short echoDelta, results in an additional frequency.</p>
<p class="p18">// The output of echo #2 is routed to a wah-wah, echo #1 directly to out.</p>
<p class="p29"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p14"><br></p>
<p class="p29"><br></p>
<p class="p18">// SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\source<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, <span class="s14">Pseq</span>([<span class="s14">Pn</span>(0.2, { rrand(8, 12) }), <span class="s14">Pwhite</span>(2.0, 4.0, 1)], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.3,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\midinote<span class="s2">, </span><span class="s14">Prand</span><span class="s2">([</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Pwhite</span>(80, 90, 1),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">Prand</span>([60, 67, 70, 73]) + <span class="s14">Prand</span>([0, -12.3, -23.7], <span class="s15">inf</span>),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s15">inf</span>),</p>
<p class="p14"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, `(0: 1, 1: [2, 3], 3: 4),</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// <span class="Apple-tab-span">	</span>compare with this version, where echo #1 is less present, as it also goes to wah</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//<span class="Apple-tab-span">	</span>\fxOrder, `(0: 1, 1: [2, 3], 3: 4, 2: 4),</p>
<p class="p14"><span class="Apple-tab-span">	</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 0.1,<span class="Apple-converted-space"> </span></span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Prand</span>([0.1, 0.8], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.001,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.1</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\echoDelta<span class="s2">, 0.1,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 3,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\echo<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\echoDelta</span>, <span class="s14">Pwhite</span>(0.01, 0.05),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 5,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.5,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\wah<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, 0.7,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cutOffMoveFreq</span>, <span class="s14">Pseq</span>([1, 2, 5, 10], <span class="s15">inf</span>),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.05</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 10b:<span class="Apple-tab-span">	</span>Modulation graphs</b></p>
<p class="p25"><br></p>
<p class="p18">// A generalized modulating effect node has two ins: carrier and modulator.</p>
<p class="p18">// Fx convention of PbindFx demands one single In ugen per fx synth, but two ins <span class="Apple-converted-space"> </span></p>
<p class="p18">// can simply be handled by a 2-channel In ugen and hard-panned input signals.</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p18">// sine source</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\sine_adsrFixed</span><span class="s2">, { </span>|out = 0, freq = 400, decayTime = 0.5,</p>
<p class="p19"><span class="Apple-tab-span">	</span>att = 0.005, dec = 0.01, sus = 0.2, rel = 0.3, susLevel = 0.5, amp = 0.1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> env, sig = <span class="s14">SinOsc</span>.ar(freq);</p>
<p class="p13"><span class="Apple-tab-span">	</span>env = <span class="s14">EnvGen</span>.kr(<span class="s14">Env</span>([0, 1, susLevel, susLevel, 0], [att, dec, sus, rel]), doneAction: 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, sig ! 2 * env * amp)</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p18">// amplitude modulation synth</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\ampMod</span><span class="s2">, { </span>|out, in, dev = 1, amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = inSig[0] * (inSig[1] * dev + <span class="s14">DC</span>.ar(1)) * amp;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p18">// phase modulation synth</p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\phaseMod</span><span class="s2">, { </span>|out, in, maxDelay = 0.1, dev = 1, amp = 1, mix = 1|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s16">var</span> sig, inSig = <span class="s14">In</span>.ar(in, 2);</p>
<p class="p13"><span class="Apple-tab-span">	</span>sig = <span class="s14">DelayC</span>.ar(inSig[0], maxDelay, maxDelay * dev * inSig[1], amp);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p18">// modulator synths, no Ins<span class="Apple-converted-space"> </span></p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\sineM</span><span class="s2">, { </span>|out, in, freq = 100|</p>
<p class="p13"><span class="Apple-converted-space">    </span><span class="s14">Out</span>.ar(out, [0, <span class="s14">SinOsc</span>.ar(freq)]);</p>
<p class="p13">}).add;</p>
<p class="p42"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\pulseM</span><span class="s2">, { </span>|out, in, freq = 100, width = 0.5|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, [0, <span class="s14">Pulse</span>.ar(freq, width, 2)]);</p>
<p class="p13">}).add;</p>
<p class="p14"><br></p>
<p class="p19"><span class="s14">SynthDef</span><span class="s2">(</span><span class="s13">\sawM</span><span class="s2">, { </span>|out, in, freq = 100|</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s14">Out</span>.ar(out, [0, <span class="s14">Saw</span>.ar(freq)]);</p>
<p class="p13">}).add;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p18">// blend of AM events</p>
<p class="p14"><br></p>
<p class="p18">// spat SynthDef from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\sine_adsrFixed<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 1,</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\susLevel<span class="s2">, 1,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, 5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sus</span>, 0,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rel</span>, 5,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, 0.03,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\midinote</span>, <span class="s14">Pwhite</span>(40, 80),</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, `(0: 1, 3: 1, 1: 2),</p>
<p class="p14"><br></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, 1,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 12</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\ampMod<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dev</span>, <span class="s14">Pwhite</span>(0.1, 0.6)</p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\spat<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pwhite</span>(0.2, 2),</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\maxDelayTime<span class="s2">, 0.005,</span></p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\pulseM<span class="s2">,</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s14">Pwhite</span>(200, 1000)</p>
<p class="p13"><span class="Apple-tab-span">	</span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p15"><b>Example 10c:<span class="Apple-tab-span">	</span>Modulation graphs, changed per event</b></p>
<p class="p25"><br></p>
<p class="p18">// fx graphs corresponding to fxOrder `(0:1, 4:1, 1:6) and `(0:1, 5:1, 1:6), src = \sine_adsrFixed:</p>
<p class="p14"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p18">// fx graph corresponding to fxOrder `(0:2, 3:2, 2:6), src = \sine_adsrFixed:</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p14"><br></p>
<p class="p18">// SynthDefs from Ex. 10b</p>
<p class="p18">// spat SynthDefs from Ex. 1a, <span class="s17">see also extended server resources</span> defined there</p>
<p class="p14"><br></p>
<p class="p13">(</p>
<p class="p26"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p27"><span class="s2"><span class="Apple-converted-space">        </span></span>\instrument<span class="s2">, </span>\sine_adsrFixed<span class="s2">,</span></p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\amp</span>, 0.01,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 0.3,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\susLevel</span>, 1,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\att</span>, 0.01,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\sus</span>, 0.15,</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s13">\rel</span>, <span class="s14">Pwhite</span>(0.3, 1.2),</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\amp</span>, 0.05,</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\midinote</span>, <span class="s14">Pwhite</span>(30, 60) + <span class="s14">Prand</span>([0, [0, -12.5]], 200),</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// changes between amplitude (pulse and saw) and phase modulation (sine)</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\fxOrder</span>, <span class="s14">Pn</span>(<span class="s14">Pshuf</span>([</p>
<p class="p13"><span class="Apple-converted-space">                </span>`(0:1, 4:1, 1:6),</p>
<p class="p13"><span class="Apple-converted-space">                </span>`(0:1, 5:1, 1:6),</p>
<p class="p13"><span class="Apple-converted-space">                </span>`(0:2, 3:2, 2:6)</p>
<p class="p13"><span class="Apple-converted-space">            </span>])),</p>
<p class="p14"><br></p>
<p class="p18"><span class="s2"><span class="Apple-converted-space">        </span></span>// equivalent:</p>
<p class="p18"><span class="s2"><span class="Apple-converted-space">        </span></span>// the source stream returns pairs, where the first number indicates</p>
<p class="p18"><span class="s2"><span class="Apple-converted-space">        </span></span>// the modulation type and the second number the modulator,</p>
<p class="p18"><span class="s2"><span class="Apple-converted-space">        </span></span>// the collect function packs the data into the right format of a ref'd Event.</p>
<p class="p14"><br></p>
<p class="p18"><span class="Apple-converted-space">        </span>// \fxOrder, Pn(Pshuf([ [1, 4], [1, 5], [2, 3] ]))</p>
<p class="p18"><span class="Apple-converted-space">        </span>// .collect { |x| ().putPairs([0, x[0], x[1], x[0], x[0], 6]).asRef },</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\decayTime</span>, 2,</p>
<p class="p27"><span class="s2"><span class="Apple-converted-space">        </span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\fx</span>, <span class="s13">\ampMod</span>,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\dev</span>, <span class="s14">Pwhite</span>(0.1, 0.5)</p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p27"><span class="s2"><span class="Apple-converted-space">        </span></span>\fx<span class="s2">, </span>\phaseMod<span class="s2">,</span></p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\dev</span>, <span class="s14">Pwhite</span>(0.03, 0.05)</p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\fx</span>, <span class="s13">\sineM</span>,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\freq</span>, <span class="s14">Pwhite</span>(150, 700)</p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\fx</span>, <span class="s13">\sawM</span>,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\freq</span>, <span class="s14">Pwhite</span>(150, 700)</p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\fx</span>, <span class="s13">\pulseM</span>,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\freq</span>, <span class="s14">Pwhite</span>(150, 700)</p>
<p class="p13"><span class="Apple-converted-space">    </span>],[</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\fx</span>, <span class="s13">\spat</span>,</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\freq</span>, <span class="s14">Pwhite</span>(0.1, 1),</p>
<p class="p13"><span class="Apple-converted-space">        </span><span class="s13">\maxDelayTime</span>, 0.005,</p>
<p class="p27"><span class="s2"><span class="Apple-converted-space">        </span></span>\cleanupDelay<span class="s2">, </span><span class="s14">Pkey</span><span class="s2">(</span>\maxDelayTime<span class="s2">)</span></p>
<p class="p13"><span class="Apple-converted-space">    </span>]</p>
<p class="p13">);</p>
<p class="p14"><br></p>
<p class="p13">q = p.play;</p>
<p class="p13">)</p>
<p class="p14"><br></p>
<p class="p13">q.stop;</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
</body>
</html>
