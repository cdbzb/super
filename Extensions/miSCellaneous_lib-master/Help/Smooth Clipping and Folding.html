<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1187.4">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00; min-height: 12.0px}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0433ff}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0326cb}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #000000}
span.s3 {text-decoration: underline}
span.s4 {color: #0326cb}
span.s5 {font: 12.0px Helvetica}
span.s6 {color: #0433ff}
span.s7 {color: #737373}
span.s8 {color: #008300}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>Smooth Clipping and Folding<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>a suite of pseudo ugens for smooth clipping and folding</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>Part of:</b> <a href="miSCellaneous.html"><span class="s3">miSCellaneous</span></a></span></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>See also: </b><a href="SmoothClipS.html"><span class="s3">SmoothClipS</span></a>, <a href="SmoothClipQ.html"><span class="s3">SmoothClipQ</span></a>, <a href="SmoothFoldS.html"><span class="s3">SmoothFoldS</span></a>, <a href="SmoothFoldQ.html"><span class="s3">SmoothFoldQ</span></a>, <a href="SmoothFoldS2.html"><span class="s3">SmoothFoldS2</span></a>, <a href="SmoothFoldQ2.html"><span class="s3">SmoothFoldQ2</span></a><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p1">Wave folding is a synthesis technique from analog days, going back to Donald Buchla and the tradition of west coast synthesis. Smooth clipping and folding pseudo ugens from miSCellaneous lib come in variants which include quadratic and sinusoidal waveshaping and allow clipping and folding without aliasing. This can also be used for buffer scratching – a synthesis technique which I have been experimenting with recently with great fun.</p>
<p class="p2"><br></p>
<p class="p5"><br></p>
<p class="p6"><b>Ex. 1: Different types of folding</b></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8">// A typical usage is preamplifying a signal, here we start with a sine wave, compare plots</p>
<p class="p9"><br></p>
<p class="p10">{</p>
<p class="p10"><span class="Apple-tab-span">	</span>[</p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// just smooth clipping</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">SmoothClipS</span>.ar(<span class="s4">SinOsc</span>.ar(50) * 10),<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// folding with main lib's Fold ugen</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">Fold</span>.ar(<span class="s4">SinOsc</span>.ar(50) * 10, -1, 1),<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// folding with rather low smoothing<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// wave shaper is partiallly a sine wave</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(<span class="s4">SinOsc</span>.ar(50) * 10, smoothAmount: 0.3),<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// folding with maximum smoothing<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// wave shaper is full sine wave</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(<span class="s4">SinOsc</span>.ar(50) * 10, smoothAmount: 1),<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// wave is folded back only to border ranges</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(<span class="s4">SinOsc</span>.ar(50) * 10, foldRange: 0.3),</p>
<p class="p9"><br></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// folding with different sizes of border ranges</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS2</span>.ar(<span class="s4">SinOsc</span>.ar(50) * 10, foldRangeLo: 0.5, foldRangeHi: 0.2)</p>
<p class="p10"><span class="Apple-tab-span">	</span>]</p>
<p class="p10">}.plot(1/50)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11"><span class="s5"><img src="attachments/Smooth Clipping and Folding/fold_examples.png" alt="attachments/Smooth Clipping and Folding/fold_examples.png"></span></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p12"><b>Ex. 2: Generating rich spectra by folding sine waves</b></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8">// Folding ugens do multichannel expansion, let two anticyclic sines control the fold range,</p>
<p class="p8">// control smoothing amount with MouseX</p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">SinOsc</span>.ar(50);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(source, -0.1, 0.1, <span class="s4">SinOsc</span>.kr(0.05, [0, pi]).range(0.1, 1), <span class="s4">MouseX</span>.kr(0, 1))</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8">// Compare with the parabolic smoothing variant, the difference isn't great in this case</p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">SinOsc</span>.ar(50);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldQ</span>.ar(source, -0.1, 0.1, <span class="s4">SinOsc</span>.kr(0.05, [0, pi]).range(0.1, 1), <span class="s4">MouseX</span>.kr(0, 1))</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8">// slow modulations of source frequency with independant LFOs<span class="Apple-converted-space"> </span></p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">SinOsc</span>.ar(50 * { <span class="s4">LFDNoise3</span>.kr(0.1).range(0.98, 1.02) } ! 2);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(source, -0.1, 0.1, <span class="s4">SinOsc</span>.kr(0.05, [0, pi]).range(0.1, 1))</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8">// Adding more complexity by applying preamplification (causes more folding) and adding an offset,</p>
<p class="p8">// these operations are also L/R-independant<span class="Apple-converted-space"> </span></p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">SinOsc</span>.ar(</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>50 * { <span class="s4">LFDNoise3</span>.kr(0.1).range(0.98, 1.02) } ! 2,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{ <span class="s4">LFDNoise3</span>.kr(0.15).range(0.5, 3) } ! 2,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{ <span class="s4">LFDNoise3</span>.kr(0.2).range(-2, 2) } ! 2</p>
<p class="p10"><span class="Apple-tab-span">	</span>);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(source, -0.1, 0.1, <span class="s4">SinOsc</span>.kr(0.05, [0, pi]).range(0.1, 1))</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p6"><b>Ex. 3: Applying modulated folding to LFO sources</b></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8">// the other way round, take a lfo source and modulate folding parameters, here the relative folding range</p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">LFDNoise3</span>.ar(0.3!2).range(0.5, 1);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(source, -0.1, 0.1, <span class="s4">SinOsc</span>.ar([50, 50.1]).range(0.1, 1) )</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8">// modulating fold bounds</p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">LFDNoise3</span>.ar(0.3!2).range(0.5, 1);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> bounds = <span class="s4">SinOsc</span>.ar([50, 50.1]).range(0.02, 0.1);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(source, bounds.neg, bounds)</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8">// modulating bounds and range</p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p10">x = {</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> source = <span class="s4">LFDNoise3</span>.ar(0.3!2).range(0.5, 1);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> range = <span class="s4">SinOsc</span>.ar([50, 50.1]).range(0.02, 0.1);</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">SmoothFoldS</span>.ar(source, range.neg, range, <span class="s4">SinOsc</span>.ar([200, 200.1]).range(0.5, 1))</p>
<p class="p10">}.scope</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p6"><b>Ex. 4: Buffer scratching with folded signal as position control</b></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p8">// Interesting micro textures can be generated that way.</p>
<p class="p8">// Technically this is waveshaping with an audio buffer as transfer function and the folded signal as source.</p>
<p class="p13"><br></p>
<p class="p8">// compare with granulation, sound file from buffer granulation tutorial</p>
<p class="p13"><br></p>
<p class="p14">b = <span class="s4">Buffer</span>.read(s, <span class="s4">Platform</span>.miSCellaneousDirs[0] +/+ <span class="s7">"Sounds"</span> +/+ <span class="s7">"kitchen_sounds_1.wav"</span>);</p>
<p class="p8">// This searches the most likely extension places for the miSCellaneous folder.</p>
<p class="p8">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</p>
<p class="p13"><br></p>
<p class="p9"><br></p>
<p class="p10">(</p>
<p class="p15"><span class="s4">SynthDef</span><span class="s2">(</span><span class="s8">\bufScratchFold</span><span class="s2">, { </span>|bufnum = 0, globalFreq = 0.7, localOscSize = 0.01, foldRange = 0.28,</p>
<p class="p15"><span class="Apple-tab-span">	</span>localFreq = 0.87, preAmp = 1.4, smoothAmount = 0.36|</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s6">var</span> sig = <span class="s4">BufRd</span>.ar(</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bufnum,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// define global and local movement</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">LFDNoise3</span>.ar(globalFreq).range(0.2, 0.7) +</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>SmoothFoldS<span class="s2">.ar(</span></p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// adding space by decorrelating the local scratching / oscillation</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">LFTri</span>.ar(localFreq * ({ <span class="s4">LFDNoise3</span>.ar(0.2).range(0.999, 1.001) } ! 2)) * preAmp,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>foldRange: foldRange,</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>smoothAmount: smoothAmount</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>) * localOscSize</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>) * <span class="s4">BufFrames</span>.ir(bufnum)</p>
<p class="p10"><span class="Apple-tab-span">	</span>);</p>
<p class="p8"><span class="s2"><span class="Apple-tab-span">	</span></span>// as local oscillation can stick with positive or negative values, a dc leaker is recommended<span class="Apple-converted-space"> </span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="s4">Out</span>.ar(0, <span class="s4">LeakDC</span>.ar(sig) * <span class="s4">EnvGate</span>.new)</p>
<p class="p10">}).add</p>
<p class="p10">)</p>
<p class="p9"><br></p>
<p class="p10">x = <span class="s4">Synth</span>(<span class="s8">\bufScratchFold</span>, [bufnum: b])</p>
<p class="p9"><br></p>
<p class="p10">x.set(<span class="s8">\preAmp</span>, 5.4)</p>
<p class="p10">x.set(<span class="s8">\foldRange</span>, 0.08)</p>
<p class="p10">x.set(<span class="s8">\localFreq</span>, 0.5)</p>
<p class="p10">x.set(<span class="s8">\localOscSize</span>, 0.05)</p>
<p class="p10">x.set(<span class="s8">\foldRange</span>, 0.02)</p>
<p class="p10">x.set(<span class="s8">\localFreq</span>, 0.1)</p>
<p class="p9"><br></p>
<p class="p10">x.release</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
</body>
</html>
