<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1187.4">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Arial}
p.p6 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; font: 12.0px Helvetica}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0433ff}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00; min-height: 12.0px}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Helvetica; min-height: 11.0px}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0326cb}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #008300}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #ff7c00}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #ff7c00; min-height: 12.0px}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #000000}
span.s3 {text-decoration: underline}
span.s4 {text-decoration: underline ; color: #0095ff}
span.s5 {color: #00bbff}
span.s6 {text-decoration: underline ; color: #01caff}
span.s7 {text-decoration: underline ; color: #042eee}
span.s8 {font: 12.0px Helvetica}
span.s9 {text-decoration: underline ; color: #033bff}
span.s10 {text-decoration: underline ; color: #0067ff}
span.s11 {color: #0326cb}
span.s12 {color: #737373}
span.s13 {color: #008300}
span.s14 {color: #0433ff}
span.s15 {color: #ff7c00}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>kitchen studies<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>source code of the corresponding fixed media piece</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>Part of:</b> <a href="miSCellaneous.html"><span class="s3">miSCellaneous</span></a></span></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>See also:</b> <a href="PbindFx.html"><span class="s4">PbindFx</span></a></span><span class="s4">,</span><span class="s2"> <a href="Buffer Granulation.html"><span class="s3">Buffer Granulation</span></a></span><span class="s5">,</span><span class="s2"> <a href="Live Granulation.html"><span class="s3">Live Granulation</span></a></span><span class="s5">,</span><span class="s2"> <a href="VarGui.html"><span class="s6">VarGui</span></a></span><span class="s7">,</span><span class="s2"> <a href="DX suite.html"><span class="s3">DX suite</span></a>, <a href="DXMix.html"><span class="s3">DXMix</span></a>, <a href="DXMixIn.html"><span class="s3">DXMixIn</span></a>,<b> </b><a href="DXEnvFan.html"><span class="s3">DXEnvFan</span></a>,<b> </b><a href="DXEnvFanOut.html"><span class="s3">DXEnvFanOut</span></a>, <a href="DXFan.html"><span class="s3">DXFan</span></a>, <a href="DXFanOut.html"><span class="s3">DXFanOut</span></a></span><span class="s5">,</span><span class="s2"> <a href="../../ZeroXBufRd.html"><span class="s7">ZeroXBufRd</span></a>,<b> </b><a href="../../TZeroXBufRd.html"><span class="s7">TZeroXBufRd</span></a>,<b> </b><a href="../../ZeroXBufWr.html"><span class="s7">ZeroXBufWr</span></a></span></p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p1">In 2016 my interest in granular synthesis was focussed on the potential of sequencing arbitrary effects and effect graphs on single grains. This is an application of the class PbindFx, which I added with miSCellaneous v0.14. As the possibilities are countless – an arbitrary number of effects can be applied on each grain in an arbitrary way: in sequence, in parallel or in any graph order – I started experiments with combinations of at most two effects and sequencing their parameters. At the same time I wanted to share my experiences and document what I was encountering while composing a piece of music. I thought the best approach for that twofold need would be a sequence of small pieces in once, each of them using different effect processings per grain. A piece of such form would not be totally typical for my usual compositional practice, as I tend to favour longer forms with a few contrasting types of material combined in a developing relation, but nevertheless an interesting challenge. As a sound source I took the kitchen sound of five seconds which is already contained in miSCellaneous lib since version 0.7 and used for examples in the Buffer Granulation tutorial.<span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="s8">For the fixed media piece <i>kitchen studies</i> </span>the audio, resulting from the six sections of code below, has only been cut and slightly mastered with a bit of equalization (as many random components are included, the output will of course vary from one evaluation to the next). Each code section delivers a mixed control by gui (VarGui) and code snippets (Patterns), which reflects my personal experimental preferences with the concerned sounds and might serve as a starting point for the reader's experiments and modifications. Compressed versions of the original piece as a whole and its parts can be found on my website <a href="http://daniel-mayer.at/index_en.htm"><span class="s9">http://daniel-mayer.at</span></a>, a further documentation of the compositional process will follow as publication in the artistic research database <i>Research Catalogue</i> (<a href="https://www.researchcatalogue.net/profile/show-exposition?exposition=324609"><span class="s9">https://www.researchcatalogue.net/profile/show-exposition?exposition=324609</span></a>).</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>WARNING:</b><span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">1.) <span class="Apple-tab-span">	</span>Be careful with amplitudes, especially with buffers you haven't granulated before !</p>
<p class="p6"><span class="Apple-tab-span">	</span>Also keep in mind that a granular cloud moving through a buffer can suddenly become louder – this is especially the case with the one percussive sound contained in the used kitchen source sound. Moreover other controls than amp (e.g. buffer position, trigger rate, effect parameters) can cause a raise of amplitude too.</p>
<p class="p2"><br></p>
<p class="p6">2.)<span class="Apple-tab-span">	</span>I haven't used below setups for live performances. Although all of them work stable for me as they are, in general hangs can occasionally happen with pattern-driven setups. Often this can be tracked down to sequences of extremely short event durations (and/or long grain durations). Where this can happen as a side-effect, thresholds can be built in (e.g. a parameter maxTrigRate).<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>Another possible source of hangs is careless deep nesting of Patterns where mistakes can easily occur. Starting with clear Pattern structures is recommended – and if more complications are involved: testing without sound first after saving your patch (generating data with a single Stream derived from a Pattern), might be a good idea.<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>NOTE:</b><span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><b>Running the code examples: </b>First run the code from chapter 'Preparations' - i.e. start server with extended ressources and evaluate the following block of code. Then you can run the example code of each part (but not in parallel). See the comments of 'Part 1', many of them explain principles, which are used in all other parts too. Similary, gui conventions are pretty much the same for all six parts, see the note on common VarGui features below.</p>
<p class="p1"><b>Types of variables: </b>For employing the VarGui interface environmental variables and PLx patterns are used. With VarGui every EventStreamPlayer derived from a passed Pattern is run in a separate newly generated Environment, where variables are being set and Streams from Pfuncs and PLx patterns are reading from. See <a href="Event patterns and Functions.html"><span class="s9">Event patterns and Functions</span></a>, <a href="PLx suite.html"><span class="s10">PLx suite</span></a> and <a href="VarGui.html"><span class="s6">VarGui</span></a>. For certain live replacements though, environmental variables in topEnvironment are chosen and for the sake of clarity some interpreter variables are used too. As a result of these two exceptions the six code blocks, as they are, cannot be run in parallel. As each one is producing dense and rich sound structures it was supposed that combining them in realtime would not be the first option anyway, but it could of course be done by rewriting these variables.</p>
<p class="p1"><b>Buffers:</b> All examples below expect mono buffers like the delivered kitchen sound. Buffer paths refering to the included sample suppose that you have installed via quarks or moved miSCellaneous lib into the user or system extensions directory directly (not into a subfolder), if not so or you have moved the sample file somewhere else you'd have to change paths accordingly.</p>
<p class="p1"><b>Versions: </b>For the published version of <i>kitchen studies </i>I worked on OS 10.6 / SC 3.6.5 and OS 10.8.5 / SC 3.8.0, slight differences in sound might occur with other hardware, operating systems and SC versions.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p7"><br></p>
<p class="p8"><b>Preparations</b></p>
<p class="p9"><br></p>
<p class="p10">// start server with extended ressources</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11">s.options.numPrivateAudioBusChannels = 2048;</p>
<p class="p11">s.options.memSize = 8192 * 32;</p>
<p class="p11">s.options.maxNodes = 1024 * 4;</p>
<p class="p9"><br></p>
<p class="p11">s.reboot;</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p10">// loading the buffer (maybe you need to use Platform.systemExtensionDir instead)</p>
<p class="p9"><br></p>
<p class="p10">// defining SynthDefs:</p>
<p class="p10">// 'pos' for single grains</p>
<p class="p10">// 'posPlay' for moving buffer position</p>
<p class="p10">// fx SynthDefs for PbindFx</p>
<p class="p10">// 'leakDC' for leaking DC from summed grains and limiting</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11">b = <span class="s11">Buffer</span>.read(s, <span class="s11">Platform</span>.miSCellaneousDirs[0] +/+ <span class="s12">"Sounds"</span> +/+ <span class="s12">"kitchen_sounds_1.wav"</span>);</p>
<p class="p10">// This searches the most likely extension places for the miSCellaneous folder.</p>
<p class="p10">// In case of an extraordinary install situation or a removed sound file, pass the concerned path.</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// \posPlay is the synthdef for one grain</p>
<p class="p10">// args pos and posDev are to be read from a bus, played by a LFO</p>
<p class="p9"><br></p>
<p class="p10">// arg pos is relative between 0 and 1</p>
<p class="p10">// arg posDev is absolute (max absolute deviation in seconds from pos)</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\posPlay</span><span class="s2">, { </span>|out = 0, sndBuf = 0, granDur = 0.1, pos = 0,</p>
<p class="p12"><span class="Apple-tab-span">	</span>posDev = 0, rate = 1, att = 0.002, rel = 0.005, pan = 0, amp = 1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> env, src;</p>
<p class="p11"><span class="Apple-tab-span">	</span>pos = <span class="s11">Rand</span>(posDev.neg, posDev) / <span class="s11">BufDur</span>.kr(sndBuf) + pos;</p>
<p class="p11"><span class="Apple-tab-span">	</span>src = <span class="s11">PlayBuf</span>.ar(1, sndBuf, <span class="s11">BufRateScale</span>.kr(sndBuf) * rate,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1, round(pos * <span class="s11">BufFrames</span>.kr(sndBuf)), 1, 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span>env = <span class="s11">EnvGen</span>.ar(</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">Env</span>([0, amp, amp, 0], [att, granDur - att - rel, rel], 0),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>doneAction: 2</p>
<p class="p11"><span class="Apple-tab-span">	</span>);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, <span class="s11">Pan2</span>.ar(src, pan) * env);</p>
<p class="p11">}, <span class="s13">\ir</span>!10).add;</p>
<p class="p9"><br></p>
<p class="p10">// posRate of 1 (given by posRateE and posRateM) means</p>
<p class="p10">// pos movement through the buffer with original velocity.</p>
<p class="p10">// buffer segment is determined by posLo and posHi.</p>
<p class="p10">// posDev and pos movement do not depend on buffer length and size of buffer segment !</p>
<p class="p10">// (posRate does, but pos is then mapped to the buffer segment by .linlin)</p>
<p class="p13"><br></p>
<p class="p10">// there are four types of movement through the buffer, determined by the arg 'type':</p>
<p class="p10">// O: forward</p>
<p class="p10">// 1: backward</p>
<p class="p10">// 2: forward and backward</p>
<p class="p10">// 3: randomly with cubic interpolation</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\pos</span><span class="s2">, { </span>|out = 0, sndBuf = 0, posRateE = 0, posRateM = 1, type = 0,</p>
<p class="p12"><span class="Apple-tab-span">	</span>posLo = 0, posHi = 1, posDevE = 1, posDevM = 0|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> pos, posDev = 10 ** posDevE * posDevM, posRate = 10 ** posRateE * posRateM;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>posRate = posRate / <span class="s11">BufDur</span>.kr(sndBuf) / max(0.001, (posHi - posLo));</p>
<p class="p11"><span class="Apple-tab-span">	</span>pos = <span class="s11">Select</span>.kr(type, [</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">LFSaw</span>.kr(posRate, 1),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">LFSaw</span>.kr(posRate, 1).neg,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">LFTri</span>.kr(posRate, 1).neg,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">LFDNoise3</span>.kr(posRate)</p>
<p class="p11"><span class="Apple-tab-span">	</span>]);</p>
<p class="p11"><span class="Apple-tab-span">	</span>pos = pos.linlin(-1, 1, posLo, posHi);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Out</span>.kr(out, [pos, posDev])</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// leaking DC and limiting summed audio of all grains</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\leakDC</span><span class="s2">, { </span>|out = 0, in|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> sig = <span class="s11">In</span>.ar(in, 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Out</span>.ar(out, <span class="s11">Limiter</span>.ar(<span class="s11">LeakDC</span>.ar(sig)));</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// this Function determines enveloping convention:</p>
<p class="p10">// absEnv = 1 (true): attack and release times in milliseconds are taken anyway,</p>
<p class="p10">// 'overlap' is possibly overriden.</p>
<p class="p10">// absEnv = 0 (false): attack and release times in milliseconds are taken only if</p>
<p class="p10">// their sum is smaller than grain duration (derived from 'overlap' and 'trigRate'),</p>
<p class="p10">// otherwise they are shrunk and their relation is kept.</p>
<p class="p9"><br></p>
<p class="p11">d = ();</p>
<p class="p9"><br></p>
<p class="p12"><span class="s2">d.attRel = { </span>|dict, granDur, att, rel, absEnv = 1|</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span></span>// times in secs</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> sum;</p>
<p class="p11"><span class="Apple-tab-span">	</span>att = att * 0.001;</p>
<p class="p11"><span class="Apple-tab-span">	</span>rel = rel * 0.001;</p>
<p class="p11"><span class="Apple-tab-span">	</span>sum = att + rel;</p>
<p class="p11"><span class="Apple-tab-span">	</span>(sum &lt;= granDur).if {</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[att, rel]</p>
<p class="p11"><span class="Apple-tab-span">	</span>}{</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(absEnv == 1).if {</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[att, rel]</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}{</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[granDur * att, granDur * rel] / sum</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p11"><span class="Apple-tab-span">	</span>}</p>
<p class="p11">};</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p14"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>NOTE:</b><span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><b>Common features of dedicated VarGuis<span class="Apple-converted-space"> </span></b></p>
<p class="p2"><br></p>
<p class="p1">The slider section always contains two blocks, the lower one is for parameters of the buffer position synth and the upper one is for parameters of the PbindFx. Within the lower block the relative buffer position is determined by parameters 'posLo' and 'posHi'. As the percussive event within the the loaded kitchen sound appears around position 0.3, most position defaults describe a relatively small section around this value. The deviation of position as well as the rate of movement through the buffer are determined by a mantissa-exponent representation each. Finally four types of movement are defined: 0 = forward, 1 = backward, 2 = forward and backward, 3 = random with cubic interpolation.</p>
<p class="p1">Within the upper block there are two or three differently colored sections, separating controls of source and effects (one or two). PbindFx parameters can be directly passed to the source grain player synths (such a 'amp'), but they might also be used to process the actual synth args, e.g. 'absEnv' determines if parameters 'att' and 'rel' are to be taken literally or relative with respect to an "absolute" 'overlap' value (see pseudo method 'attRel' above), this kind of processing is defined within the PbindFx. Not all parameters need to occur in the VarGui instance, they might also be controlled by PL pattern proxies, in that case the pattern sources are defined in topEnvironment later on.</p>
<p class="p1">Amplitude parameters 'amp' occur with grain synths as well as with effect synths, in the latter case they appear with the fx name as suffix in the gui. Their meaning is not the same in all cases, mostly they are understood as amplitudes of the fx-processed signal ("pre-mix"), but they can be applied to the mix too ("post-mix"). In the case of a combined fx/no-fx sequencing a more fine-tuned amplitude control can be achieved with applying a separate gain fx, which is used instead of no effect. For the the sake of clarity this is only done within the last part.</p>
<p class="p1">The EventStreamPlayer derived from the PbindFx (e0 on the right side) and the buffer position synth can be started separately by pressing the green buttons. Note that patches can also be controlled by setting certain PL proxy pattern sources as shown at the bottom of part 1. Regarding the compositional process of <i>kitchen studies, </i>the final sounding result very much depends on the decision which parameters are controlled by pattern sequencing and which ones are controlled by gui-tunable parameters. Such decisions happened during a long process of experimenting which usually started with gui control for all parameters. However for the final version no live-control with sliders has been recorded, parameters were either fixed or algorithmically controlled by patterns.</p>
<p class="p2"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p8"><b>Part 1 – comb delay plus separate delay modulation</b></p>
<p class="p9"><br></p>
<p class="p10">// This granulation combines two effects in sequence.</p>
<p class="p10">// The same effect chain (fxOrder = [1, 2]) is used for all grains but parameters change.</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p10">// comb delay</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\comb</span><span class="s2">, { </span>|out = 0, in, mix = 0.5, amp = 1, maxDelayTime = 0.2, delayTime = 0.02,</p>
<p class="p12"><span class="Apple-tab-span">	</span>decayTime = 1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> sig, inSig = <span class="s11">In</span>.ar(in, 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">CombL</span>.ar(inSig, maxDelayTime, delayTime, decayTime, amp);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p10">// modulation of delay</p>
<p class="p10">// modInd is a provisional measure for delay modulation in analogy to FM's index</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\delayMod</span><span class="s2">, { </span>|out = 0, in, delayTime = 0.1, maxDelayTime = 2,</p>
<p class="p12"><span class="Apple-tab-span">	</span>modFreq = 0, modIndM = 0, modIndE = -5, mix = 1, amp = 0.1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> inSig = <span class="s11">In</span>.ar(in, 2), sig, modDev;</p>
<p class="p11"><span class="Apple-tab-span">	</span>modDev = 10 ** modIndE * modIndM * modFreq;</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">DelayC</span>.ar(inSig, maxDelayTime, <span class="s11">SinOsc</span>.ar(modFreq, 0, modDev, delayTime), amp);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, (1 - mix) * inSig + (sig * mix));</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// topEnvironment needed for pattern proxies</p>
<p class="p10">// the slider variables are set in dedicated environments by VarGui</p>
<p class="p9"><br></p>
<p class="p11">t = topEnvironment.push;</p>
<p class="p9"><br></p>
<p class="p10">// bus to DC leaker</p>
<p class="p11">a = <span class="s11">Bus</span>.audio(s, 2);</p>
<p class="p9"><br></p>
<p class="p10">// bus for position control</p>
<p class="p11">c = <span class="s11">Bus</span>.control(s, 2);</p>
<p class="p9"><br></p>
<p class="p10">// PLs with envir = t will read from topEnvironment Patterns/Streams (see below)</p>
<p class="p10">// other PLs will read slider values</p>
<p class="p9"><br></p>
<p class="p10">// produce three minutes audio</p>
<p class="p9"><br></p>
<p class="p15"><span class="s2">p = </span>Pfindur<span class="s2">(180, </span>PbindFx<span class="s2">([</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\posPlay<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, a,</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s11">PL</span><span class="s2">(</span>\trigRate<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\granDur</span>, <span class="s11">Pkey</span>(<span class="s13">\dur</span>) * <span class="s11">PL</span>(<span class="s13">\overlap</span>, envir: t),</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.subBus(0).asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, c.subBus(1).asMap,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, <span class="s11">PL</span>(<span class="s13">\rate</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pan</span>, <span class="s11">PLseq</span>([-1, 1]) * <span class="s11">PL</span>(<span class="s13">\panMax</span>),</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// determining concrete envelope times (see Function attRel above)</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s13">\att</span>, <span class="s13">\rel</span>], <span class="s11">Pfunc</span> { <span class="s14">|ev|</span> d.attRel(ev[<span class="s13">\granDur</span>], <span class="s15">~att</span>, <span class="s15">~rel</span>, <span class="s15">~absEnv</span>) },</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s11">PL</span>(<span class="s13">\fxOrder</span>, envir: t),</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// comb delay time needed for lag in case of no comb</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\delayTime_comb</span>, <span class="s11">PL</span>(<span class="s13">\delayTime_comb</span>, envir: t).collect { <span class="s14">|x|</span> d.dt = x; x },</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lag</span>, <span class="s11">Pfunc</span> { <span class="s14">|ev|</span><span class="Apple-converted-space">  </span>(ev.fxOrder.asArray.includes(1)).if { 0 }{ ev.delayTime_comb } },</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.3</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\comb<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\decayTime<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\decayTime_comb<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\delayTime</span>, <span class="s11">Pfunc</span> { d.dt },</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\mix_comb<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_comb<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\decayTime<span class="s2">)</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\delayMod<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\mix_delayMod<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_delayMod<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\modIndM<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\modIndM_delayMod<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\modIndE<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\modIndE_delayMod<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\modFreq<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\modFreq_delayMod<span class="s2">, envir: t),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.1</span></p>
<p class="p11"><span class="Apple-converted-space">    </span>]</p>
<p class="p11">));</p>
<p class="p9"><br></p>
<p class="p10">// slider and player control</p>
<p class="p11">v = <span class="s11">VarGui</span>([</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, [1, 200, <span class="s13">\lin</span>, 0, 6.97],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\rel</span>, [1, 200, <span class="s13">\lin</span>, 0, 8.96],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\absEnv</span>, [0, 1, <span class="s13">\lin</span>, 1, 0.0],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\trigRate</span>, [1, 200, <span class="s13">\lin</span>, 0, 66.67],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMax</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.89],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\amp</span>, [0.0, 3, <span class="s13">\lin</span>, 0, 1],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\decayTime_comb</span>, [0.001, 1, <span class="s13">\lin</span>, 0, 0.14086],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\mix_comb</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.7],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\amp_comb</span>, [0, 3, <span class="s13">\lin</span>, 0, 1],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\modIndE_delayMod</span>, [-6, -2, <span class="s13">\lin</span>, 1, -5.0],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\modIndM_delayMod</span>, [0, 10, <span class="s13">\lin</span>, 0, 1.5],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\mix_delayMod</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.88],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\amp_delayMod</span>, [0, 3, <span class="s13">\lin</span>, 0, 1.0]</p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posLo</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.2673],</p>
<p class="p11"><span class="Apple-converted-space">   <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\posHi</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.3267],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevE</span>, [-6, 0, <span class="s13">\lin</span>, 1, -5],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevM</span>, [0.0, 10, <span class="s13">\lin</span>, 0, 6.7],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateE</span>, [-4, 2, <span class="s13">\lin</span>, 1, -1],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 0.694],</p>
<p class="p11"><span class="Apple-converted-space">  <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\type</span>, [0, 3, <span class="s13">\lin</span>, 1, 3],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index</p>
<p class="p11"><span class="Apple-tab-span">	</span>], stream: p, synth: <span class="s13">\pos</span></p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p10">// gui look, color grouping</p>
<p class="p11">w = (</p>
<p class="p11"><span class="Apple-tab-span">	</span>varColorGroups: (0..12).clumps([6, 3, 4]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>synthColorGroups: (0..8).clumps([1, 2, 2, 2, 1, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>labelWidth: 130,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderHeight: 18,</p>
<p class="p11"><span class="Apple-tab-span">	</span>playerHeight: 18</p>
<p class="p11">);</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// running the patch: evaluate this,<span class="Apple-converted-space"> </span></p>
<p class="p10">// then in gui start position synth and PbindFx stream by pressing both green buttons</p>
<p class="p9"><br></p>
<p class="p10">// Psegs are very practical for defining LFO-like behaviour in SC lang</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11">x = <span class="s11">Synth</span>(<span class="s13">\leakDC</span>, [<span class="s13">\out</span>, 0, <span class="s13">\in</span>, a]);</p>
<p class="p9"><br></p>
<p class="p11"><span class="s15">~overlap</span> = <span class="s11">Pseg</span>(<span class="s11">PLwrand</span>([0.05, 0.5, 1], [4, 1, 1].normalizeSum), <span class="s11">Pwhite</span>(0.5, 1), <span class="s13">\sine</span>);</p>
<p class="p11"><span class="s15">~rate</span> = <span class="s11">Pseg</span>(<span class="s11">Pwhite</span>(0.05, 1), <span class="s11">Pexprand</span>(0.01, 0.5), <span class="s13">\sine</span>);</p>
<p class="p11"><span class="s15">~delayTime_comb</span> = <span class="s11">Pseg</span>(<span class="s11">PLseq</span>([0.02, 0.002]), <span class="s11">Pwhite</span>(8, 15));</p>
<p class="p11"><span class="s15">~fxOrder</span> = [1, 2];</p>
<p class="p11"><span class="s15">~modFreq_delayMod</span> = <span class="s11">Pseg</span>(<span class="s11">Pwhite</span>(10, 150), <span class="s11">Pwhite</span>(2, 5), <span class="s13">\sine</span>);</p>
<p class="p9"><br></p>
<p class="p11">v.performWithEnvir(<span class="s13">\gui</span>, w)</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p10">// while running the patch you can play with sliders and</p>
<p class="p10">// exchange the control patterns in top envir on the fly:</p>
<p class="p9"><br></p>
<p class="p17">~delayTime_comb<span class="s2"> = 0.002;</span></p>
<p class="p11"><span class="s15">~rate</span> = 0.5;</p>
<p class="p9"><br></p>
<p class="p17">~modFreq_delayMod<span class="s2"> = 70;</span></p>
<p class="p17">~modFreq_delayMod<span class="s2"> = 50;</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="s15">~modFreq_delayMod</span> = <span class="s11">Pseg</span>(<span class="s11">Pwhite</span>(10, 150), <span class="s11">Pwhite</span>(2, 5), <span class="s13">\sine</span>);</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// experiment with fx sequencing: no - comb - (comb &gt; delay modulation)</p>
<p class="p18"><br></p>
<p class="p11"><span class="s15">~fxOrder</span> = <span class="s11">PLseq</span>([0, 1, [1, 2]]);</p>
<p class="p11"><span class="s15">~fxOrder</span> = <span class="s11">Pstutter</span>(<span class="s11">Pwhite</span>(1, 10), <span class="s11">PLseq</span>([0, 1, [1, 2]]));</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// after stopping free leakDC synth</p>
<p class="p9"><br></p>
<p class="p11">x.free</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p14"><br></p>
<p class="p8"><b>Part 2 – rectangular comb (FFT)</b></p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p10">// rectangular comb, FFT processing per grain</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\pv_rectComb</span><span class="s2">, { </span>|out = 0, in, numTeeth = 0, width = 0.5, phase = 0, mix = 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>amp = 0.1|</p>
<p class="p11"><span class="Apple-converted-space">    </span><span class="s14">var</span> chain, inSig = <span class="s11">In</span>.ar(in, 2), sig, bufSize = 512, inSigDelayed;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    </span>chain = <span class="s11">FFT</span>({ <span class="s11">LocalBuf</span>(bufSize) } ! 2, inSig);</p>
<p class="p11"><span class="Apple-converted-space">    </span>chain = <span class="s11">PV_RectComb</span>(chain, numTeeth, phase, width);</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">IFFT</span>(chain) * amp;</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span></span>// for mix we have to take into account FFT delay</p>
<p class="p11"><span class="Apple-tab-span">	</span>inSigDelayed = <span class="s11">DelayL</span>.ar(</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.1,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bufSize / s.sampleRate - (s.options.blockSize / s.sampleRate)</p>
<p class="p11"><span class="Apple-tab-span">	</span>);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, mix * sig + ((1 - mix) * inSigDelayed));</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">t = topEnvironment.push;</p>
<p class="p9"><br></p>
<p class="p11">a = <span class="s11">Bus</span>.audio(s, 2);</p>
<p class="p11">c = <span class="s11">Bus</span>.control(s, 2);</p>
<p class="p9"><br></p>
<p class="p10">// play two loops with three "interludes" (see Task below)</p>
<p class="p9"><br></p>
<p class="p15"><span class="s2">p = </span>Pfindur<span class="s2">(178, </span>PbindFx<span class="s2">([</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\posPlay<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, a,</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s11">PL</span><span class="s2">(</span>\trigRate<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\dur<span class="s2">) * </span><span class="s11">PL</span><span class="s2">(</span>\overlap<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.subBus(0).asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, c.subBus(1).asMap,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, <span class="s11">PL</span>(<span class="s13">\rate</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pan</span>, <span class="s11">PLseq</span>([-1, 1]) * <span class="s11">PL</span>(<span class="s13">\panMax</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s13">\att</span>, <span class="s13">\rel</span>], <span class="s11">Pfunc</span> { <span class="s14">|ev|</span> d.attRel(ev[<span class="s13">\granDur</span>], <span class="s15">~att</span>, <span class="s15">~rel</span>, <span class="s15">~absEnv</span>) },</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s11">PLseq</span>(<span class="s13">\fxOrder</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.3</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\pv_rectComb<span class="s2">,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, <span class="s11">PL</span>(<span class="s13">\mix_rectComb</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_rectComb<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\numTeeth<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\numTeeth_rectComb<span class="s2">, envir: t),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\width<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\width_rectComb<span class="s2">, envir: t),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\phase<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\phase_rectComb<span class="s2">, envir: t),</span></p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.2</span></p>
<p class="p11"><span class="Apple-converted-space">    </span>]</p>
<p class="p11">));</p>
<p class="p9"><br></p>
<p class="p10">// timed pattern control for interludes, done with a Task</p>
<p class="p9"><br></p>
<p class="p11">u = <span class="s11">Task</span>({</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> times_1 = <span class="s11">PLseq</span>([10, 10, 20, 30]).iter;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> times_2 = <span class="s11">PLseq</span>([7, 8, 4, 0]).iter;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>loop {</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s14">var</span> tm;</p>
<p class="p17"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>~numTeeth_rectComb<span class="s2"> = 10;</span></p>
<p class="p17"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>~width_rectComb<span class="s2"> = 0.05;</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s15">~rate</span> = 0.2;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tm = times_1.next;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tm.wait;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s15">~numTeeth_rectComb</span> = <span class="s11">Pstutter</span>(<span class="s11">Pwhite</span>(5, 30), <span class="s11">Pwhite</span>(3, 15));</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s15">~rate</span> = <span class="s11">Pstutter</span>(<span class="s11">Pwhite</span>(50, 100), <span class="s11">Pwhite</span>(0.3, 0.5));</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s15">~width_rectComb</span> = <span class="s11">Pbrown</span>(0.2, 0.5, 0.02);</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tm = times_2.next;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tm.wait;</p>
<p class="p11"><span class="Apple-tab-span">	</span>}</p>
<p class="p11">}.inEnvir(t));</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">v = <span class="s11">VarGui</span>([</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span></span>// separate Environments for Task and PbindFx player</p>
<p class="p11"><span class="Apple-tab-span">	</span>[],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\att</span>, [1, 200, <span class="s13">\lin</span>, 0, 7],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\rel</span>, [1, 200, <span class="s13">\lin</span>, 0, 7],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\absEnv</span>, [0, 1, <span class="s13">\lin</span>, 1, 0],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\overlap</span>, [0.05, 15, <span class="s13">\lin</span>, 0, 3.3],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\trigRate</span>, [1, 200, <span class="s13">\lin</span>, 0, 54.73],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMax</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.99],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\amp</span>, [0.0, 3, <span class="s13">\lin</span>, 0, 0.15],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp_rectComb</span>, [0, 10, <span class="s13">\lin</span>, 0, 5.6]</p>
<p class="p11"><span class="Apple-tab-span">	</span>]],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posLo</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.2574],</p>
<p class="p11"><span class="Apple-converted-space">   <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\posHi</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.3267],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevE</span>, [-6, 0, <span class="s13">\lin</span>, 1, -5],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevM</span>, [0.0, 10, <span class="s13">\lin</span>, 0, 1.9],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateE</span>, [-4, 2, <span class="s13">\lin</span>, 1, -1],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 5.05],</p>
<p class="p11"><span class="Apple-converted-space">  <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\type</span>, [0, 3, <span class="s13">\lin</span>, 1, 3],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index</p>
<p class="p11"><span class="Apple-tab-span">	</span>], stream: [u, p], synth: <span class="s13">\pos</span></p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p11">w = (</p>
<p class="p11"><span class="Apple-tab-span">	</span>varColorGroups: (0..7).clumps([7, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>synthColorGroups: (0..8).clumps([1, 2, 2, 2, 1, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>labelWidth: 130,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderHeight: 18,</p>
<p class="p11"><span class="Apple-tab-span">	</span>playerHeight: 18</p>
<p class="p11">);</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// running the patch: evaluate this,<span class="Apple-converted-space"> </span></p>
<p class="p10">// then in gui start position synth <span class="Apple-converted-space"> </span></p>
<p class="p10">// start PbindFx / Task players together by pressing their green buttons with shift-click</p>
<p class="p9"><br></p>
<p class="p10">// while running the patch check modified slider values and<span class="Apple-converted-space"> </span></p>
<p class="p10">// consider pattern replacements as shown in part 1</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11">x = <span class="s11">Synth</span>(<span class="s13">\leakDC</span>, [<span class="s13">\out</span>, 0, <span class="s13">\in</span>, a]);</p>
<p class="p9"><br></p>
<p class="p17">~mix_rectComb<span class="s2"> = 0.75;</span></p>
<p class="p11"><span class="s15">~phase_rectComb</span> = <span class="s11">Pstutter</span>(<span class="s11">Pwhite</span>(1, 4), <span class="s11">Pwhite</span>(0.0, 0.6));</p>
<p class="p17">~fxOrder<span class="s2"> = [1];</span></p>
<p class="p9"><br></p>
<p class="p11">v.performWithEnvir(<span class="s13">\gui</span>, w)</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// after stopping free leakDC synth</p>
<p class="p9"><br></p>
<p class="p11">x.free</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8"><b>Part 3 – resampling</b></p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p10">// fx with "post-mix" amplitude</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\resample</span><span class="s2">, { </span>|out = 0, in, mix = 0.5, amp = 1, resampleRate = 44100|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> sig, inSig = <span class="s11">In</span>.ar(in, 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">Latch</span>.ar(inSig, <span class="s11">Impulse</span>.ar(resampleRate));</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, ((1 - mix) * inSig + (sig * mix)) * amp);</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p11">t = topEnvironment.push;</p>
<p class="p9"><br></p>
<p class="p11">a = <span class="s11">Bus</span>.audio(s, 2);</p>
<p class="p11">c = <span class="s11">Bus</span>.control(s, 2);</p>
<p class="p9"><br></p>
<p class="p15"><span class="s2">p = </span>Pfindur<span class="s2">(90, </span>PbindFx<span class="s2">([</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\posPlay<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, a,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\dur</span>, 1 / <span class="s11">PL</span>(<span class="s13">\trigRate</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\dur<span class="s2">) * </span><span class="s11">PL</span><span class="s2">(</span>\overlap<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.subBus(0).asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, c.subBus(1).asMap,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, <span class="s11">PL</span>(<span class="s13">\rate</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pan</span>, <span class="s11">PLseq</span>([-1, 1]) * <span class="s11">PL</span>(<span class="s13">\panMax</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s13">\att</span>, <span class="s13">\rel</span>], <span class="s11">Pfunc</span> { <span class="s14">|ev|</span> d.attRel(ev[<span class="s13">\granDur</span>], <span class="s15">~att</span>, <span class="s15">~rel</span>, <span class="s15">~absEnv</span>) },</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s11">PL</span>(<span class="s13">\fxOrder</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.3</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\resample<span class="s2">,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\mix</span>, <span class="s11">PL</span>(<span class="s13">\mix_resample</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_resample<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\resampleRate<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\resampleRate_resample<span class="s2">, envir: t),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p11"><span class="Apple-converted-space">    </span>]</p>
<p class="p11">));</p>
<p class="p9"><br></p>
<p class="p11">v = <span class="s11">VarGui</span>([</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, [1, 200, <span class="s13">\lin</span>, 0, 4.98],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\rel</span>, [1, 200, <span class="s13">\lin</span>, 0, 4.98],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\absEnv</span>, [0, 1, <span class="s13">\lin</span>, 1, 1.0],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\overlap</span>, [0.05, 15, <span class="s13">\lin</span>, 0, 3.5],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMax</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.93],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\amp</span>, [0.0, 3, <span class="s13">\lin</span>, 0, 0.15],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp_resample</span>, [0, 3, <span class="s13">\lin</span>, 0, 2.7]</p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posLo</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.27],</p>
<p class="p11"><span class="Apple-converted-space">   <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\posHi</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.34],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevE</span>, [-6, 0, <span class="s13">\lin</span>, 1, -5],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevM</span>, [0.0, 10, <span class="s13">\lin</span>, 0, 0.3],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateE</span>, [-4, 2, <span class="s13">\lin</span>, 1, -1],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 3.5],</p>
<p class="p11"><span class="Apple-converted-space">  <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\type</span>, [0, 3, <span class="s13">\lin</span>, 1, 3],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index</p>
<p class="p11"><span class="Apple-tab-span">	</span>], stream: p, synth: <span class="s13">\pos</span></p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p11">w = (</p>
<p class="p11"><span class="Apple-tab-span">	</span>varColorGroups: (0..6).clumps([6, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>synthColorGroups: (0..8).clumps([1, 2, 2, 2, 1, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>labelWidth: 110,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderHeight: 18,</p>
<p class="p11"><span class="Apple-tab-span">	</span>playerHeight: 18</p>
<p class="p11">);</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// running the patch: evaluate this,<span class="Apple-converted-space"> </span></p>
<p class="p10">// then in gui start position synth and PbindFx stream by pressing both green buttons</p>
<p class="p9"><br></p>
<p class="p10">// while running the patch check modified slider values and<span class="Apple-converted-space"> </span></p>
<p class="p10">// consider pattern replacements as shown in part 1</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11"><span class="s11">Synth</span>(<span class="s13">\leakDC</span>, [<span class="s13">\out</span>, 0, <span class="s13">\in</span>, a]);</p>
<p class="p9"><br></p>
<p class="p17">~resampleRate_resample<span class="s2"> = </span><span class="s11">Pn</span><span class="s2">(</span><span class="s11">Plazy</span><span class="s2"> {</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> freqs = (1..rrand(8, 15)) * rrand(100, 600);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pseq</span>(freqs, rrand(3, 6))</p>
<p class="p11">});</p>
<p class="p9"><br></p>
<p class="p17">~fxOrder<span class="s2"> = 1;</span></p>
<p class="p9"><br></p>
<p class="p17">~mix_resample<span class="s2"> = </span><span class="s11">Pseg</span><span class="s2">(</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">PLseq</span>([0.0, 0.9]),</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span></span>// see PS help, examples for "counted embedding"</p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span></span>PLseq<span class="s2">([</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PS</span>(<span class="s11">Pwhite</span>(2.0, 3), <span class="s11">Pwhite</span>(1, 2)),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PS</span>(<span class="s11">Pwhite</span>(0.03, 0.05), <span class="s11">Pwhite</span>(50, 80))</p>
<p class="p11"><span class="Apple-tab-span">	</span>]),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span></span>\step</p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p10">// random quarter tone row</p>
<p class="p11"><span class="s15">~rate</span> = <span class="s11">Pseg</span>(<span class="s11">PLshuf</span>((-24..24)/2).midiratio, <span class="s11">Pwhite</span>(0.2, 2), <span class="s13">\step</span>);</p>
<p class="p9"><br></p>
<p class="p11"><span class="s15">~trigRate</span> = <span class="s11">Pseg</span>(<span class="s11">Pwhite</span>(40, 120), <span class="s11">Pwhite</span>(0.5, 2), <span class="s13">\sine</span>);</p>
<p class="p9"><br></p>
<p class="p11">v.performWithEnvir(<span class="s13">\gui</span>, w)</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p10">// after stopping free leakDC synth</p>
<p class="p9"><br></p>
<p class="p11">x.free</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8"><b>Part 4 – spectral complements (FFT)</b></p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p10">// emphasizes / supresses bin range and / or complement</p>
<p class="p10">// uses pseudo ugens PV_BinRange and PV_BinGap</p>
<p class="p9"><br></p>
<p class="p10">// freqLo and freqHi define the range</p>
<p class="p10">// rangeMul is the multiplier for the selected band</p>
<p class="p10">// compMul is the multiplier for the rest of the spectrum</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\pv_binRangeBal</span><span class="s2">, { </span>|out = 0, in, freqLo = 80, freqHi = 300, rangeMul = 1, compMul = 1, mix = 1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> chain, chain_range, chain_comp, inSig = <span class="s11">In</span>.ar(in, 2), sig, bufSize = 2048,</p>
<p class="p11"><span class="Apple-tab-span">	</span>lo, hi, binRange, binNum, inSigDelayed;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>binRange = s.sampleRate / bufSize;</p>
<p class="p11"><span class="Apple-tab-span">	</span>binNum = (freqHi - freqLo / binRange).round;</p>
<p class="p11"><span class="Apple-tab-span">	</span>lo = (freqLo / binRange).round;</p>
<p class="p11"><span class="Apple-tab-span">	</span>hi = (freqHi / binRange).round;</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>chain = <span class="s11">FFT</span>({ <span class="s11">LocalBuf</span>(bufSize) } ! 2, inSig);</p>
<p class="p11"><span class="Apple-tab-span">	</span>chain_range = <span class="s11">PV_BinRange</span>(chain, lo, hi);</p>
<p class="p11"><span class="Apple-tab-span">	</span>chain_comp = <span class="s11">PV_BinGap</span>(chain, lo, hi);</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">IFFT</span>(chain_range) * rangeMul + (<span class="s11">IFFT</span>(chain_comp) * compMul);</p>
<p class="p11"><span class="Apple-tab-span">	</span>inSigDelayed = <span class="s11">DelayL</span>.ar(</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inSig,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.1,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bufSize / s.sampleRate - (s.options.blockSize / s.sampleRate)</p>
<p class="p11"><span class="Apple-tab-span">	</span>);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, mix * sig + ((1 - mix) * inSigDelayed));</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">t = topEnvironment.push;</p>
<p class="p9"><br></p>
<p class="p11">a = <span class="s11">Bus</span>.audio(s, 2);</p>
<p class="p11">c = <span class="s11">Bus</span>.control(s, 2);</p>
<p class="p9"><br></p>
<p class="p15"><span class="s2">p = </span>Pfindur<span class="s2">(200, </span>PbindFx<span class="s2">([</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\posPlay<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, a,</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s11">PL</span><span class="s2">(</span>\trigRate<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\dur<span class="s2">) * </span><span class="s11">PL</span><span class="s2">(</span>\overlap<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.subBus(0).asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, c.subBus(1).asMap,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, <span class="s11">PL</span>(<span class="s13">\rate</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pan</span>, <span class="s11">PLseq</span>([-1, 1]) * <span class="s11">PL</span>(<span class="s13">\panMax</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s13">\att</span>, <span class="s13">\rel</span>], <span class="s11">Pfunc</span> { <span class="s14">|ev|</span> d.attRel(ev[<span class="s13">\granDur</span>], <span class="s15">~att</span>, <span class="s15">~rel</span>, <span class="s15">~absEnv</span>) },</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s11">PL</span>(<span class="s13">\fxOrder</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.3</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\pv_binRangeBal<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\mix_pv_binRangeBal<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\freqLo<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\freqLo_pv_binRangeBal<span class="s2">, envir: t),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\freqHi<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\freqLo<span class="s2">) + </span><span class="s11">PL</span><span class="s2">(</span>\freqRange_pv_binRangeBal<span class="s2">, envir: t),</span></p>
<p class="p9"><br></p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// multipliers for spectral band and complement are given as tupel 'muls'</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\muls<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\muls_pv_binRangeBal<span class="s2">, envir: t),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rangeMul</span>, <span class="s11">Pkey</span>(<span class="s13">\muls</span>).collect(<span class="s11">_</span>[0]),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\compMul</span>, <span class="s11">Pkey</span>(<span class="s13">\muls</span>).collect(<span class="s11">_</span>[1]),</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.2</span></p>
<p class="p11"><span class="Apple-converted-space">    </span>]</p>
<p class="p11">));</p>
<p class="p9"><br></p>
<p class="p11">v = <span class="s11">VarGui</span>([</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, [1, 200, <span class="s13">\lin</span>, 0, 3],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\rel</span>, [1, 200, <span class="s13">\lin</span>, 0, 3],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\absEnv</span>, [0, 1, <span class="s13">\lin</span>, 1, 0],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\overlap</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 1.45],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\trigRate</span>, [1, 200, <span class="s13">\lin</span>, 0, 118.41],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMax</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.88],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\amp</span>, [0.0, 3, <span class="s13">\lin</span>, 0, 0.9],</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix_pv_binRangeBal<span class="s2">, [0, 1, </span>\lin<span class="s2">, 0, 1]</span></p>
<p class="p11">],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posLo</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.21],</p>
<p class="p11"><span class="Apple-converted-space">   <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\posHi</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.34],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevE</span>, [-6, 0, <span class="s13">\lin</span>, 1, -5],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevM</span>, [0.0, 10, <span class="s13">\lin</span>, 0, 1.0],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateE</span>, [-4, 2, <span class="s13">\lin</span>, 1, -2],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 2.278],</p>
<p class="p11"><span class="Apple-converted-space">  <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\type</span>, [0, 3, <span class="s13">\lin</span>, 1, 3],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index</p>
<p class="p11"><span class="Apple-tab-span">	</span>], stream: p, synth: <span class="s13">\pos</span></p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p11">w = (</p>
<p class="p11"><span class="Apple-tab-span">	</span>varColorGroups: (0..7).clumps([7, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>synthColorGroups: (0..8).clumps([1, 2, 2, 2, 1, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>labelWidth: 130,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderHeight: 18,</p>
<p class="p11"><span class="Apple-tab-span">	</span>playerHeight: 18</p>
<p class="p11">);</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// running the patch: evaluate this,<span class="Apple-converted-space"> </span></p>
<p class="p10">// then in gui start position synth and PbindFx stream by pressing both green buttons</p>
<p class="p9"><br></p>
<p class="p10">// while running the patch check modified slider values and<span class="Apple-converted-space"> </span></p>
<p class="p10">// consider pattern replacements as shown in part 1</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11"><span class="s11">Synth</span>(<span class="s13">\leakDC</span>, [<span class="s13">\out</span>, 0, <span class="s13">\in</span>, a]);</p>
<p class="p9"><br></p>
<p class="p17">~fxOrder<span class="s2"> = 1;</span></p>
<p class="p9"><br></p>
<p class="p10">// double source grain in octave distance</p>
<p class="p11"><span class="s15">~rate</span> = [0.15, 0.3];</p>
<p class="p9"><br></p>
<p class="p10">// pattern for lower bound of spectral band</p>
<p class="p17">~freqLo_pv_binRangeBal<span class="s2"> = </span><span class="s11">Pn</span><span class="s2">(</span><span class="s11">Plazy</span><span class="s2"> {</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> x = { exprand(200, 4000)<span class="Apple-converted-space">  </span>} ! rrand(2, 4);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pseq</span>(x, rrand(5, 15));</p>
<p class="p11">});</p>
<p class="p9"><br></p>
<p class="p17">~freqRange_pv_binRangeBal<span class="s2"> = 2500;</span></p>
<p class="p9"><br></p>
<p class="p10">// this is a bit more complicated</p>
<p class="p10">// polyrhythm for multipliers of band and complement</p>
<p class="p10">// it becomes more clear when applying trace to the following patterns</p>
<p class="p9"><br></p>
<p class="p17">~zeroOneSeqTupleStream<span class="s2"> = </span><span class="s11">PLshufn</span><span class="s2">([</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>[[0, 1, 1], [0, 0, 1, 1]],</p>
<p class="p11"><span class="Apple-tab-span">	</span>[[0, 1, 1], [0, 1, 1, 1]],</p>
<p class="p11"><span class="Apple-tab-span">	</span>[[0, 0, 1], [0, 0, 1, 1]],</p>
<p class="p11"><span class="Apple-tab-span">	</span>[[0, 0, 1], [0, 1, 1, 1]],</p>
<p class="p11">]).iter;</p>
<p class="p9"><br></p>
<p class="p17">~muls_pv_binRangeBal<span class="s2"> = </span><span class="s11">Pn</span><span class="s2">(</span><span class="s11">Plazy</span><span class="s2"> ({</span></p>
<p class="p17"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s14">var</span><span class="s2"> tuple = </span>~zeroOneSeqTupleStream<span class="s2">.next;</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>if (0.5.coin) { tuple = tuple.reverse };</p>
<p class="p11"><span class="Apple-tab-span">	</span>if (0.5.coin) {</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tuple[0] = tuple[0].reverse;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tuple[1] = tuple[1].reverse;</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pfinval</span>([500, 400, 300].choose, <span class="s11">Ptuple</span>([</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PLseq</span>(tuple[0]),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PLseq</span>(tuple[1])</p>
<p class="p11"><span class="Apple-tab-span">	</span>]))</p>
<p class="p11">}.inEnvir));</p>
<p class="p9"><br></p>
<p class="p11">v.performWithEnvir(<span class="s13">\gui</span>, w)</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p10">// after stopping free leakDC synth</p>
<p class="p9"><br></p>
<p class="p11">x.free</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8"><b>Part 5 – frequency shift with feedback</b></p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p10">// frequency shift with feedback</p>
<p class="p10">// "post-mix" fx amplitude</p>
<p class="p13"><br></p>
<p class="p10">// fx with feedback obviously needs envelope !</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\freqShift</span><span class="s2">, { </span>|out = 0, in, mix = 1, freq = 0, fbAmp = 0,</p>
<p class="p12"><span class="Apple-tab-span">	</span>granDur = 0.1, att = 0.01, rel = 0.01, amp = 0.1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> inSig = <span class="s11">In</span>.ar(in, 2), sig, fb, env;</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = inSig + (fbAmp * <span class="s11">LocalIn</span>.ar(2));</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">Limiter</span>.ar(sig);</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">FreqShift</span>.ar(sig, freq);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">LocalOut</span>.ar(sig);</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">LPF</span>.ar(sig, 10000);</p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span></span>// delayed attack is functioning as additional feedback control</p>
<p class="p11"><span class="Apple-tab-span">	</span>env = <span class="s11">EnvGen</span>.ar(<span class="s11">Env</span>([0, 0, 1, 1, 0], [0.01, att, granDur - att - rel, rel]), doneAction: 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, (mix * sig + ((1 - mix) * inSig)) * amp * env);</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p11">t = topEnvironment.push;</p>
<p class="p9"><br></p>
<p class="p11">a = <span class="s11">Bus</span>.audio(s, 2);</p>
<p class="p11">c = <span class="s11">Bus</span>.control(s, 2);</p>
<p class="p9"><br></p>
<p class="p15"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\posPlay<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, a,</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s11">PL</span><span class="s2">(</span>\trigRate<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\dur<span class="s2">) * </span><span class="s11">PL</span><span class="s2">(</span>\overlap<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.subBus(0).asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, c.subBus(1).asMap,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, <span class="s11">PL</span>(<span class="s13">\rate</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pan</span>, <span class="s11">PLseq</span>([-1, 1]) * <span class="s11">PL</span>(<span class="s13">\panMax</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s13">\att</span>, <span class="s13">\rel</span>], <span class="s11">Pfunc</span> { <span class="s14">|ev|</span> d.attRel(ev[<span class="s13">\granDur</span>], <span class="s15">~att</span>, <span class="s15">~rel</span>, <span class="s15">~absEnv</span>) },</p>
<p class="p9"><br></p>
<p class="p10"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// envelope data to be shared with fx</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\do<span class="s2">, </span><span class="s11">Ptuple</span><span class="s2">([</span><span class="s11">Pkey</span><span class="s2">(</span>\granDur<span class="s2">), </span><span class="s11">Pkey</span><span class="s2">(</span>\att<span class="s2">), </span><span class="s11">Pkey</span><span class="s2">(</span>\rel<span class="s2">)])</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.collect { <span class="s14">|x|</span><span class="Apple-converted-space">  </span>t[<span class="s13">\share</span>] =<span class="Apple-converted-space">  </span>x },</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s11">PL</span>(<span class="s13">\fxOrder</span>, envir: t),</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\cleanupDelay</span>, <span class="s11">Pfunc</span> { <span class="s14">|ev|</span><span class="Apple-converted-space">  </span>max(0.2, ev[<span class="s13">\granDur</span>] - ev[<span class="s13">\dur</span>]) }</p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\freqShift<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\mix_freqShift<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_freqShift<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[</span>\granDur<span class="s2">, </span>\att<span class="s2">, </span>\rel<span class="s2">], </span><span class="s11">Pfunc</span><span class="s2"> { t[</span>\share<span class="s2">] },</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\granDur<span class="s2">) * 0.9,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\freq<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\freq_freqShift<span class="s2">, envir: t),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fbAmp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\fbAmp_freqShift<span class="s2">, envir: t),</span></p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.5</span></p>
<p class="p11"><span class="Apple-converted-space">    </span>]</p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">v = <span class="s11">VarGui</span>([</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, [1, 200, <span class="s13">\lin</span>, 0, 3],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\rel</span>, [1, 200, <span class="s13">\lin</span>, 0, 7],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\absEnv</span>, [0, 1, <span class="s13">\lin</span>, 1, 1.0],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\overlap</span>, [0.05, 15, <span class="s13">\lin</span>, 0, 6.927],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\trigRate</span>, [1, 200, <span class="s13">\lin</span>, 0, 24.88],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMax</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.84],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\amp</span>, [0.0, 1, <span class="s13">\lin</span>, 0, 0.06],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\mix_freqShift</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.54],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\amp_freqShift</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 0.3]</p>
<p class="p11">],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posLo</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.21],</p>
<p class="p11"><span class="Apple-converted-space">   <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\posHi</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.34],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevE</span>, [-6, 0, <span class="s13">\lin</span>, 1, -5],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevM</span>, [0.0, 10, <span class="s13">\lin</span>, 0, 0.5],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateE</span>, [-4, 2, <span class="s13">\lin</span>, 1, 0],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 1.486],</p>
<p class="p11"><span class="Apple-converted-space">  <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\type</span>, [0, 3, <span class="s13">\lin</span>, 1, 3],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index</p>
<p class="p11"><span class="Apple-tab-span">	</span>], stream: p, synth: <span class="s13">\pos</span></p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">w = (</p>
<p class="p11"><span class="Apple-tab-span">	</span>varColorGroups: (0..8).clumps([7, 2]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>synthColorGroups: (0..8).clumps([1, 2, 2, 2, 1, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>labelWidth: 130,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderHeight: 18,</p>
<p class="p11"><span class="Apple-tab-span">	</span>playerHeight: 18</p>
<p class="p11">);</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// running the patch: evaluate this,<span class="Apple-converted-space"> </span></p>
<p class="p10">// then in gui start position synth and PbindFx stream by pressing both green buttons</p>
<p class="p9"><br></p>
<p class="p10">// while running the patch check modified slider values and<span class="Apple-converted-space"> </span></p>
<p class="p10">// consider pattern replacements as shown in part 1</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11"><span class="s11">Synth</span>(<span class="s13">\leakDC</span>, [<span class="s13">\out</span>, 0, <span class="s13">\in</span>, a]);</p>
<p class="p9"><br></p>
<p class="p11"><span class="s15">~freq_freqShift</span> = <span class="s11">Pstutter</span>(<span class="s11">Pwhite</span>(10, 50), <span class="s11">Pwhite</span>(-200, 50, 1));</p>
<p class="p11"><span class="s15">~fbAmp_freqShift</span> = <span class="s11">Pstutter</span>(<span class="s11">Pstutter</span>(<span class="s11">Pwhite</span>(2, 5), <span class="s11">Pwhite</span>(1, 2)), <span class="s11">PLseq</span>([1, -2]));</p>
<p class="p17">~fxOrder<span class="s2"> = [1];</span></p>
<p class="p9"><br></p>
<p class="p15"><span class="s15">~rate</span><span class="s2"> = </span>Pn<span class="s2">(</span>Plazy<span class="s2"> {</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pseries</span>(exprand(0.3, 0.7), rrand(0.02, 0.1), rrand(5, 20));</p>
<p class="p11">}) * 0.8; <span class="Apple-converted-space"> </span></p>
<p class="p9"><br></p>
<p class="p11">v.performWithEnvir(<span class="s13">\gui</span>, w)</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p10">// after stopping free leakDC synth</p>
<p class="p9"><br></p>
<p class="p11">x.free</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p8"><b>Part 6 – band pass</b></p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p10">// band pass</p>
<p class="p10">// "post-mix" fx amplitude</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\bpf</span><span class="s2">, { </span>|out = 0, in, freq = 440, rq = 0.1, amp = 1, mix = 1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> sig, inSig = <span class="s11">In</span>.ar(in, 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span>sig = <span class="s11">BPF</span>.ar(inSig, freq, rq);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, (mix * sig + ((1 - mix) * inSig)) * amp);</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p10">// gain as fx for better control of balancing when sequencing grains with and without band pass</p>
<p class="p9"><br></p>
<p class="p12"><span class="s11">SynthDef</span><span class="s2">(</span><span class="s13">\gain</span><span class="s2">, { </span>|out = 0, in, amp = 1|</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s14">var</span> inSig = <span class="s11">In</span>.ar(in, 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">OffsetOut</span>.ar(out, inSig * amp);</p>
<p class="p11">}).add;</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p11">t = topEnvironment.push;</p>
<p class="p9"><br></p>
<p class="p11">a = <span class="s11">Bus</span>.audio(s, 2);</p>
<p class="p11">c = <span class="s11">Bus</span>.control(s, 2);</p>
<p class="p9"><br></p>
<p class="p10">// duration defined by 'rate' with Pfinval</p>
<p class="p15"><span class="s2">p = </span>PbindFx<span class="s2">([</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\posPlay<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, a,</p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s11">PL</span><span class="s2">(</span>\trigRate<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s11">Pkey</span><span class="s2">(</span>\dur<span class="s2">) * </span><span class="s11">PL</span><span class="s2">(</span>\overlap<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.subBus(0).asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, c.subBus(1).asMap,</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, <span class="s11">PL</span>(<span class="s13">\rate</span>, 1, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\pan</span>, <span class="s11">PLseq</span>([-1, 1]) * <span class="s11">PL</span>(<span class="s13">\panMax</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s13">\att</span>, <span class="s13">\rel</span>], <span class="s11">Pfunc</span> { <span class="s14">|ev|</span> d.attRel(ev[<span class="s13">\granDur</span>], <span class="s15">~att</span>, <span class="s15">~rel</span>, <span class="s15">~absEnv</span>) },</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\fxOrder</span>, <span class="s11">PL</span>(<span class="s13">\fxOrder</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.3</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\gain<span class="s2">,</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_gain<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\fx<span class="s2">, </span>\bpf<span class="s2">,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, <span class="s11">PL</span>(<span class="s13">\freq_bpf</span>, envir: t),</p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\rq<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\rq_bpf<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\mix<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\mix_bpf<span class="s2">),</span></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s11">PL</span><span class="s2">(</span>\amp_bpf<span class="s2">),</span></p>
<p class="p9"><br></p>
<p class="p16"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\cleanupDelay<span class="s2">, 0.01</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>]</p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p11">v = <span class="s11">VarGui</span>([</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\att</span>, [1, 200, <span class="s13">\lin</span>, 0, 4.98],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\rel</span>, [1, 200, <span class="s13">\lin</span>, 0, 4.98],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\absEnv</span>, [0, 1, <span class="s13">\lin</span>, 1, 1.0],</p>
<p class="p11"><span class="Apple-converted-space">     <span class="Apple-tab-span">	</span></span><span class="s13">\overlap</span>, [0.05, 15, <span class="s13">\lin</span>, 0, 6.7775],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\trigRate</span>, [1, 200, <span class="s13">\lin</span>, 0, 176.12],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMax</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.83],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\amp</span>, [0.0, 3, <span class="s13">\lin</span>, 0, 0.75],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\amp_gain</span>, [0.0, 3, <span class="s13">\lin</span>, 0, 0.36],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\rq_bpf</span>, [0.01, 1, <span class="s13">\lin</span>, 0, 0.0397],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\mix_bpf</span>, [0, 1, <span class="s13">\lin</span>, 0, 0.91],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span><span class="s13">\amp_bpf</span>, [0, 1, <span class="s13">\lin</span>, 0, 2.7],</p>
<p class="p11"><span class="Apple-tab-span">	</span>],[</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posLo</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.2574],</p>
<p class="p11"><span class="Apple-converted-space">   <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\posHi</span>, [0, 0.99, <span class="s13">\lin</span>, 0, 0.4059],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevE</span>, [-6, 0, <span class="s13">\lin</span>, 1, -4],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posDevM</span>, [0.0, 10, <span class="s13">\lin</span>, 0, 1.0],</p>
<p class="p9"><br></p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateE</span>, [-4, 2, <span class="s13">\lin</span>, 1, -1],</p>
<p class="p11"><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\lin</span>, 0, 0.892],</p>
<p class="p11"><span class="Apple-converted-space">  <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\type</span>, [0, 3, <span class="s13">\lin</span>, 1, 3],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index</p>
<p class="p11"><span class="Apple-tab-span">	</span>], stream: p, synth: <span class="s13">\pos</span></p>
<p class="p11">);</p>
<p class="p9"><br></p>
<p class="p11">w = (</p>
<p class="p11"><span class="Apple-tab-span">	</span>varColorGroups: (0..10).clumps([8, 3]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>synthColorGroups: (0..8).clumps([1, 2, 2, 2, 1, 1]),</p>
<p class="p11"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p11"><span class="Apple-tab-span">	</span>labelWidth: 130,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderWidth: 350,</p>
<p class="p11"><span class="Apple-tab-span">	</span>sliderHeight: 18,</p>
<p class="p11"><span class="Apple-tab-span">	</span>playerHeight: 18</p>
<p class="p11">);</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p10">// running the patch: evaluate this,<span class="Apple-converted-space"> </span></p>
<p class="p10">// then in gui start position synth and PbindFx stream by pressing both green buttons</p>
<p class="p9"><br></p>
<p class="p10">// while running the patch check modified slider values and<span class="Apple-converted-space"> </span></p>
<p class="p10">// consider pattern replacements as shown in part 1</p>
<p class="p9"><br></p>
<p class="p11">(</p>
<p class="p11"><span class="s11">Synth</span>(<span class="s13">\leakDC</span>, [<span class="s13">\out</span>, 0, <span class="s13">\in</span>, a]);</p>
<p class="p9"><br></p>
<p class="p10">// "octave arpeggio" bandpass frequencies, interleaved (PS with repeats = 1)</p>
<p class="p10">// check other relations, repetition numbers and fxOrder sequences</p>
<p class="p9"><br></p>
<p class="p17">~freq_bpf<span class="s2"> = </span><span class="s11">PLseq</span><span class="s2">([</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">PS</span>(<span class="s11">Pstutter</span>(3, <span class="s11">Pseg</span>(<span class="s11">Pwhite</span>(200, 7000), <span class="s11">Pwhite</span>(0.5, 2))) * <span class="s11">PLseq</span>([0.5, 1, 2]), 1),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">PS</span>(<span class="s11">Pstutter</span>(2, <span class="s11">Pseg</span>(<span class="s11">Pwhite</span>(200, 7000), <span class="s11">Pwhite</span>(0.5, 2))) * <span class="s11">PLseq</span>([0.5, 1, 2]), 1)</p>
<p class="p11">]);</p>
<p class="p9"><br></p>
<p class="p10">// start with 1 ensures that we don't have filter only in single channel</p>
<p class="p11"><span class="s15">~fxOrder</span> = <span class="s11">PLseq</span>([1, 2, 2, 1]);</p>
<p class="p9"><br></p>
<p class="p10">// development by ascending rate "chords"</p>
<p class="p9"><br></p>
<p class="p17">~rate<span class="s2"> = </span><span class="s11">Pseq</span><span class="s2">([</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pfinval</span>(5582,</p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>Pstutter<span class="s2">(</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PLseq</span>([120, 80, 80]),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">Pexprand</span>(0.3, 1.5).clump(<span class="s11">PLshufn</span>((1..3)) * 2 + 1)</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).flatten</p>
<p class="p11"><span class="Apple-tab-span">	</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pfinval</span>(5582,</p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>Pstutter<span class="s2">(</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PLseq</span>([120, 80, 80]),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">Pexprand</span>(0.3, 0.6).clump(<span class="s11">PLshufn</span>((1..3)) * 2 + 1)</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).flatten</p>
<p class="p11"><span class="Apple-tab-span">	</span>),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">Pfinval</span>(15000,</p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>Pstutter<span class="s2">(</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">PLseq</span>([120, 80, 80]),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s11">Pexprand</span>(0.1, 0.2).clump(<span class="s11">PLshufn</span>((1..3)) * 2 + 1)</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>).flatten</p>
<p class="p11"><span class="Apple-tab-span">	</span>)</p>
<p class="p11">]);</p>
<p class="p9"><br></p>
<p class="p11">v.performWithEnvir(<span class="s13">\gui</span>, w)</p>
<p class="p11">)</p>
<p class="p9"><br></p>
<p class="p10">// after stopping free leakDC synth</p>
<p class="p9"><br></p>
<p class="p11">x.free</p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
<p class="p9"><br></p>
</body>
</html>
